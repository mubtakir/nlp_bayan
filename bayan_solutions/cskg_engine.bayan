# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù…Ø­Ø±Ùƒ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ-Ø§Ù„Ø³Ø¨Ø¨ÙŠ Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠ
# Contextual Semantic-Causal Knowledge Graph (CSKG) - Engine
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ù„Ù…Ø·ÙˆØ±: Ø¨Ø§Ø³Ù„ ÙŠØ­ÙŠÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡
# Ø§Ù„ØªØ§Ø±ÙŠØ®: 2025
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

hybrid {
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø© Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def predict_next_in_context(sentence, position, candidates):
    {
        print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        print("ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„Ø©:", sentence)
        print("ğŸ“ Ø§Ù„Ù…ÙˆØ¶Ø¹:", position)
        print("ğŸ¯ Ø§Ù„Ù…Ø±Ø´Ø­ÙˆÙ†:", candidates)
        print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        print("")
        
        # 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³ÙŠØ§Ù‚
        context = extract_context(sentence)
        print("ğŸ“ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:")
        print("  - Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª:", context["entities"])
        print("  - Ø§Ù„Ø£Ù†Ø´Ø·Ø©:", context["activities"])
        print("  - Ø§Ù„Ø£Ù…Ø§ÙƒÙ†:", context["places"])
        print("")
        
        # 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ù…Ø±Ø´Ø­
        scores = {}
        
        for candidate in candidates:
        {
            print("âš–ï¸ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø±Ø´Ø­:", candidate)
            
            # Ø£. Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
            direct_score = compute_direct_strength(context, candidate)
            print("  - Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:", direct_score)
            
            # Ø¨. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ©
            distance_score = compute_distance_score(context, candidate)
            print("  - Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§ÙØ©:", distance_score)
            
            # Ø¬. Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠ
            context_score = compute_context_compatibility(context, candidate)
            print("  - Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠ:", context_score)
            
            # Ø¯. Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ©
            total_score = (direct_score * 0.4) + (distance_score * 0.3) + (context_score * 0.3)
            scores[candidate] = total_score
            print("  - Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ©:", total_score)
            print("")
        }
        
        # 3. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„
        best = max(scores, key=scores.get)
        print("âœ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„:", best, "- Ø§Ù„Ù†Ù‚Ø§Ø·:", scores[best])
        print("")
        
        return {"prediction": best, "score": scores[best], "all_scores": scores}
    }
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³ÙŠØ§Ù‚
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def extract_context(sentence):
    {
        context = {
            "entities": [],
            "activities": [],
            "places": [],
            "all_concepts": []
        }
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
        words = sentence.split(" ")
        
        for word in words:
        {
            # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙÙ‡ÙˆÙ…
            query Ù…ÙÙ‡ÙˆÙ…(word, ?Ù†ÙˆØ¹, ?Ù…Ø¬Ø§Ù„).
            
            if query_has_results:
            {
                context["all_concepts"].append(word)
                
                if ?Ù†ÙˆØ¹ == "ÙƒØ§Ø¦Ù†" or ?Ù†ÙˆØ¹ == "Ø´Ø®Øµ":
                {
                    context["entities"].append(word)
                }
                elif ?Ù†ÙˆØ¹ == "Ù†Ø´Ø§Ø·":
                {
                    context["activities"].append(word)
                }
                elif ?Ù†ÙˆØ¹ == "Ù…ÙƒØ§Ù†":
                {
                    context["places"].append(word)
                }
            }
        }
        
        return context
    }
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def compute_direct_strength(context, candidate):
    {
        max_strength = 0.0
        
        # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
        for concept in context["all_concepts"]:
        {
            query Ø¹Ù„Ø§Ù‚Ø©(concept, ?Ù†ÙˆØ¹, candidate, ?Ù‚ÙˆØ©).
            
            if query_has_results:
            {
                if ?Ù‚ÙˆØ© > max_strength:
                {
                    max_strength = ?Ù‚ÙˆØ©
                }
            }
        }
        
        return max_strength
    }
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§ÙØ©
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def compute_distance_score(context, candidate):
    {
        min_distance = 999
        
        for concept in context["all_concepts"]:
        {
            # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø±
            path = find_path_bfs(concept, candidate, 5)
            
            if path != None:
            {
                distance = len(path) - 1
                if distance < min_distance:
                {
                    min_distance = distance
                }
            }
        }
        
        # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¥Ù„Ù‰ Ù†Ù‚Ø§Ø· (ÙƒÙ„Ù…Ø§ Ù‚Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ©ØŒ Ø²Ø§Ø¯Øª Ø§Ù„Ù†Ù‚Ø§Ø·)
        if min_distance == 999:
        {
            return 0.0
        }
        else:
        {
            return 1.0 / (min_distance + 1)
        }
    }

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠ
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def compute_context_compatibility(context, candidate):
    {
        score = 0.0

        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø´Ø­
        query Ù…ÙÙ‡ÙˆÙ…(candidate, ?Ù†ÙˆØ¹_Ù…Ø±Ø´Ø­, ?Ù…Ø¬Ø§Ù„_Ù…Ø±Ø´Ø­).

        if not query_has_results:
        {
            return 0.0
        }

        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙŠØ§Ù‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø±Ø´Ø­ Ù…ÙƒØ§Ù† â†’ Ù†Ù‚Ø§Ø· Ø¹Ø§Ù„ÙŠØ©
        if len(context["activities"]) > 0 and ?Ù†ÙˆØ¹_Ù…Ø±Ø´Ø­ == "Ù…ÙƒØ§Ù†":
        {
            score = score + 0.5
        }

        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙŠØ§Ù‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ† Ø¨Ø¹ÙŠØ¯Ø© (Ø³ÙŠØ§Ø­Ø©ØŒ Ø¯ÙˆÙ„) ÙˆØ§Ù„Ù…Ø±Ø´Ø­ Ù…ÙƒØ§Ù† Ø·Ø¨ÙŠØ¹ÙŠ
        for place in context["places"]:
        {
            query Ù…ÙÙ‡ÙˆÙ…(place, "Ù…ÙƒØ§Ù†", ?Ù…Ø¬Ø§Ù„_Ù…ÙƒØ§Ù†).

            if ?Ù…Ø¬Ø§Ù„_Ù…ÙƒØ§Ù† == "Ø¯ÙˆÙ„" or ?Ù…Ø¬Ø§Ù„_Ù…ÙƒØ§Ù† == "Ø£Ù…Ø§ÙƒÙ†_Ø·Ø¨ÙŠØ¹ÙŠØ©":
            {
                if ?Ù…Ø¬Ø§Ù„_Ù…Ø±Ø´Ø­ == "Ø£Ù…Ø§ÙƒÙ†_Ø·Ø¨ÙŠØ¹ÙŠØ©":
                {
                    score = score + 0.3
                }
            }
            elif ?Ù…Ø¬Ø§Ù„_Ù…ÙƒØ§Ù† == "Ø£Ù…Ø§ÙƒÙ†_Ù…Ù†Ø²Ù„ÙŠØ©":
            {
                if ?Ù…Ø¬Ø§Ù„_Ù…Ø±Ø´Ø­ == "Ø£Ù…Ø§ÙƒÙ†_Ù…Ù†Ø²Ù„ÙŠØ©":
                {
                    score = score + 0.3
                }
            }
        }

        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙŠØ§Ù‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙŠØ§Ù†Ø§Øª (Ø¥Ù†Ø³Ø§Ù†) ÙˆØ§Ù„Ù…Ø±Ø´Ø­ Ù…ÙƒØ§Ù† Ù…Ù†Ø²Ù„ÙŠ
        if len(context["entities"]) > 0 and ?Ù…Ø¬Ø§Ù„_Ù…Ø±Ø´Ø­ == "Ø£Ù…Ø§ÙƒÙ†_Ù…Ù†Ø²Ù„ÙŠØ©":
        {
            score = score + 0.2
        }

        return score
    }

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø± (BFS)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def find_path_bfs(start, goal, max_depth):
    {
        if start == goal:
        {
            return [start]
        }

        visited = []
        queue = [[start]]

        while len(queue) > 0:
        {
            path = queue.pop(0)
            node = path[-1]

            # ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ù‚
            if len(path) > max_depth:
            {
                continue
            }

            if node == goal:
            {
                return path
            }

            if not (node in visited):
            {
                visited.append(node)

                # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙŠØ±Ø§Ù†
                neighbors = get_neighbors(node)

                for neighbor in neighbors:
                {
                    new_path = path + [neighbor]
                    queue.append(new_path)
                }
            }
        }

        return None
    }

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ø¯Ø§Ù„Ø©: Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙŠØ±Ø§Ù†
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def get_neighbors(node):
    {
        neighbors = []

        # Ø¹Ù„Ø§Ù‚Ø§Øª ØµØ§Ø¯Ø±Ø©
        query Ø¹Ù„Ø§Ù‚Ø©(node, ?Ù†ÙˆØ¹, ?Ø¥Ù„Ù‰, ?Ù‚ÙˆØ©).
        for result in query_results:
        {
            neighbors.append(result["Ø¥Ù„Ù‰"])
        }

        # Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ø±Ø¯Ø©
        query Ø¹Ù„Ø§Ù‚Ø©(?Ù…Ù†, ?Ù†ÙˆØ¹, node, ?Ù‚ÙˆØ©).
        for result in query_results:
        {
            neighbors.append(result["Ù…Ù†"])
        }

        return neighbors
    }
}

