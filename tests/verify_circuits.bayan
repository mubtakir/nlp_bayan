hybrid {
    import ai.conceptual_circuits as circuits
    import ai.conceptual_programs as programs

    print("Verifying circuits...")

    # Test build_action_state_eval_circuit (refactored)
    c1 = circuits.build_action_state_eval_circuit(
        "Actor1", "Patient1", "Action1", "Axis1", 0.2, 0.8, "high", "Context1", 0.9, 0.95
    )
    print("Circuit 1 trace entities count: " + str(len(c1["trace"]["entities"])))
    print("Circuit 1 probability: " + str(c1["trace"]["events"][0]["probability"]))

    # Test build_causal_link_circuit (refactored)
    # Note: 1.5 should be clamped to 1.0 by _validate_prob
    c2 = circuits.build_causal_link_circuit(
        "E1", "E2", "A1", "A2", "Act1", "Act2", "Ctx", 0.8, 1.5 
    ) 
    print("Circuit 2 probability (clamped): " + str(c2["trace"]["events"][0]["probability"]))

    # Test merge_traces (improved)
    traces = [c1["trace"], c2["trace"], None]
    merged = programs.merge_traces(traces)
    print("Merged entities count: " + str(len(merged["entities"])))
    
    # Check sources in meta
    if "sources" in merged["meta"]: {
        print("Merged meta sources: " + str(merged["meta"]["sources"]))
    } else: {
        print("Merged meta sources: None")
    }

    print("Verification complete.")
}
