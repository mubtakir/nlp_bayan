# ๐ ุฏููู ุงูุทุจูุฉ ุงููุณูุทุฉ - Extension Layer Guide
# ููู ุชุถูู ูุธุงุฆู ุฌุฏูุฏุฉ ููููุณุฑ ุจุฏูู ุชุนุฏูู ุงููููุงุช ุงูุฃุตููุฉ

**ุงูุชุงุฑูุฎ**: 2025-12-06
**ุงูุฅุตุฏุงุฑ**: 0.6.0
**ุงูุญุงูุฉ**: ุฏููู ุดุงูู

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ููู ุงูููุท](#ููู-ุงูููุท)
2. [ุงูุทุจูุงุช ุงูููุฌูุฏุฉ](#ุงูุทุจูุงุช-ุงูููุฌูุฏุฉ)
3. [๐ฆ ุงูุทุจูุฉ ุงููุณูุทูุฉ ุงูุฌุฏูุฏุฉ (extensions/)](#ุงูุทุจูุฉ-ุงููุณูุทูุฉ-ุงูุฌุฏูุฏุฉ)
4. [ุฅูุดุงุก ุทุจูุฉ ุฌุฏูุฏุฉ](#ุฅูุดุงุก-ุทุจูุฉ-ุฌุฏูุฏุฉ)
5. [ุฃูุซูุฉ ุนูููุฉ](#ุฃูุซูุฉ-ุนูููุฉ)

---

## ๐ฏ ููู ุงูููุท

### ููุงุฐุง ุงูุทุจูุฉ ุงููุณูุทุฉุ

**ุงููุดููุฉ**: ูููุงุช ุงูููุณุฑ ุงูุฃุตููุฉ ููููุฉ (ูููุฑุงุกุฉ ููุท)

**ุงูุญู**: ููุท Extension Layer

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูููุงุช ุงูููุณุฑ ุงูุฃุตููุฉ (ููููุฉ)          โ
โ  - hybrid_interpreter.py                โ
โ  - traditional_interpreter.py           โ
โ  - parser.py                            โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โ ูุณุชุฎุฏู
                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุงูุทุจูุงุช ุงููุณูุทุฉ (ูุงุจูุฉ ููุชุนุฏูู)       โ
โ  - letter_semiotics_extension.py        โ
โ  - brain_extension.py                   โ
โ  - baserah_extension.py                 โ
โ  - nlp_extension.py (ุฌุฏูุฏ!)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ููู ูุนููุ

1. **ุงูููุณุฑ ุงูุฃุตูู** ูุญุชูู ุนูู `global_env` (ุจูุฆุฉ ุนุงูุฉ)
2. **ุงูุทุจูุฉ ุงููุณูุทุฉ** ุชุถูู ุฏูุงู ุฌุฏูุฏุฉ ุฅูู `global_env`
3. **ููุฏ ุจูุงู** ูุณุชุทูุน ุงุณุชุฏุนุงุก ูุฐู ุงูุฏูุงู ูุจุงุดุฑุฉ

---

## ๐ ุงูุทุจูุงุช ุงูููุฌูุฏุฉ

### 1. `letter_semiotics_extension.py` โญ ุงููุซุงู ุงูุฃูุถู

**ุงููุธููุฉ**: ุฅุถุงูุฉ ุฏูุงู ุณูููุงุฆูุฉ ุงูุญุฑูู

**ุงูุฏูุงู ุงููุถุงูุฉ**:
```python
# ุจุงูุนุฑุจูุฉ
ุญูู_ูููุฉ()
ูุนุงูู_ุญุฑู()
ุงุจูู_ูููุฉ()
ุฌุฐุฑ_ูููุฉ()
ุงุณุชูุจุท_ูููุฉ()

# ุจุงูุฅูุฌููุฒูุฉ
analyze_word()
letter_meanings()
generate_word()
word_root()
infer_word()
```

**ุงูุงุณุชุฎุฏุงู ูู ููุฏ ุจูุงู**:
```bayan
hybrid {
    # ุงุณุชุฎุฏุงู ูุจุงุดุฑ!
    result = ุญูู_ูููุฉ("ุจูุงู")
    print(result)
}
```

---

### 2. `brain_extension.py`

**ุงููุธููุฉ**: ุฅุถุงูุฉ ุฏูุงู ุนูู ุจูุงู ุงูููุญุฏ

**ุงูุฏูุงู ุงููุถุงูุฉ**:
```python
ูููุฑ_ูู()
ุญููู_ุจุนูู()
ูููุฏ_ูููุฉ()
ุจุฏูู_ุงููุต()
ุญุงูุฉ_ุงูุนูู()
```

---

### 3. `baserah_extension.py`

**ุงููุธููุฉ**: ุฅุถุงูุฉ ุฏูุงู ุงูุจุตูุฑุฉ ุงููููุฉ

---

<a name="ุงูุทุจูุฉ-ุงููุณูุทูุฉ-ุงูุฌุฏูุฏุฉ"></a>
## ๐ฆ ุงูุทุจูุฉ ุงููุณูุทูุฉ ุงูุฌุฏูุฏุฉ (`extensions/`)

> **ุฌุฏูุฏ ูู ุงูุฅุตุฏุงุฑ 0.4.0 - ูุญุฏุซ ูู 0.5.0**

ุชู ุฅูุดุงุก ูุฌูุฏ `extensions/` ูุทุจูุฉ ูุณูุทูุฉ ูุณุชููุฉ ุชููุฑ ููุฒุงุช ูุชูุฏูุฉ ุฏูู ุงููุณุงุณ ุจููุงุฉ ุงููุบุฉ.

### ุงููููุงุช ุงููุชุงุญุฉ:

| ุงูููู | ุงููุธููุฉ | ุงูุฅุตุฏุงุฑ |
|-------|---------|---------|
| `dialect_adapter.py` | ๐ ูุญูู ุงูููุฌุงุช ุงูุนุฑุจูุฉ | 0.4.0 |
| `equation_visualizer.py` | ๐ ุชุตูุฑ ุจุตุฑู ูููุนุงุฏูุงุช | 0.4.0 |
| `bayan_tutor.py` | ๐ ูุธุงู ุชุนูููู ุชูุงุนูู | 0.4.0 |
| `dialogue_system.py` | ๐ค ูุธุงู ุญูุงุฑ ุฐูู | 0.4.0 |
| `extended_istinbat.py` | ๐ง ูุญุฑู ุงุณุชูุจุงุท ููุณุน | 0.4.0 |
| `bayan_baserah_bridge.py` | ๐ ุฌุณุฑ ุจูุงู-ุจุตูุฑุฉ | 0.5.0 |
| `visual_semantic_engine.py` | ๐งฌ ูุญุฑู ุงูุฏูุงูุงุช ุงูุจุตุฑูุฉ | 0.5.0 |

---

### ๐ 1. ูุญูู ุงูููุฌุงุช (`dialect_adapter.py`)

**ุงููุธููุฉ**: ุชุญููู ุงูููุฌุงุช ุงูุนุฑุจูุฉ ุฅูู ุงููุตุญู + ุงูุชุดุงู ุงูููุฌุฉ ุชููุงุฆูุงู

**ุงูููุฌุงุช ุงููุฏุนููุฉ**:
- ๐ช๐ฌ ุงููุตุฑูุฉ: ุนุงูุฒุ ุงุฒุงูุ ุฏูุ ุฏูุ ุงูุจุงุฑุญุ ุฏูููุชู...
- ๐ธ๐ฆ ุงูุฎููุฌูุฉ: ูุจูุ ูุฏูุ ุดูููุ ูููุ ุงูุญููุ ูุงูุฏ...
- ๐ฑ๐ง ุงูุดุงููุฉ: ุจุฏูุ ุดูุ ูููุ ูููุ ูููุ ูููุญ...
- ๐ฒ๐ฆ ุงููุบุฑุจูุฉ: ุจุบูุชุ ูููุงุดุ ุฏุงุจุงุ ุจุฒุงูุ ูุฒูุงู...

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import DialectAdapter

adapter = DialectAdapter()

# ุชุญููู ูู ูุตุฑู
result = adapter.convert_to_standard("ุฃุญูุฏ ุนุงูุฒ ูุงูู ุชูุงุญุฉ")
print(result.converted)  # "ุฃุญูุฏ ูุฑูุฏ ูุงูู ุชูุงุญุฉ"
print(result.dialect)     # Dialect.EGYPTIAN

# ุงูุชุดุงู ุงูููุฌุฉ
dialect, confidence = adapter.detect_dialect("ููู ุญุงูู ูุง ุตุฏููู")
print(dialect)      # Dialect.STANDARD
print(confidence)   # 1.0
```

---

### ๐ 2. ุชุตูุฑ ุงููุนุงุฏูุงุช (`equation_visualizer.py`)

**ุงููุธููุฉ**: ุชุญููู ุงููุนุงุฏูุงุช ุงููุบููุฉ ุฅูู ุฑุณูู SVG ุชูุงุนููุฉ

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import EquationVisualizer, visualize

# ุทุฑููุฉ ุณุฑูุนุฉ
svg = visualize("ุฃุญูุฏ", "ุฃูู", "ุชูุงุญุฉ")

# ุทุฑููุฉ ูุงููุฉ
viz = EquationVisualizer()
svg = viz.visualize_equation(subject="ุฃุญูุฏ", verb="ููุฑุฃ", obj="ูุชุงุจุงู")
viz.save_to_file(svg, "equation.html")

# ุชุตูุฑ ุฎุท ุฒููู
timeline = viz.visualize_timeline([
    ("ุฃุญูุฏ", "ุงุณุชููุธ", None),
    ("ุฃุญูุฏ", "ุดุฑุจ", "ูููุฉ"),
    ("ุฃุญูุฏ", "ุฐูุจ", "ููุนูู"),
])
viz.save_to_file(timeline, "timeline.html")
```

---

### ๐ 3. ุงููุธุงู ุงูุชุนูููู (`bayan_tutor.py`)

**ุงููุธููุฉ**: ูุธุงู ุชุนูููู ุชูุงุนูู ูุชุนูู ุงููุนุงุฏูุงุช ุงููุบููุฉ

**ุงูุฏุฑูุณ ุงููุชุงุญุฉ**:
1. **ููุฏูุฉ ูู ุงููุนุงุฏูุงุช ุงููุบููุฉ** (ูุจุชุฏุฆ) - 3 ุชูุงุฑูู
2. **ุตูุงุบุฉ ุงููุนุงุฏูุงุช ุงููุบููุฉ** (ูุชูุณุท) - 2 ุชูุงุฑูู
3. **ุงูููุฌุงุช ุงูุนุฑุจูุฉ** (ูุชูุณุท) - 3 ุชูุงุฑูู

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import BayanTutor

tutor = BayanTutor()

# ุนุฑุถ ุงูุฏุฑูุณ
for lesson in tutor.list_lessons():
    print(f"โข {lesson['title']} ({lesson['level']})")

# ุจุฏุก ุฏุฑุณ
tutor.start_lesson("intro")

# ุงูุญุตูู ุนูู ุชูุฑูู
exercise = tutor.get_exercise(0)
print(exercise.question)
print(exercise.hint)

# ุงูุชุญูู ูู ุงูุฅุฌุงุจุฉ
result = tutor.check_answer(0, "ูุงุนู + ูุนู โ ููุนูู")
print(result["correct"], result["points"])

# ุนุฑุถ ุงูุชูุฏู
progress = tutor.get_progress()
print(f"ุงูููุงุท: {progress['total_points']}")
print(f"ุงูุฅูุฌุงุฒ: {progress['percentage']}%")
```

---

### ๐ค 4. ูุธุงู ุงูุญูุงุฑ ุงูุฐูู (`dialogue_system.py`)

**ุงููุธููุฉ**: ูุธุงู ูุญุงุฏุซุฉ ุฐูู ูุน ููู ุงูููุงูุง ูุงููุดุงุนุฑ

**ุงููุฏุฑุงุช**:
- ูุดู ุงูููุงูุง: ุชุญูุฉุ ุณุคุงูุ ุทูุจุ ุดูุฑุ ูุฏุงุนุ ุชุนููุ ูุณุงุนุฏุฉ
- ูุดู ุงููุดุงุนุฑ: ุณุนูุฏุ ุญุฒููุ ุบุงุถุจุ ูุถูููุ ูุฑุชุจู
- ุฐุงูุฑุฉ ุณูุงููุฉ: ุชุฐูุฑ ุงุณู ุงููุณุชุฎุฏู ูุชุงุฑูุฎ ุงููุญุงุฏุซุฉ
- ุฑุฏูุฏ ูุฎุตุตุฉ ุญุณุจ ุงูุณูุงู

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import IntelligentDialogueSystem

system = IntelligentDialogueSystem()

# ูุญุงุฏุซุฉ
response = system.chat("ูุฑุญุจุงู")
print(response)  # "ูุฑุญุจุงู! ุณุนูุฏ ุจุงูุชุญุฏุซ ูุนู."

response = system.chat("ุฃูุง ูุญูุฏ")
print(response)  # "ุฃููู. ูู ููููู ุชูุถูุญ ุงููุฒูุฏุ"

response = system.chat("ูุฑุญุจุงู ูุฑุฉ ุฃุฎุฑู")
print(response)  # "ุฃููุงู ูุญูุฏ! ููู ูููููู ูุณุงุนุฏุชูุ"

response = system.chat("ูุน ุงูุณูุงูุฉ")
print(response)  # "ูุน ุงูุณูุงูุฉ ูุญูุฏ! ุฃุชููู ูู ูููุงู ุณุนูุฏุงู."

# ููุฎุต ุงูุฌูุณุฉ
summary = system.get_context_summary()
print(summary)
```

---

### ๐ง 5. ูุญุฑู ุงูุงุณุชูุจุงุท ุงูููุณุน (`extended_istinbat.py`)

**ุงููุธููุฉ**: ูุญุฑู ุงุณุชูุจุงุท ูุฏุนู ุงูููุฌุงุช ุงูุนุฑุจูุฉ

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import ExtendedIstinbatEngine

engine = ExtendedIstinbatEngine()

# ูุญูู ุชููุงุฆูุงู ูู ุงูุนุงููุฉ ูููุตุญู ูุจู ุงูุชุญููู
result = engine.process("ุฃุญูุฏ ุนุงูุฒ ูุงูู ุชูุงุญุฉ")
print(result.original)   # "ุฃุญูุฏ ุนุงูุฒ ูุงูู ุชูุงุญุฉ"
print(result.processed)  # "ุฃุญูุฏ ูุฑูุฏ ูุงูู ุชูุงุญุฉ"
print(result.dialect)    # "egyptian"
```

---

### ๐ 6. ุฌุณุฑ ุจูุงู-ุจุตูุฑุฉ (`bayan_baserah_bridge.py`)

> **ุฌุฏูุฏ ูู ุงูุฅุตุฏุงุฑ 0.5.0**

**ุงููุธููุฉ**: ุฑุจุท ุณูููุงุฆูุฉ ุงูุญุฑูู ูู ุจูุงู ูุน ูุนุงุฏูุงุช ุงูุฃุดูุงู ูู ุจุตูุฑุฉ

**ุงููุธุฑูุงุช ุงููุทุจูุฉ**:
- ุซูุงุฆูุฉ ุงูุตูุฑ: ูู ุญุฑู ูู ุถุฏ
- ุชุนุงูุฏ ุงูุฃุถุฏุงุฏ: ุงูุฃุถุฏุงุฏ ุชุชุนุงูุฏ ุจุฒุงููุฉ 90ยฐ
- ูุธุฑูุฉ ุงูุฎููุท: ุงูุญุฑูู ูุฑุชุจุทุฉ ุจุฎููุท ูุนูููุฉ

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import BayanBaserahBridge, create_bridge

bridge = create_bridge()

# ุชุญููู ุญุฑู ุจุตุฑูุงู
analysis = bridge.analyze_letter_visually("ุน")
print(analysis.shape_type.value)  # "ููุชูุญ"
print(analysis.semantic_meanings)  # ['ุงูุนูู', 'ุงูุฑุคูุฉ', 'ุงูุนูู']

# ุชุญููู ุญุฑู ุฅูู ูุนุงุฏูุฉ
eq = bridge.letter_to_equation("ุจ")
print(eq['equation'])  # "y = 1 / (1 + e^(-2.0*x))"
print(eq['equation_type'])  # "sigmoid"

# ููุงุฑูุฉ ุญุฑููู
comparison = bridge.compare_letters_visually("ุจ", "ุช")
print(comparison['overall_similarity'])  # 0.67
print(comparison['relationship'])  # "ูุชุดุงุจูุงู"

# ุฅูุฌุงุฏ ุงูุญุฑู ุงููุถุงุฏ
opposite = bridge.find_opposite_letter("ุง")
print(opposite['opposite_letters'])  # ['ุจ', 'ุช', 'ุซ']
```

---

### ๐งฌ 7. ูุญุฑู ุงูุฏูุงูุงุช ุงูุจุตุฑูุฉ (`visual_semantic_engine.py`)

> **ุฌุฏูุฏ ูู ุงูุฅุตุฏุงุฑ 0.5.0**

**ุงููุธููุฉ**: ุชุทุจูู ูุธุฑูุงุช ุจุตูุฑุฉ ุงูุซูุงุซ ุนูู ุณูููุงุฆูุฉ ุงูุญุฑูู

**ุงูุงุณุชุฎุฏุงู**:
```python
from extensions import VisualSemanticEngine

engine = VisualSemanticEngine()

# ุชุทุจูู ุซูุงุฆูุฉ ุงูุตูุฑ
duality = engine.apply_zero_duality("ุน")
print(duality['position'])  # (0.2, 0.7, 0.9)
print(duality['closest_opposite_letter'])  # "ู"

# ุชุทุจูู ุชุนุงูุฏ ุงูุฃุถุฏุงุฏ
perp = engine.apply_perpendicularity("ุง", "ุจ")
print(perp['angle_degrees'])  # 63.43
print(perp['is_perpendicular'])  # False

# ุชุทุจูู ูุธุฑูุฉ ุงูุฎููุท
filament = engine.apply_filament_theory("ุจูุงู")
print(filament['cohesion'])  # 0.313
print(filament['interpretation'])  # "ุชูุงุณู ููุฎูุถ..."

# ุชุญููู ุดุงูู
full = engine.full_analysis("ุนูู")
print(full['visual_analysis']['meanings'])
print(full['filament_theory']['cohesion'])
print(full['space_interpretation'])
```

---

### ๐ฆ ุงุณุชูุฑุงุฏ ุงููู

```python
from extensions import (
    # ุงูููุฌุงุช
    DialectAdapter, Dialect, ConversionResult,
    ExtendedIstinbatEngine,

    # ุงูุชุตูุฑ
    EquationVisualizer, visualize,

    # ุงูุชุนููู
    BayanTutor, start_tutorial, Lesson, Exercise,

    # ุงูุญูุงุฑ
    IntelligentDialogueSystem, Intent, Emotion, chat,

    # ๐ ุฌุณุฑ ุจูุงู-ุจุตูุฑุฉ (ุฌุฏูุฏ ูู 0.5.0)
    BayanBaserahBridge, LetterShapeType, LetterVisualAnalysis,
    LETTER_SHAPE_EQUATIONS, SHAPE_MEANING_BRIDGE, create_bridge,

    # ๐งฌ ูุญุฑู ุงูุฏูุงูุงุช ุงูุจุตุฑูุฉ (ุฌุฏูุฏ ูู 0.5.0)
    VisualSemanticEngine, SemanticVector,
)
```

---

### ๐ฅ๏ธ ุฃูุงูุฑ CLI

ุงูุฃูุงูุฑ ูุชุงุญุฉ ูู `bayan_cli.py`:

| ุงูุฃูุฑ | ุงููุตู |
|-------|-------|
| `dialects` | ุนุฑุถ ุงูููุฌุงุช ุงููุฏุนููุฉ |
| `convert <text>` | ุชุญููู ูุต ูู ููุฌุฉ ูููุตุญู |
| `detect <text>` | ุงูุชุดุงู ููุฌุฉ ูุต |
| `visualize <sentence>` | ุชุตูุฑ ุจุตุฑู ูููุนุงุฏูุฉ |
| `learn` | ุจุฏุก ุงูุฏุฑูุณ ุงูุชูุงุนููุฉ |
| `progress` | ุนุฑุถ ุชูุฏู ุงูุชุนูู |
| `chat` | ูุถุน ุงููุญุงุฏุซุฉ ุงูุฐููุฉ |
| `baserah <ูููุฉ>` | ๐๏ธ ุชุญููู ุจุตุฑู-ุฏูุงูู (ุจุตูุฑุฉ) |
| `letter <ุญุฑู>` | ๐ ุชุญููู ุญุฑู ุจุตุฑูุงู |
| `compare <ุญ1> <ุญ2>` | ๐ ููุงุฑูุฉ ุญุฑููู |

---

## ๐ง ุฅูุดุงุก ุทุจูุฉ ุฌุฏูุฏุฉ

### ุงูููุท ุงูุฃุณุงุณู:

```python
# ููู: bayan/bayan/nlp_extension.py

"""
ุฅุถุงูุฉ ุฏูุงู NLP ููููุณุฑ
NLP Extension for Bayan Interpreter
================================================

ูุฐุง ุงูููู ูุถูู ุฏูุงู ูุนุงูุฌุฉ ุงููุบุฉ ุงูุทุจูุนูุฉ ููููุณุฑ ุจุฏูู ุชุนุฏูู ุงูููุณุฑ ุงูุฃุตูู.

ุงูุงุณุชุฎุฏุงู:
    from bayan.nlp_extension import register_nlp_functions
    register_nlp_functions(interpreter)

ุฃู ุชููุงุฆูุงู:
    from bayan.nlp_extension import create_nlp_enhanced_interpreter
    interpreter = create_nlp_enhanced_interpreter()
"""

from typing import Dict, Any, List, Optional


def register_nlp_functions(interpreter) -> bool:
    """
    ุชุณุฌูู ุฏูุงู NLP ูู ุงูููุณุฑ
    
    Args:
        interpreter: ุงูููุณุฑ (TraditionalInterpreter ุฃู HybridInterpreter)
    
    Returns:
        True ุฅุฐุง ูุฌุญ ุงูุชุณุฌููุ False ุฅุฐุง ูุดู
    """
    
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # 1. ุงูุญุตูู ุนูู global_env
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    
    if hasattr(interpreter, 'global_env'):
        env = interpreter.global_env
    elif hasattr(interpreter, 'traditional') and hasattr(interpreter.traditional, 'global_env'):
        env = interpreter.traditional.global_env
    else:
        print("โ๏ธ ุชุญุฐูุฑ: ูุง ูููู ุงูุนุซูุฑ ุนูู global_env ูู ุงูููุณุฑ")
        return False
    
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # 2. ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช ุงููุทููุจุฉ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    
    try:
        from .istinbat_engine import IstinbatEngine
        from .linguistic_equation import LinguisticEquationParser, KnowledgeBase
        from .arabic_adapter import ArabicNLPAdapter
    except ImportError as e:
        print(f"โ๏ธ ุชุญุฐูุฑ: ูู ูุชู ุชุญููู ููุชุจุงุช NLP: {e}")
        return False
    
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # 3. ุชููุฆุฉ ูุณููุฉ (Lazy Initialization)
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    
    _cache = {}
    
    def _get_istinbat_engine():
        if 'istinbat' not in _cache:
            _cache['istinbat'] = IstinbatEngine()
        return _cache['istinbat']
    
    def _get_knowledge_base():
        if 'kb' not in _cache:
            _cache['kb'] = KnowledgeBase()
        return _cache['kb']
    
    def _get_parser():
        if 'parser' not in _cache:
            kb = _get_knowledge_base()
            _cache['parser'] = LinguisticEquationParser(kb)
        return _cache['parser']
    
    def _get_arabic_adapter():
        if 'arabic' not in _cache:
            _cache['arabic'] = ArabicNLPAdapter()
        return _cache['arabic']
    
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # 4. ุชุนุฑูู ุงูุฏูุงู ุงูุฌุฏูุฏุฉ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    
    def analyze_sentence(sentence: str) -> Dict[str, Any]:
        """
        ุชุญููู ุฌููุฉ ุนุฑุจูุฉ
        Analyze an Arabic sentence
        
        ูุซุงู: ุญูู_ุฌููุฉ("ุฃุญูุฏ ุถุฑุจ ุงููุฑุฉ")
        """
        engine = _get_istinbat_engine()
        result = engine.process(sentence)
        
        if result:
            return {
                'sentence': sentence,
                'ุงูุฌููุฉ': sentence,
                'event': result.equation.event,
                'ุงูุญุฏุซ': result.equation.event,
                'entities': list(result.equation.entities.keys()),
                'ุงูููุงูุงุช': list(result.equation.entities.keys()),
                'consequences': [
                    {
                        'entity': c.entity_name,
                        'changes': c.state_changes
                    }
                    for c in result.consequences
                ],
                'ุงููุชุงุฆุฌ': [
                    {
                        'ููุงู': c.entity_name,
                        'ุชุบููุฑุงุช': c.state_changes
                    }
                    for c in result.consequences
                ]
            }
        else:
            return {
                'error': 'ูุดู ุงูุชุญููู',
                'sentence': sentence
            }
    
    # ุชุณุฌูู ุงูุฏุงูุฉ
    env['analyze_sentence'] = analyze_sentence
    env['ุญูู_ุฌููุฉ'] = analyze_sentence
    
    def extract_root(word: str) -> Dict[str, Any]:
        """
        ุงุณุชุฎุฑุงุฌ ุฌุฐุฑ ูููุฉ ุนุฑุจูุฉ
        Extract root of an Arabic word
        
        ูุซุงู: ุงุณุชุฎุฑุฌ_ุฌุฐุฑ("ูุฏุฑุณุฉ")
        """
        adapter = _get_arabic_adapter()
        root = adapter.extract_root(word)
        
        return {
            'word': word,
            'ุงููููุฉ': word,
            'root': root,
            'ุงูุฌุฐุฑ': root
        }
    
    env['extract_root'] = extract_root
    env['ุงุณุชุฎุฑุฌ_ุฌุฐุฑ'] = extract_root
    
    def add_verb(verb: str, subject_effects: Dict, object_effects: Dict = None) -> bool:
        """
        ุฅุถุงูุฉ ูุนู ุฌุฏูุฏ ููุงุนุฏุฉ ุงููุนุฑูุฉ
        Add a new verb to the knowledge base
        
        ูุซุงู: ุฃุถู_ูุนู("ููุนุจ", {"ุณุนุงุฏุฉ": 0.5}, {"ุงุณุชุฎุฏุงู": 1.0})
        """
        kb = _get_knowledge_base()
        kb.add_custom_event(verb, subject_effects, object_effects or {})
        return True
    
    env['add_verb'] = add_verb
    env['ุฃุถู_ูุนู'] = add_verb
    
    def list_verbs() -> List[str]:
        """
        ุนุฑุถ ุฌููุน ุงูุฃูุนุงู ุงููุชุงุญุฉ
        List all available verbs
        
        ูุซุงู: ุงุนุฑุถ_ุงูุฃูุนุงู()
        """
        kb = _get_knowledge_base()
        return list(kb.event_outcomes.keys())
    
    env['list_verbs'] = list_verbs
    env['ุงุนุฑุถ_ุงูุฃูุนุงู'] = list_verbs
    
    def conjugate_verb(lemma: str, tense: str, person: str) -> str:
        """
        ุชุตุฑูู ูุนู ุนุฑุจู
        Conjugate an Arabic verb
        
        ูุซุงู: ุตุฑูู_ูุนู("ูุชุจ", "present", "3ms")
        """
        adapter = _get_arabic_adapter()
        return adapter.conjugate_verb(lemma, tense, person)
    
    env['conjugate_verb'] = conjugate_verb
    env['ุตุฑูู_ูุนู'] = conjugate_verb
    
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # 5. ุฑุณุงูุฉ ูุฌุงุญ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    
    print("โ ุชู ุชุณุฌูู ุฏูุงู NLP ุจูุฌุงุญ")
    return True


def create_nlp_enhanced_interpreter(use_hybrid: bool = True):
    """
    ุฅูุดุงุก ููุณุฑ ูุญุณูู ูุน ุฏูุงู NLP
    
    Args:
        use_hybrid: ุงุณุชุฎุฏุงู ุงูููุณุฑ ุงููุฌูู (True) ุฃู ุงูุชูููุฏู (False)
    
    Returns:
        ุงูููุณุฑ ูุน ุงูุฏูุงู ุงููุถุงูุฉ
    """
    if use_hybrid:
        from .hybrid_interpreter import HybridInterpreter
        interpreter = HybridInterpreter()
    else:
        from .traditional_interpreter import TraditionalInterpreter
        interpreter = TraditionalInterpreter()
    
    register_nlp_functions(interpreter)
    return interpreter
```

---

## ๐ฏ ุงูุงุณุชุฎุฏุงู

### ุงูุทุฑููุฉ 1: ูู ููุฏ Python

```python
from bayan.bayan.nlp_extension import create_nlp_enhanced_interpreter

# ุฅูุดุงุก ููุณุฑ ูุญุณูู
interpreter = create_nlp_enhanced_interpreter()

# ุชุดุบูู ููุฏ ุจูุงู
code = """
hybrid {
    result = ุญูู_ุฌููุฉ("ุฃุญูุฏ ุถุฑุจ ุงููุฑุฉ")
    print(result)
    
    root = ุงุณุชุฎุฑุฌ_ุฌุฐุฑ("ูุฏุฑุณุฉ")
    print(root)
    
    ุฃุถู_ูุนู("ููุนุจ", {"ุณุนุงุฏุฉ": 0.5}, {"ุงุณุชุฎุฏุงู": 1.0})
    
    verbs = ุงุนุฑุถ_ุงูุฃูุนุงู()
    print(verbs)
}
"""

from bayan.bayan.lexer import HybridLexer
from bayan.bayan.parser import HybridParser

lexer = HybridLexer(code)
tokens = lexer.tokenize()
parser = HybridParser(tokens)
ast = parser.parse()
interpreter.interpret(ast)
```

### ุงูุทุฑููุฉ 2: ูู ููู ุจูุงู

```bayan
# ููู: test_nlp.bayan

hybrid {
    # ุชุญููู ุฌููุฉ
    result = ุญูู_ุฌููุฉ("ูุญูุฏ ูุฏุฑุณ ุงูุจุฑูุฌุฉ")
    print("ุงูุญุฏุซ:", result["ุงูุญุฏุซ"])
    print("ุงูููุงูุงุช:", result["ุงูููุงูุงุช"])
    
    # ุงุณุชุฎุฑุงุฌ ุฌุฐุฑ
    root = ุงุณุชุฎุฑุฌ_ุฌุฐุฑ("ููุชุจุฉ")
    print("ุงูุฌุฐุฑ:", root["ุงูุฌุฐุฑ"])
    
    # ุฅุถุงูุฉ ูุนู ุฌุฏูุฏ
    ุฃุถู_ูุนู("ููุนุจ", {"ุณุนุงุฏุฉ": 0.5, "ุทุงูุฉ": -0.2}, {"ุงุณุชุฎุฏุงู": 1.0})
    
    # ุชุญููู ูุน ุงููุนู ุงูุฌุฏูุฏ
    result2 = ุญูู_ุฌููุฉ("ุฎุงูุฏ ููุนุจ ุงููุฑุฉ")
    print("ุงููุชุงุฆุฌ:", result2["ุงููุชุงุฆุฌ"])
}
```

**ุชุดุบูู**:
```bash
python -c "
from bayan.bayan.nlp_extension import create_nlp_enhanced_interpreter
from bayan.bayan.lexer import HybridLexer
from bayan.bayan.parser import HybridParser

interpreter = create_nlp_enhanced_interpreter()

with open('test_nlp.bayan', 'r') as f:
    code = f.read()

lexer = HybridLexer(code)
tokens = lexer.tokenize()
parser = HybridParser(tokens)
ast = parser.parse()
interpreter.interpret(ast)
"
```

---

## ๐ ููุงุฑูุฉ ุงูุทุฑู

| ุงูุทุฑููุฉ | ุงููููุฒุงุช | ุงูุนููุจ |
|---------|----------|--------|
| **ุชุนุฏูู ุงูููุณุฑ ูุจุงุดุฑุฉ** | ุฃุณุฑุน ููููุงู | โ ุงููููุงุช ููููุฉ |
| **ุงูุทุจูุฉ ุงููุณูุทุฉ** | โ ูุง ุชุนุฏูู ูููููุงุช ุงูุฃุตููุฉ<br>โ ุณูู ุงูุตูุงูุฉ<br>โ ูุงุจู ููุชูุณุน | ุจุทุก ุทููู ุฌุฏุงู |
| **ุณูุฑูุจุช ูููุตู** | โ ุณูู ุงููุชุงุจุฉ | โ ุบูุฑ ูุฏูุฌ ูุน ุงูููุณุฑ<br>โ ูุง ูููู ุงุณุชุฎุฏุงูู ูู ููุฏ ุจูุงู |

---

## โ ูุงุฆูุฉ ุงูุชุญูู

ุนูุฏ ุฅูุดุงุก ุทุจูุฉ ูุณูุทุฉ ุฌุฏูุฏุฉ:

- [ ] ุฅูุดุงุก ููู `*_extension.py` ูู `bayan/bayan/`
- [ ] ุชุนุฑูู ุฏุงูุฉ `register_*_functions(interpreter)`
- [ ] ุงูุญุตูู ุนูู `global_env` ูู ุงูููุณุฑ
- [ ] ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช ุงููุทููุจุฉ ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- [ ] ุชููุฆุฉ ูุณููุฉ ููููุชุจุงุช ุงูุซูููุฉ
- [ ] ุชุนุฑูู ุงูุฏูุงู ุงูุฌุฏูุฏุฉ
- [ ] ุชุณุฌูู ุงูุฏูุงู ูู `env`
- [ ] ุฅุถุงูุฉ ุฃุณูุงุก ุนุฑุจูุฉ ูุฅูุฌููุฒูุฉ
- [ ] ุชุนุฑูู ุฏุงูุฉ `create_*_enhanced_interpreter()`
- [ ] ุงุฎุชุจุงุฑ ุงูุฏูุงู
- [ ] ูุชุงุจุฉ ุฃูุซูุฉ

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ุงูููุท ุงูุตุญูุญ:

```
1. ุฅูุดุงุก ููู extension
2. ุชุนุฑูู register_functions()
3. ุฅุถุงูุฉ ุงูุฏูุงู ุฅูู global_env
4. ุงุณุชุฎุฏุงู ูู ููุฏ ุจูุงู ูุจุงุดุฑุฉ!
```

### ุงูููุงุฆุฏ:

- โ ูุง ุชุนุฏูู ูููููุงุช ุงูุฃุตููุฉ
- โ ุณูู ุงูุตูุงูุฉ ูุงูุชูุณุน
- โ ูููู ุงุณุชุฎุฏุงูู ูู ููุฏ ุจูุงู
- โ ูุฏุนู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ ุชููุฆุฉ ูุณููุฉ ููุฃุฏุงุก

---

## ๐ ููุฎุต ุงูููููุงุช

| ุงููููู | ุงููุฌูุฏ | ุงููุธููุฉ |
|--------|--------|---------|
| **ุงูุทุจูุงุช ุงูุฃุตููุฉ** | `bayan/bayan/` | ุณูููุงุฆูุฉ ุงูุญุฑููุ ุนูู ุจูุงูุ ุงูุจุตูุฑุฉ |
| **ุงูุทุจูุฉ ุงูุฌุฏูุฏุฉ** | `extensions/` | ุงูููุฌุงุชุ ุงูุชุตูุฑุ ุงูุชุนูููุ ุงูุญูุงุฑุ ุงููุณุงุนุฏ ุงูุฐูู |

---

## ๐ค ุงููุณุงุนุฏ ุงูุฐูู ููุจุฑูุฌุฉ (v0.6.0)

ุชู ุฅุถุงูุฉ **ุงููุณุงุนุฏ ุงูุฐูู ููุจุฑูุฌุฉ** ูู ุงูุฅุตุฏุงุฑ 0.6.0:

### ุงูููู: `extensions/ai_code_assistant.py`

| ุงูุฏุงูุฉ | ุงููุตู |
|--------|-------|
| `explain_error()` | ุดุฑุญ ุงูุฃุฎุทุงุก ุจุงูุนุฑุจูุฉ ูุน ุญููู |
| `suggest_completion()` | ุฅููุงู ุงูููุฏ ุงูุฐูู |
| `suggest_optimization()` | ุงูุชุฑุงุญุงุช ุชุญุณูู ุงูุฃุฏุงุก |
| `analyze_code()` | ุชุญููู ุดุงูู ููููุฏ |
| `generate_code()` | ุชูููุฏ ููุฏ ูู ูุตู ุทุจูุนู |
| `chat()` | ูุญุงุฏุซุฉ ุชูุงุนููุฉ |

### ุงูุงุณุชุฎุฏุงู:

```python
from extensions import AICodeAssistant

assistant = AICodeAssistant(language="ar")

# ุดุฑุญ ุฎุทุฃ
error = assistant.explain_error("NameError: name 'x' is not defined")
print(error.explanation)

# ุชูููุฏ ููุฏ
code = assistant.generate_code("ุฃูุดุฆ ุฏุงูุฉ ูุญุณุงุจ ุงููุถุฑูุจ")
print(code)
```

ููุชูุงุตูู ุงููุงููุฉ: [docs/AI_CODE_ASSISTANT_API.md](docs/AI_CODE_ASSISTANT_API.md)

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-06
**ุงูุฅุตุฏุงุฑ**: 0.6.0
**ุงูุญุงูุฉ**: ุฏููู ุดุงูู
**ุงููุคูู**: ูุฑูู ุชุทููุฑ ุจูุงู
