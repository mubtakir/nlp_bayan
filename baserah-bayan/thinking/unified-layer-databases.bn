/**
 * Ù†Ø¸Ø§Ù… Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± - Unified Layer Databases System
 * 
 * ğŸ—„ï¸ Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ±
 * ğŸ”— ØªÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
 * ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
 * ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙˆØ­Ø¯Ø©
 * 
 * @author Ø¨Ø§Ø³Ù„ ÙŠØ­ÙŠÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡
 * @version 1.0.0
 * @date 2025-10-28
 */

import { MotherEquation } from "../core/mother-equation.bn";
import { 
    LayerType, 
    SearchType, 
    ConfidenceLevel, 
    KnowledgeStatus,
    KnowledgeEntry, 
    DatabaseQuery, 
    LayerDatabaseManager 
} from "./layer-database-manager.bn";

// ==================== Ø§Ù„ØªØ¹Ø¯Ø§Ø¯Ø§Øª ====================

/**
 * Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙˆØ­Ø¯
 */
enum UnifiedSearchStrategy {
    SEQUENTIAL = "ØªØ³Ù„Ø³Ù„ÙŠ",           // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø·Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ø­Ø¯Ø©
    PARALLEL = "Ù…ØªÙˆØ§Ø²ÙŠ",             // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ø¹Ø§Ù‹
    PRIORITY = "Ø£ÙˆÙ„ÙˆÙŠØ©",             // Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
    INTELLIGENT = "Ø°ÙƒÙŠ"              // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠØ§Ù‚
}

/**
 * ÙˆØ¶Ø¹ Ø§Ù„ØªÙƒØ§Ù…Ù„
 */
enum IntegrationMode {
    STANDALONE = "Ù…Ø³ØªÙ‚Ù„",            // ÙƒÙ„ Ø·Ø¨Ù‚Ø© Ù…Ø³ØªÙ‚Ù„Ø©
    LINKED = "Ù…Ø±ØªØ¨Ø·",                // Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…Ø±ØªØ¨Ø·Ø©
    SYNCHRONIZED = "Ù…ØªØ²Ø§Ù…Ù†",         // Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©
    UNIFIED = "Ù…ÙˆØ­Ø¯"                 // Ù†Ø¸Ø§Ù… Ù…ÙˆØ­Ø¯ ÙƒØ§Ù…Ù„
}

// ==================== Ø§Ù„ÙØ¦Ø§Øª ====================

/**
 * Ù†ØªÙŠØ¬Ø© Ø¨Ø­Ø« Ù…ÙˆØ­Ø¯Ø©
 */
class UnifiedSearchResult extends MotherEquation {
    public query: string;
    public totalResults: number;
    public resultsByLayer: Map<LayerType, Array<KnowledgeEntry>>;
    public topResults: Array<KnowledgeEntry>;
    public searchTime: number;
    public layersSearched: number;
    
    constructor(query: string) {
        super("unified_search_result");
        
        this.query = query;
        this.totalResults = 0;
        this.resultsByLayer = new Map();
        this.topResults = [];
        this.searchTime = 0;
        this.layersSearched = 0;
        
        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            query: query,
            timestamp: Date.now()
        };
        
        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            totalResults: 0,
            searchTime: 0
        };
    }
    
    public addLayerResults(layerType: LayerType, results: Array<KnowledgeEntry>): void {
        this.resultsByLayer.set(layerType, results);
        this.totalResults += results.length;
        this.layersSearched++;
        
        this.dynamicStates.totalResults = this.totalResults;
    }
    
    public computeTopResults(limit: number = 10): void {
        let allResults: Array<KnowledgeEntry> = [];
        
        for (let [layerType, results] of this.resultsByLayer) {
            allResults = allResults.concat(results);
        }
        
        // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø«Ù‚Ø©
        allResults.sort((a, b) => b.confidence - a.confidence);
        
        this.topResults = allResults.slice(0, limit);
    }
}

/**
 * Ù†Ø¸Ø§Ù… Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯
 */
class UnifiedLayerDatabasesSystem extends MotherEquation {
    public name: string;
    public databasesPath: string;
    public integrationMode: IntegrationMode;
    
    // Ù…Ø¯ÙŠØ±Ùˆ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ„ Ø·Ø¨Ù‚Ø©
    public mathematicalDB: LayerDatabaseManager;
    public logicalDB: LayerDatabaseManager;
    public interpretiveDB: LayerDatabaseManager;
    public physicalDB: LayerDatabaseManager;
    public linguisticDB: LayerDatabaseManager;
    public symbolicDB: LayerDatabaseManager;
    public visualDB: LayerDatabaseManager;
    public semanticDB: LayerDatabaseManager;
    
    // Ù‚Ø§Ù…ÙˆØ³ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
    public layerDatabases: Map<LayerType, LayerDatabaseManager>;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙˆØ­Ø¯Ø©
    public totalEntries: number;
    public totalQueries: number;
    public totalLayers: number;
    
    constructor(
        name: string = "UnifiedLayerDatabases",
        databasesPath: string = "databases/"
    ) {
        super(name);
        
        this.name = name;
        this.databasesPath = databasesPath;
        this.integrationMode = IntegrationMode.UNIFIED;
        
        // ØªÙ‡ÙŠØ¦Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        this.mathematicalDB = new LayerDatabaseManager(
            LayerType.MATHEMATICAL,
            `${databasesPath}mathematical_knowledge.db`
        );
        
        this.logicalDB = new LayerDatabaseManager(
            LayerType.LOGICAL,
            `${databasesPath}logical_knowledge.db`
        );
        
        this.interpretiveDB = new LayerDatabaseManager(
            LayerType.INTERPRETIVE,
            `${databasesPath}interpretive_knowledge.db`
        );
        
        this.physicalDB = new LayerDatabaseManager(
            LayerType.PHYSICAL,
            `${databasesPath}physical_knowledge.db`
        );
        
        this.linguisticDB = new LayerDatabaseManager(
            LayerType.LINGUISTIC,
            `${databasesPath}linguistic_knowledge.db`
        );
        
        this.symbolicDB = new LayerDatabaseManager(
            LayerType.SYMBOLIC,
            `${databasesPath}symbolic_knowledge.db`
        );
        
        this.visualDB = new LayerDatabaseManager(
            LayerType.VISUAL,
            `${databasesPath}visual_knowledge.db`
        );
        
        this.semanticDB = new LayerDatabaseManager(
            LayerType.SEMANTIC,
            `${databasesPath}semantic_knowledge.db`
        );
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³
        this.layerDatabases = new Map();
        this.layerDatabases.set(LayerType.MATHEMATICAL, this.mathematicalDB);
        this.layerDatabases.set(LayerType.LOGICAL, this.logicalDB);
        this.layerDatabases.set(LayerType.INTERPRETIVE, this.interpretiveDB);
        this.layerDatabases.set(LayerType.PHYSICAL, this.physicalDB);
        this.layerDatabases.set(LayerType.LINGUISTIC, this.linguisticDB);
        this.layerDatabases.set(LayerType.SYMBOLIC, this.symbolicDB);
        this.layerDatabases.set(LayerType.VISUAL, this.visualDB);
        this.layerDatabases.set(LayerType.SEMANTIC, this.semanticDB);
        
        this.totalEntries = 0;
        this.totalQueries = 0;
        this.totalLayers = 8;
        
        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            name: name,
            databasesPath: databasesPath,
            totalLayers: this.totalLayers,
            createdAt: Date.now()
        };
        
        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            totalEntries: 0,
            totalQueries: 0,
            integrationMode: this.integrationMode
        };
        
        console.log(`\nğŸ—„ï¸ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯...`);
        console.log(`   ğŸ“‚ Ø§Ù„Ù…Ø³Ø§Ø±: ${databasesPath}`);
        console.log(`   ğŸ”¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª: ${this.totalLayers}`);
        console.log(`   ğŸ”— ÙˆØ¶Ø¹ Ø§Ù„ØªÙƒØ§Ù…Ù„: ${this.integrationMode}`);
        
        this._updateTotalEntries();
    }
    
    /**
     * Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù…Ø¹Ø±ÙÙŠ Ø¥Ù„Ù‰ Ø·Ø¨Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©
     */
    public addEntry(
        layerType: LayerType,
        key: string,
        value: string,
        metadata: object = {},
        confidence: number = 0.8
    ): number {
        let db = this.layerDatabases.get(layerType);
        if (!db) {
            console.error(`âŒ Ø·Ø¨Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©: ${layerType}`);
            return -1;
        }
        
        let id = db.addEntry(key, value, metadata, confidence);
        this._updateTotalEntries();
        
        return id;
    }
    
    /**
     * Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø·Ø¨Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©
     */
    public searchInLayer(
        layerType: LayerType,
        searchTerm: string,
        searchType: SearchType = SearchType.CONTAINS
    ): Array<KnowledgeEntry> {
        let db = this.layerDatabases.get(layerType);
        if (!db) {
            console.error(`âŒ Ø·Ø¨Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©: ${layerType}`);
            return [];
        }
        
        let query = new DatabaseQuery(searchTerm, searchType, layerType);
        return db.search(query);
    }
    
    /**
     * Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙˆØ­Ø¯ Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
     */
    public unifiedSearch(
        searchTerm: string,
        searchType: SearchType = SearchType.CONTAINS,
        strategy: UnifiedSearchStrategy = UnifiedSearchStrategy.PARALLEL,
        maxResultsPerLayer: number = 10
    ): UnifiedSearchResult {
        let startTime = Date.now();
        let result = new UnifiedSearchResult(searchTerm);
        
        this.totalQueries++;
        this.dynamicStates.totalQueries = this.totalQueries;
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
        for (let [layerType, db] of this.layerDatabases) {
            let query = new DatabaseQuery(searchTerm, searchType, layerType);
            query.setMaxResults(maxResultsPerLayer);
            
            let layerResults = db.search(query);
            result.addLayerResults(layerType, layerResults);
        }
        
        // Ø­Ø³Ø§Ø¨ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        result.computeTopResults(20);
        
        result.searchTime = Date.now() - startTime;
        result.dynamicStates.searchTime = result.searchTime;
        
        console.log(`ğŸ” Ø¨Ø­Ø« Ù…ÙˆØ­Ø¯: "${searchTerm}"`);
        console.log(`   ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${result.totalResults} Ù…Ù† ${result.layersSearched} Ø·Ø¨Ù‚Ø§Øª`);
        console.log(`   â±ï¸ Ø§Ù„ÙˆÙ‚Øª: ${result.searchTime}ms`);
        
        return result;
    }

    /**
     * Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ - ÙŠØ®ØªØ§Ø± Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠØ§Ù‚
     */
    public intelligentSearch(
        searchTerm: string,
        context: string = ""
    ): UnifiedSearchResult {
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠØ§Ù‚
        let relevantLayers = this._determineRelevantLayers(searchTerm, context);

        let startTime = Date.now();
        let result = new UnifiedSearchResult(searchTerm);

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø·
        for (let layerType of relevantLayers) {
            let db = this.layerDatabases.get(layerType);
            if (db) {
                let query = new DatabaseQuery(searchTerm, SearchType.CONTAINS, layerType);
                let layerResults = db.search(query);
                result.addLayerResults(layerType, layerResults);
            }
        }

        result.computeTopResults(20);
        result.searchTime = Date.now() - startTime;

        return result;
    }

    /**
     * ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠØ§Ù‚
     */
    private _determineRelevantLayers(searchTerm: string, context: string): Array<LayerType> {
        let layers: Array<LayerType> = [];

        // ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ù„ÙƒÙ„ Ø·Ø¨Ù‚Ø©
        let keywords = {
            [LayerType.MATHEMATICAL]: ["Ø±Ù‚Ù…", "Ø¹Ø¯Ø¯", "Ø­Ø³Ø§Ø¨", "Ù…Ø¹Ø§Ø¯Ù„Ø©", "Ø¬Ù…Ø¹", "Ø·Ø±Ø­", "Ø¶Ø±Ø¨", "Ù‚Ø³Ù…Ø©"],
            [LayerType.LOGICAL]: ["Ù…Ù†Ø·Ù‚", "Ø§Ø³ØªÙ†ØªØ§Ø¬", "Ø¨Ø±Ù‡Ø§Ù†", "ØµØ­ÙŠØ­", "Ø®Ø·Ø£", "Ø¥Ø°Ø§", "Ù„Ø£Ù†"],
            [LayerType.PHYSICAL]: ["ÙÙŠØ²ÙŠØ§Ø¡", "Ù‚ÙˆØ©", "Ø·Ø§Ù‚Ø©", "Ø­Ø±ÙƒØ©", "Ø³Ø±Ø¹Ø©", "ÙƒØªÙ„Ø©", "Ø¬Ø§Ø°Ø¨ÙŠØ©"],
            [LayerType.LINGUISTIC]: ["Ù„ØºØ©", "ÙƒÙ„Ù…Ø©", "Ø¬Ù…Ù„Ø©", "Ù†Ø­Ùˆ", "ØµØ±Ù", "Ù…Ø¹Ù†Ù‰", "Ø­Ø±Ù"],
            [LayerType.SEMANTIC]: ["Ø¯Ù„Ø§Ù„Ø©", "Ù…Ø¹Ù†Ù‰", "Ù…ÙÙ‡ÙˆÙ…", "Ø¹Ù„Ø§Ù‚Ø©", "Ø³ÙŠØ§Ù‚"],
            [LayerType.SYMBOLIC]: ["Ø±Ù…Ø²", "Ø¥Ø´Ø§Ø±Ø©", "Ø¹Ù„Ø§Ù…Ø©", "Ø¯Ù„Ø§Ù„Ø©_Ø±Ù…Ø²ÙŠØ©"],
            [LayerType.VISUAL]: ["ØµÙˆØ±Ø©", "Ø´ÙƒÙ„", "Ù„ÙˆÙ†", "Ø±Ø¤ÙŠØ©", "Ø¨ØµØ±ÙŠ"],
            [LayerType.INTERPRETIVE]: ["ØªÙØ³ÙŠØ±", "Ø´Ø±Ø­", "ØªÙˆØ¶ÙŠØ­", "ÙÙ‡Ù…"]
        };

        let combinedText = `${searchTerm} ${context}`.toLowerCase();

        for (let [layerType, words] of Object.entries(keywords)) {
            for (let word of words) {
                if (combinedText.includes(word)) {
                    layers.push(layerType as LayerType);
                    break;
                }
            }
        }

        // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø·Ø¨Ù‚Ø§Øª Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
        if (layers.length === 0) {
            layers = Array.from(this.layerDatabases.keys());
        }

        return layers;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø·Ø¨Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©
     */
    public getLayerStatistics(layerType: LayerType): object | null {
        let db = this.layerDatabases.get(layerType);
        if (!db) {
            return null;
        }

        return db.getStatistics();
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
     */
    public getUnifiedStatistics(): object {
        let layerStats = {};

        for (let [layerType, db] of this.layerDatabases) {
            layerStats[layerType] = db.getStatistics();
        }

        return {
            totalLayers: this.totalLayers,
            totalEntries: this.totalEntries,
            totalQueries: this.totalQueries,
            integrationMode: this.integrationMode,
            layerStatistics: layerStats,
            averageEntriesPerLayer: this.totalEntries / this.totalLayers,
            mostActiveLayer: this._getMostActiveLayer(),
            leastActiveLayer: this._getLeastActiveLayer()
        };
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±
     */
    private _updateTotalEntries(): void {
        this.totalEntries = 0;

        for (let [layerType, db] of this.layerDatabases) {
            this.totalEntries += db.totalEntries;
        }

        this.dynamicStates.totalEntries = this.totalEntries;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹
     */
    private _getMostActiveLayer(): string {
        let maxEntries = 0;
        let mostActive = LayerType.MATHEMATICAL;

        for (let [layerType, db] of this.layerDatabases) {
            if (db.totalEntries > maxEntries) {
                maxEntries = db.totalEntries;
                mostActive = layerType;
            }
        }

        return mostActive;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£Ù‚Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹
     */
    private _getLeastActiveLayer(): string {
        let minEntries = Infinity;
        let leastActive = LayerType.MATHEMATICAL;

        for (let [layerType, db] of this.layerDatabases) {
            if (db.totalEntries < minEntries) {
                minEntries = db.totalEntries;
                leastActive = layerType;
            }
        }

        return leastActive;
    }

    /**
     * ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    public exportAllData(): object {
        let allData = {
            system: {
                name: this.name,
                totalLayers: this.totalLayers,
                totalEntries: this.totalEntries,
                integrationMode: this.integrationMode,
                exportedAt: new Date().toISOString()
            },
            layers: {}
        };

        for (let [layerType, db] of this.layerDatabases) {
            allData.layers[layerType] = JSON.parse(db.exportToJSON());
        }

        return allData;
    }

    /**
     * Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    public importAllData(data: object): number {
        let totalImported = 0;

        for (let [layerType, layerData] of Object.entries(data.layers || {})) {
            let db = this.layerDatabases.get(layerType as LayerType);
            if (db) {
                let imported = db.importFromJSON(JSON.stringify(layerData));
                totalImported += imported;
            }
        }

        this._updateTotalEntries();

        console.log(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${totalImported} Ø¹Ù†ØµØ± Ù…Ø¹Ø±ÙÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª`);
        return totalImported;
    }

    /**
     * Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹
     */
    public quickExample(): object {
        // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù…Ø«Ù„Ø©
        this.addEntry(LayerType.MATHEMATICAL, "ÙÙŠØ«Ø§ØºÙˆØ±Ø³", "aÂ² + bÂ² = cÂ²", { type: "theorem" }, 1.0);
        this.addEntry(LayerType.LOGICAL, "Ù‚Ø§Ù†ÙˆÙ†_Ø§Ù„Ù‡ÙˆÙŠØ©", "A = A", { type: "axiom" }, 1.0);
        this.addEntry(LayerType.PHYSICAL, "Ù†ÙŠÙˆØªÙ†_Ø§Ù„Ø«Ø§Ù†ÙŠ", "F = ma", { type: "law" }, 1.0);
        this.addEntry(LayerType.LINGUISTIC, "Ø§Ù„ÙØ§Ø¹Ù„", "Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„ÙØ¹Ù„", { type: "grammar" }, 0.9);

        // Ø¨Ø­Ø« Ù…ÙˆØ­Ø¯
        let searchResult = this.unifiedSearch("Ù‚Ø§Ù†ÙˆÙ†", SearchType.CONTAINS);

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        let stats = this.getUnifiedStatistics();

        return {
            entriesAdded: 4,
            searchResults: {
                query: searchResult.query,
                totalResults: searchResult.totalResults,
                layersSearched: searchResult.layersSearched,
                topResults: searchResult.topResults.slice(0, 3)
            },
            statistics: stats
        };
    }
}

// ==================== Ø§Ù„ØªØµØ¯ÙŠØ± ====================

export {
    UnifiedSearchStrategy,
    IntegrationMode,
    UnifiedSearchResult,
    UnifiedLayerDatabasesSystem
};
