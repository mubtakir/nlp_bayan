/**
 * Ù…Ø­Ù„Ù„ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ - Intent Analyzer
 * 
 * ÙŠØ­Ù„Ù„ Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
 * ÙŠØ³ØªØ®Ø±Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
 * ÙŠÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆØ§Ù„Ù…Ù‚ØµØ¯
 * 
 * @version 1.0.0
 * @author Baserah AI Team
 */

import { MotherEquation } from "../core/mother-equation.bn";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ØªØ¹Ø¯Ø§Ø¯Ø§Øª - Enumerations
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
 */
export enum IntentType {
    QUESTION = "QUESTION",              // Ø³Ø¤Ø§Ù„ (Ù…Ø§ØŒ Ù…Ù†ØŒ Ù…ØªÙ‰ØŒ Ø£ÙŠÙ†ØŒ ÙƒÙŠÙØŒ Ù„Ù…Ø§Ø°Ø§)
    REQUEST = "REQUEST",                // Ø·Ù„Ø¨ (Ø§ÙØ¹Ù„ØŒ Ø£Ø±ÙŠØ¯ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ†)
    STATEMENT = "STATEMENT",            // ØªØµØ±ÙŠØ­/Ø¥Ø®Ø¨Ø§Ø± (Ø£Ù†Ø§ØŒ Ù‡Ø°Ø§ØŒ Ø°Ù„Ùƒ)
    COMMAND = "COMMAND",                // Ø£Ù…Ø± (Ø§ÙØ¹Ù„ØŒ Ù‚Ù… Ø¨Ù€ØŒ Ù†ÙØ°)
    GREETING = "GREETING",              // ØªØ­ÙŠØ© (Ù…Ø±Ø­Ø¨Ø§ØŒ Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…)
    FAREWELL = "FAREWELL",              // ÙˆØ¯Ø§Ø¹ (ÙˆØ¯Ø§Ø¹Ø§Ù‹ØŒ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡)
    THANKS = "THANKS",                  // Ø´ÙƒØ± (Ø´ÙƒØ±Ø§Ù‹ØŒ Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§Ù‹)
    APOLOGY = "APOLOGY",                // Ø§Ø¹ØªØ°Ø§Ø± (Ø¢Ø³ÙØŒ Ø¹Ø°Ø±Ø§Ù‹)
    CONFIRMATION = "CONFIRMATION",      // ØªØ£ÙƒÙŠØ¯ (Ù†Ø¹Ù…ØŒ ØµØ­ÙŠØ­ØŒ Ù…ÙˆØ§ÙÙ‚)
    NEGATION = "NEGATION",              // Ù†ÙÙŠ (Ù„Ø§ØŒ Ù„ÙŠØ³ØŒ ØºÙŠØ±)
    OPINION = "OPINION",                // Ø±Ø£ÙŠ (Ø£Ø¹ØªÙ‚Ø¯ØŒ ÙÙŠ Ø±Ø£ÙŠÙŠ)
    EMOTION = "EMOTION",                // Ø¹Ø§Ø·ÙØ© (Ø£Ø­Ø¨ØŒ Ø£ÙƒØ±Ù‡ØŒ Ø£Ø®Ø§Ù)
    SUGGESTION = "SUGGESTION",          // Ø§Ù‚ØªØ±Ø§Ø­ (Ù…Ø§Ø°Ø§ Ø¹Ù†ØŒ Ù„Ù…Ø§Ø°Ø§ Ù„Ø§)
    COMPLAINT = "COMPLAINT",            // Ø´ÙƒÙˆÙ‰ (Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ù„Ø§ ÙŠØ¹Ù…Ù„)
    PRAISE = "PRAISE",                  // Ù…Ø¯Ø­ (Ù…Ù…ØªØ§Ø²ØŒ Ø±Ø§Ø¦Ø¹ØŒ Ø¬ÙŠØ¯)
    CRITICISM = "CRITICISM",            // Ù†Ù‚Ø¯ (Ø³ÙŠØ¡ØŒ Ù„ÙŠØ³ Ø¬ÙŠØ¯Ø§Ù‹)
    UNKNOWN = "UNKNOWN"                 // ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
}

/**
 * Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø© ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙŠØ©
 */
export enum ConfidenceLevel {
    VERY_HIGH = "VERY_HIGH",    // > 90%
    HIGH = "HIGH",              // 70-90%
    MEDIUM = "MEDIUM",          // 50-70%
    LOW = "LOW",                // 30-50%
    VERY_LOW = "VERY_LOW"       // < 30%
}

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
 */
export enum EntityType {
    PERSON = "PERSON",          // Ø´Ø®Øµ
    PLACE = "PLACE",            // Ù…ÙƒØ§Ù†
    TIME = "TIME",              // ÙˆÙ‚Øª
    DATE = "DATE",              // ØªØ§Ø±ÙŠØ®
    NUMBER = "NUMBER",          // Ø±Ù‚Ù…
    OBJECT = "OBJECT",          // Ø´ÙŠØ¡/ÙƒØ§Ø¦Ù†
    CONCEPT = "CONCEPT",        // Ù…ÙÙ‡ÙˆÙ…
    ACTION = "ACTION",          // ÙØ¹Ù„/Ø­Ø¯Ø«
    ATTRIBUTE = "ATTRIBUTE",    // ØµÙØ©
    RELATION = "RELATION",      // Ø¹Ù„Ø§Ù‚Ø©
    TOPIC = "TOPIC",            // Ù…ÙˆØ¶ÙˆØ¹
    EMOTION = "EMOTION",        // Ø¹Ø§Ø·ÙØ©
    UNKNOWN = "UNKNOWN"         // ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
}

/**
 * Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ù„Ù„Ù†ÙˆØ§ÙŠØ§ Ù…Ù† Ù†ÙˆØ¹ QUESTION)
 */
export enum QuestionType {
    WHAT = "WHAT",              // Ù…Ø§/Ù…Ø§Ø°Ø§
    WHO = "WHO",                // Ù…Ù†
    WHEN = "WHEN",              // Ù…ØªÙ‰
    WHERE = "WHERE",            // Ø£ÙŠÙ†
    WHY = "WHY",                // Ù„Ù…Ø§Ø°Ø§/Ù„Ù…
    HOW = "HOW",                // ÙƒÙŠÙ
    WHICH = "WHICH",            // Ø£ÙŠ
    HOW_MANY = "HOW_MANY",      // ÙƒÙ…
    YES_NO = "YES_NO",          // Ù†Ø¹Ù…/Ù„Ø§
    UNKNOWN = "UNKNOWN"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ÙØ¦Ø§Øª - Classes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ÙƒÙŠØ§Ù† Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù†Øµ
 */
export class ExtractedEntity extends MotherEquation {
    type: EntityType;
    value: string;
    startIndex: number;
    endIndex: number;
    confidence: number;
    metadata: Map<string, any>;

    constructor(
        id: string,
        type: EntityType,
        value: string,
        startIndex: number,
        endIndex: number,
        confidence: number = 1.0
    ) {
        super(id);
        this.type = type;
        this.value = value;
        this.startIndex = startIndex;
        this.endIndex = endIndex;
        this.confidence = confidence;
        this.metadata = new Map();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙÙŠØ©
     */
    addMetadata(key: string, value: any): void {
        this.metadata.set(key, value);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙÙŠØ©
     */
    getMetadata(key: string): any {
        return this.metadata.get(key);
    }
}

/**
 * Ù†ÙŠØ© Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ù†Øµ
 */
export class DetectedIntent extends MotherEquation {
    type: IntentType;
    confidence: number;
    questionType: QuestionType | null;
    entities: ExtractedEntity[];
    keywords: string[];
    context: Map<string, any>;
    subIntents: DetectedIntent[];

    constructor(id: string, type: IntentType, confidence: number) {
        super(id);
        this.type = type;
        this.confidence = confidence;
        this.questionType = null;
        this.entities = [];
        this.keywords = [];
        this.context = new Map();
        this.subIntents = [];
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© ÙƒÙŠØ§Ù†
     */
    addEntity(entity: ExtractedEntity): void {
        this.entities.push(entity);
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©
     */
    addKeyword(keyword: string): void {
        if (!this.keywords.includes(keyword)) {
            this.keywords.push(keyword);
        }
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ù‚
     */
    addContext(key: string, value: any): void {
        this.context.set(key, value);
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù†ÙŠØ© ÙØ±Ø¹ÙŠØ©
     */
    addSubIntent(intent: DetectedIntent): void {
        this.subIntents.push(intent);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©
     */
    getConfidenceLevel(): ConfidenceLevel {
        if (this.confidence > 0.9) return ConfidenceLevel.VERY_HIGH;
        if (this.confidence > 0.7) return ConfidenceLevel.HIGH;
        if (this.confidence > 0.5) return ConfidenceLevel.MEDIUM;
        if (this.confidence > 0.3) return ConfidenceLevel.LOW;
        return ConfidenceLevel.VERY_LOW;
    }
}

/**
 * Ù†ØªÙŠØ¬Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙŠØ©
 */
export class IntentAnalysisResult extends MotherEquation {
    inputText: string;
    primaryIntent: DetectedIntent;
    secondaryIntents: DetectedIntent[];
    allEntities: ExtractedEntity[];
    overallConfidence: number;
    processingTime: number;
    metadata: Map<string, any>;

    constructor(id: string, inputText: string) {
        super(id);
        this.inputText = inputText;
        this.primaryIntent = null;
        this.secondaryIntents = [];
        this.allEntities = [];
        this.overallConfidence = 0;
        this.processingTime = 0;
        this.metadata = new Map();
    }

    /**
     * ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
     */
    setPrimaryIntent(intent: DetectedIntent): void {
        this.primaryIntent = intent;
        this.updateOverallConfidence();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠØ©
     */
    addSecondaryIntent(intent: DetectedIntent): void {
        this.secondaryIntents.push(intent);
        this.updateOverallConfidence();
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«Ù‚Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
     */
    private updateOverallConfidence(): void {
        if (!this.primaryIntent) {
            this.overallConfidence = 0;
            return;
        }

        let total = this.primaryIntent.confidence;
        let count = 1;

        for (let intent of this.secondaryIntents) {
            total += intent.confidence * 0.5; // Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ù„Ù‡Ø§ ÙˆØ²Ù† Ø£Ù‚Ù„
            count += 0.5;
        }

        this.overallConfidence = total / count;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
     */
    getAllEntities(): ExtractedEntity[] {
        let entities: ExtractedEntity[] = [...this.allEntities];
        
        if (this.primaryIntent) {
            entities.push(...this.primaryIntent.entities);
        }
        
        for (let intent of this.secondaryIntents) {
            entities.push(...intent.entities);
        }

        return entities;
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ±
     */
    generateReport(): string {
        let report = "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
        report += "ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙŠØ©\n";
        report += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

        report += `ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„: "${this.inputText}"\n\n`;

        if (this.primaryIntent) {
            report += `ğŸ¯ Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: ${this.primaryIntent.type}\n`;
            report += `   Ø§Ù„Ø«Ù‚Ø©: ${(this.primaryIntent.confidence * 100).toFixed(1)}%\n`;
            
            if (this.primaryIntent.questionType) {
                report += `   Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„: ${this.primaryIntent.questionType}\n`;
            }
            
            if (this.primaryIntent.keywords.length > 0) {
                report += `   Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©: ${this.primaryIntent.keywords.join(", ")}\n`;
            }
        }

        if (this.secondaryIntents.length > 0) {
            report += `\nğŸ”¸ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© (${this.secondaryIntents.length}):\n`;
            for (let intent of this.secondaryIntents) {
                report += `   - ${intent.type} (${(intent.confidence * 100).toFixed(1)}%)\n`;
            }
        }

        let allEntities = this.getAllEntities();
        if (allEntities.length > 0) {
            report += `\nğŸ·ï¸ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© (${allEntities.length}):\n`;
            for (let entity of allEntities) {
                report += `   - ${entity.type}: "${entity.value}" (${(entity.confidence * 100).toFixed(1)}%)\n`;
            }
        }

        report += `\nğŸ“ˆ Ø§Ù„Ø«Ù‚Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${(this.overallConfidence * 100).toFixed(1)}%\n`;
        report += `â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${this.processingTime.toFixed(2)}ms\n`;

        return report;
    }
}

/**
 * Ù…Ø­Ù„Ù„ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ - Intent Analyzer
 * Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙˆØ§ÙŠØ§
 */
export class IntentAnalyzer extends MotherEquation {
    // Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„ÙƒÙ„ Ù†ÙˆØ¹ Ù†ÙŠØ©
    private intentKeywords: Map<IntentType, string[]>;

    // Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù…
    private questionWords: Map<QuestionType, string[]>;

    // Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
    private entityPatterns: Map<EntityType, RegExp[]>;

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    private stats: {
        totalAnalyses: number;
        successfulAnalyses: number;
        averageConfidence: number;
        intentDistribution: Map<IntentType, number>;
    };

    constructor(id: string = "intent-analyzer-001") {
        super(id);
        this.intentKeywords = new Map();
        this.questionWords = new Map();
        this.entityPatterns = new Map();
        this.stats = {
            totalAnalyses: 0,
            successfulAnalyses: 0,
            averageConfidence: 0,
            intentDistribution: new Map()
        };

        this.initializeKeywords();
        this.initializeQuestionWords();
        this.initializeEntityPatterns();
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
     */
    private initializeKeywords(): void {
        // Ø£Ø³Ø¦Ù„Ø©
        this.intentKeywords.set(IntentType.QUESTION, [
            "Ù…Ø§", "Ù…Ø§Ø°Ø§", "Ù…Ù†", "Ù…ØªÙ‰", "Ø£ÙŠÙ†", "ÙƒÙŠÙ", "Ù„Ù…Ø§Ø°Ø§", "Ù„Ù…", "Ù‡Ù„", "Ø£ÙŠ", "ÙƒÙ…"
        ]);

        // Ø·Ù„Ø¨Ø§Øª
        this.intentKeywords.set(IntentType.REQUEST, [
            "Ø£Ø±ÙŠØ¯", "Ø£Ø±ØºØ¨", "Ø£Ø­ØªØ§Ø¬", "Ù‡Ù„ ÙŠÙ…ÙƒÙ†", "Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹", "Ù…Ù† ÙØ¶Ù„Ùƒ", "Ù„Ùˆ Ø³Ù…Ø­Øª", "Ù…Ù…ÙƒÙ†"
        ]);

        // Ø£ÙˆØ§Ù…Ø±
        this.intentKeywords.set(IntentType.COMMAND, [
            "Ø§ÙØ¹Ù„", "Ù‚Ù…", "Ù†ÙØ°", "Ø§Ø¹Ù…Ù„", "Ø£Ù†Ø´Ø¦", "Ø§Ø­Ø°Ù", "Ø¹Ø¯Ù„", "ØºÙŠØ±", "Ø£Ø¶Ù", "Ø£Ø±Ø³Ù„"
        ]);

        // ØªØ­ÙŠØ§Øª
        this.intentKeywords.set(IntentType.GREETING, [
            "Ù…Ø±Ø­Ø¨Ø§", "Ù…Ø±Ø­Ø¨Ø§Ù‹", "Ø£Ù‡Ù„Ø§", "Ø£Ù‡Ù„Ø§Ù‹", "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…", "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±", "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±", "Ù‡Ù„Ø§", "Ù‡Ø§ÙŠ"
        ]);

        // ÙˆØ¯Ø§Ø¹
        this.intentKeywords.set(IntentType.FAREWELL, [
            "ÙˆØ¯Ø§Ø¹Ø§", "ÙˆØ¯Ø§Ø¹Ø§Ù‹", "Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡", "Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©", "Ø¨Ø§ÙŠ", "Ø³Ù„Ø§Ù…"
        ]);

        // Ø´ÙƒØ±
        this.intentKeywords.set(IntentType.THANKS, [
            "Ø´ÙƒØ±Ø§", "Ø´ÙƒØ±Ø§Ù‹", "Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡", "Ù…Ù…ØªÙ†", "Ø£Ø´ÙƒØ±Ùƒ", "Ù…Ø´ÙƒÙˆØ±"
        ]);

        // Ø§Ø¹ØªØ°Ø§Ø±
        this.intentKeywords.set(IntentType.APOLOGY, [
            "Ø¢Ø³Ù", "Ø¹Ø°Ø±Ø§", "Ø¹Ø°Ø±Ø§Ù‹", "Ø£Ø¹ØªØ°Ø±", "Ù…Ø¹Ø°Ø±Ø©", "Ø³Ø§Ù…Ø­Ù†ÙŠ"
        ]);

        // ØªØ£ÙƒÙŠØ¯
        this.intentKeywords.set(IntentType.CONFIRMATION, [
            "Ù†Ø¹Ù…", "Ø£Ø¬Ù„", "ØµØ­ÙŠØ­", "Ù…ÙˆØ§ÙÙ‚", "ØªÙ…Ø§Ù…", "Ø­Ø³Ù†Ø§Ù‹", "Ø·Ø¨Ø¹Ø§Ù‹", "Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯", "Ø£ÙƒÙŠØ¯"
        ]);

        // Ù†ÙÙŠ
        this.intentKeywords.set(IntentType.NEGATION, [
            "Ù„Ø§", "Ù„ÙŠØ³", "ØºÙŠØ±", "Ù„Ù…", "Ù„Ù†", "Ù…Ø§", "Ø£Ø¨Ø¯Ø§Ù‹", "Ù…Ø³ØªØ­ÙŠÙ„"
        ]);

        // Ø±Ø£ÙŠ
        this.intentKeywords.set(IntentType.OPINION, [
            "Ø£Ø¹ØªÙ‚Ø¯", "Ø£Ø¸Ù†", "ÙÙŠ Ø±Ø£ÙŠÙŠ", "Ø­Ø³Ø¨ Ø±Ø£ÙŠÙŠ", "Ø£Ø±Ù‰", "ÙŠØ¨Ø¯Ùˆ Ù„ÙŠ"
        ]);

        // Ø¹Ø§Ø·ÙØ©
        this.intentKeywords.set(IntentType.EMOTION, [
            "Ø£Ø­Ø¨", "Ø£ÙƒØ±Ù‡", "Ø£Ø®Ø§Ù", "Ø£ÙØ±Ø­", "Ø£Ø­Ø²Ù†", "Ø£ØºØ¶Ø¨", "Ø³Ø¹ÙŠØ¯", "Ø­Ø²ÙŠÙ†", "Ø®Ø§Ø¦Ù"
        ]);

        // Ø§Ù‚ØªØ±Ø§Ø­
        this.intentKeywords.set(IntentType.SUGGESTION, [
            "Ù…Ø§Ø°Ø§ Ø¹Ù†", "Ù„Ù…Ø§Ø°Ø§ Ù„Ø§", "Ø£Ù‚ØªØ±Ø­", "ÙŠÙ…ÙƒÙ†Ù†Ø§", "Ù…Ø§ Ø±Ø£ÙŠÙƒ", "Ù‡Ù„ Ø¬Ø±Ø¨Øª"
        ]);

        // Ø´ÙƒÙˆÙ‰
        this.intentKeywords.set(IntentType.COMPLAINT, [
            "Ø§Ù„Ù…Ø´ÙƒÙ„Ø©", "Ù„Ø§ ÙŠØ¹Ù…Ù„", "Ø®Ø·Ø£", "Ø¹Ø·Ù„", "Ù…Ø´ÙƒÙ„Ø©", "ÙØ´Ù„", "Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹"
        ]);

        // Ù…Ø¯Ø­
        this.intentKeywords.set(IntentType.PRAISE, [
            "Ù…Ù…ØªØ§Ø²", "Ø±Ø§Ø¦Ø¹", "Ø¬ÙŠØ¯", "Ø¹Ø¸ÙŠÙ…", "Ù…Ø°Ù‡Ù„", "Ø¬Ù…ÙŠÙ„", "Ù…Ø¨Ø¯Ø¹", "Ø£Ø­Ø³Ù†Øª"
        ]);

        // Ù†Ù‚Ø¯
        this.intentKeywords.set(IntentType.CRITICISM, [
            "Ø³ÙŠØ¡", "Ù„ÙŠØ³ Ø¬ÙŠØ¯", "Ø¶Ø¹ÙŠÙ", "Ø±Ø¯ÙŠØ¡", "ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨", "Ù„Ø§ ÙŠØ¹Ø¬Ø¨Ù†ÙŠ"
        ]);
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù…
     */
    private initializeQuestionWords(): void {
        this.questionWords.set(QuestionType.WHAT, ["Ù…Ø§", "Ù…Ø§Ø°Ø§"]);
        this.questionWords.set(QuestionType.WHO, ["Ù…Ù†"]);
        this.questionWords.set(QuestionType.WHEN, ["Ù…ØªÙ‰"]);
        this.questionWords.set(QuestionType.WHERE, ["Ø£ÙŠÙ†", "Ø£ÙŠÙ†Ù…Ø§"]);
        this.questionWords.set(QuestionType.WHY, ["Ù„Ù…Ø§Ø°Ø§", "Ù„Ù…", "Ù„ÙÙ…Ù"]);
        this.questionWords.set(QuestionType.HOW, ["ÙƒÙŠÙ", "ÙƒÙŠÙÙ…Ø§"]);
        this.questionWords.set(QuestionType.WHICH, ["Ø£ÙŠ", "Ø£ÙŠÙ‘"]);
        this.questionWords.set(QuestionType.HOW_MANY, ["ÙƒÙ…"]);
        this.questionWords.set(QuestionType.YES_NO, ["Ù‡Ù„"]);
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø£Ù†Ù…Ø§Ø· Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
     */
    private initializeEntityPatterns(): void {
        // Ø£Ø±Ù‚Ø§Ù…
        this.entityPatterns.set(EntityType.NUMBER, [
            /\d+/g,
            /[Ù -Ù©]+/g
        ]);

        // ØªÙˆØ§Ø±ÙŠØ®
        this.entityPatterns.set(EntityType.DATE, [
            /\d{1,2}\/\d{1,2}\/\d{2,4}/g,
            /\d{4}-\d{2}-\d{2}/g
        ]);

        // Ø£ÙˆÙ‚Ø§Øª
        this.entityPatterns.set(EntityType.TIME, [
            /\d{1,2}:\d{2}/g,
            /(ØµØ¨Ø§Ø­Ø§Ù‹|Ù…Ø³Ø§Ø¡Ù‹|Ø¸Ù‡Ø±Ø§Ù‹)/g
        ]);
    }

    /**
     * ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ÙŠØ©
     */
    analyze(text: string): IntentAnalysisResult {
        let startTime = Date.now();

        let result = new IntentAnalysisResult(
            `intent-result-${Date.now()}`,
            text
        );

        // 1. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ
        let cleanText = this.cleanText(text);

        // 2. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        let primaryIntent = this.detectPrimaryIntent(cleanText);
        result.setPrimaryIntent(primaryIntent);

        // 3. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©
        let secondaryIntents = this.detectSecondaryIntents(cleanText, primaryIntent);
        for (let intent of secondaryIntents) {
            result.addSecondaryIntent(intent);
        }

        // 4. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
        let entities = this.extractEntities(cleanText);
        result.allEntities = entities;

        // 5. Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        for (let entity of entities) {
            primaryIntent.addEntity(entity);
        }

        // 6. Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        result.processingTime = Date.now() - startTime;

        // 7. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        this.updateStats(result);

        return result;
    }

    /**
     * ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ
     */
    private cleanText(text: string): string {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
        text = text.trim().replace(/\s+/g, " ");

        // ØªÙˆØ­ÙŠØ¯ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ…
        text = text.replace(/[ØŸ]/g, "?");
        text = text.replace(/[ØŒ]/g, ",");

        return text;
    }

    /**
     * ÙƒØ´Ù Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
     */
    private detectPrimaryIntent(text: string): DetectedIntent {
        let scores: Map<IntentType, number> = new Map();

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ù†ÙˆØ¹ Ù†ÙŠØ©
        for (let [intentType, keywords] of this.intentKeywords) {
            let score = 0;

            for (let keyword of keywords) {
                if (text.includes(keyword)) {
                    score += 1;

                    // Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    if (text.startsWith(keyword)) {
                        score += 0.5;
                    }
                }
            }

            if (score > 0) {
                scores.set(intentType, score);
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙŠØ© Ø°Ø§Øª Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·
        let maxScore = 0;
        let bestIntent = IntentType.UNKNOWN;

        for (let [intentType, score] of scores) {
            if (score > maxScore) {
                maxScore = score;
                bestIntent = intentType;
            }
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø«Ù‚Ø©
        let confidence = Math.min(maxScore / 3, 1.0); // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·

        let intent = new DetectedIntent(
            `intent-${Date.now()}`,
            bestIntent,
            confidence
        );

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
        if (this.intentKeywords.has(bestIntent)) {
            for (let keyword of this.intentKeywords.get(bestIntent)) {
                if (text.includes(keyword)) {
                    intent.addKeyword(keyword);
                }
            }
        }

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†ÙŠØ© Ø³Ø¤Ø§Ù„ØŒ Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
        if (bestIntent === IntentType.QUESTION) {
            intent.questionType = this.detectQuestionType(text);
        }

        return intent;
    }

    /**
     * ÙƒØ´Ù Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
     */
    private detectQuestionType(text: string): QuestionType {
        for (let [questionType, words] of this.questionWords) {
            for (let word of words) {
                if (text.includes(word)) {
                    return questionType;
                }
            }
        }
        return QuestionType.UNKNOWN;
    }

    /**
     * ÙƒØ´Ù Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©
     */
    private detectSecondaryIntents(text: string, primaryIntent: DetectedIntent): DetectedIntent[] {
        let secondaryIntents: DetectedIntent[] = [];

        for (let [intentType, keywords] of this.intentKeywords) {
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            if (intentType === primaryIntent.type) {
                continue;
            }

            let score = 0;
            for (let keyword of keywords) {
                if (text.includes(keyword)) {
                    score += 1;
                }
            }

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ù‚ÙˆÙ„
            if (score >= 1) {
                let confidence = Math.min(score / 4, 0.8); // Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ù„Ù‡Ø§ Ø«Ù‚Ø© Ø£Ù‚Ù„

                let intent = new DetectedIntent(
                    `intent-secondary-${Date.now()}-${intentType}`,
                    intentType,
                    confidence
                );

                secondaryIntents.push(intent);
            }
        }

        return secondaryIntents;
    }

    /**
     * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
     */
    private extractEntities(text: string): ExtractedEntity[] {
        let entities: ExtractedEntity[] = [];

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        let numberMatches = text.match(/\d+/g);
        if (numberMatches) {
            for (let match of numberMatches) {
                let index = text.indexOf(match);
                entities.push(new ExtractedEntity(
                    `entity-number-${Date.now()}-${index}`,
                    EntityType.NUMBER,
                    match,
                    index,
                    index + match.length,
                    0.95
                ));
            }
        }

        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø£Ù†Ù…Ø§Ø· Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§

        return entities;
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
     */
    private updateStats(result: IntentAnalysisResult): void {
        this.stats.totalAnalyses++;

        if (result.overallConfidence > 0.5) {
            this.stats.successfulAnalyses++;
        }

        // ØªØ­Ø¯ÙŠØ« Ù…ØªÙˆØ³Ø· Ø§Ù„Ø«Ù‚Ø©
        let totalConfidence = this.stats.averageConfidence * (this.stats.totalAnalyses - 1);
        totalConfidence += result.overallConfidence;
        this.stats.averageConfidence = totalConfidence / this.stats.totalAnalyses;

        // ØªØ­Ø¯ÙŠØ« ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙŠØ§
        if (result.primaryIntent) {
            let count = this.stats.intentDistribution.get(result.primaryIntent.type) || 0;
            this.stats.intentDistribution.set(result.primaryIntent.type, count + 1);
        }
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
     */
    getStats(): any {
        return {
            totalAnalyses: this.stats.totalAnalyses,
            successfulAnalyses: this.stats.successfulAnalyses,
            successRate: this.stats.totalAnalyses > 0
                ? (this.stats.successfulAnalyses / this.stats.totalAnalyses * 100).toFixed(1) + "%"
                : "0%",
            averageConfidence: (this.stats.averageConfidence * 100).toFixed(1) + "%",
            intentDistribution: Object.fromEntries(this.stats.intentDistribution)
        };
    }
}


