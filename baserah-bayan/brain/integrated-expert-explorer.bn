/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø®Ø¨ÙŠØ±/Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
 * Integrated Expert/Explorer System
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ù„Ù…Ø³ØªÙƒØ´Ù ÙÙŠ Ù†Ø¸Ø§Ù… Ù…ÙˆØ­Ø¯:
 * - ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ù„Ù…Ø³ØªÙƒØ´Ù
 * - ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
 * - Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ
 * - Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙƒÙŠÙÙŠØ©
 * 
 * @author Baserah AI System
 * @version 1.0.0
 * @date 2025-10-26
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import { MotherEquation, ObjectType } from "../core/mother-equation.bn";
import { BaserahExpertCore, Decision, DecisionType } from "./expert-explorer-system.bn";
import { BaserahExplorerCore } from "./explorer-core.bn";

class BaserahIntegratedExpertExplorer extends MotherEquation {
    domain: string;
    
    // Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ù„Ù…Ø³ØªÙƒØ´Ù
    expert: BaserahExpertCore;
    explorer: BaserahExplorerCore;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„
    expertWeight: number;
    explorerWeight: number;
    collaborationThreshold: number;
    
    // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
    integratedDecisions: Decision[];
    
    constructor(name: string, domain: string = "general") {
        super(ObjectType.ABSTRACT, name);
        
        this.domain = domain;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ù„Ù…Ø³ØªÙƒØ´Ù
        this.expert = new BaserahExpertCore(`${name}_Expert`, domain);
        this.explorer = new BaserahExplorerCore(`${name}_Explorer`, domain);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„
        this.expertWeight = 0.6;
        this.explorerWeight = 0.4;
        this.collaborationThreshold = 0.5;
        
        // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
        this.integratedDecisions = [];
        
        console.log(`ðŸ¤ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„: ${name}`);
        console.log(`   ðŸ‘¨â€ðŸ« Ø§Ù„Ø®Ø¨ÙŠØ±: ${this.expert.name}`);
        console.log(`   ðŸ” Ø§Ù„Ù…Ø³ØªÙƒØ´Ù: ${this.explorer.name}`);
    }
    
    // â•â•â• ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ù â•â•â•
    
    function analyzeSituation(problem: object): object {
        /**
         * ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ù Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø¬ Ø§Ù„Ø£Ù†Ø³Ø¨
         * Analyze situation to determine best approach
         */
        let analysis = {
            problemComplexity: this.assessComplexity(problem),
            knowledgeAvailability: this.assessKnowledgeAvailability(problem),
            innovationRequirement: this.assessInnovationRequirement(problem),
            riskLevel: this.assessRiskLevel(problem),
            recommendedApproach: "",
            expertWeight: 0.5,
            explorerWeight: 0.5
        };
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø¬ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        if (analysis.knowledgeAvailability > 0.7 && analysis.problemComplexity < 0.5) {
            analysis.recommendedApproach = "expert_led";
            analysis.expertWeight = 0.8;
            analysis.explorerWeight = 0.2;
        } else if (analysis.innovationRequirement > 0.7 || analysis.knowledgeAvailability < 0.3) {
            analysis.recommendedApproach = "explorer_led";
            analysis.expertWeight = 0.2;
            analysis.explorerWeight = 0.8;
        } else {
            analysis.recommendedApproach = "collaborative";
            analysis.expertWeight = 0.5;
            analysis.explorerWeight = 0.5;
        }
        
        return analysis;
    }
    
    function assessComplexity(problem: object): number {
        /**
         * ØªÙ‚ÙŠÙŠÙ… ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
         * Assess problem complexity
         */
        let complexity = 0.0;
        
        // Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        let numVariables = problem.variables ? Object.keys(problem.variables).length : 0;
        complexity += Math.min(numVariables / 10.0, 0.5);
        
        // ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙˆØ¯
        if (problem.constraints) {
            complexity += 0.3;
        }
        
        // Ø¹Ø¯Ù… Ø§Ù„ÙŠÙ‚ÙŠÙ†
        if (problem.uncertainty && problem.uncertainty > 0.5) {
            complexity += 0.2;
        }
        
        return Math.min(complexity, 1.0);
    }
    
    function assessKnowledgeAvailability(problem: object): number {
        /**
         * ØªÙ‚ÙŠÙŠÙ… ØªÙˆÙØ± Ø§Ù„Ù…Ø¹Ø±ÙØ©
         * Assess knowledge availability
         */
        let relevantKnowledge = this.expert.findRelevantKnowledge(problem);
        if (relevantKnowledge.length == 0) {
            return 0.0;
        }
        
        // Ù…ØªÙˆØ³Ø· Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
        let avgReliability = relevantKnowledge.reduce((sum, k) => sum + k.reliabilityScore, 0) / relevantKnowledge.length;
        return avgReliability;
    }
    
    function assessInnovationRequirement(problem: object): number {
        /**
         * ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ø¨ØªÙƒØ§Ø±
         * Assess innovation requirement
         */
        let innovationReq = 0.0;
        
        // Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        if (problem.novelty && problem.novelty > 0.7) {
            innovationReq += 0.4;
        }
        
        // ÙØ´Ù„ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©
        if (problem.traditionalSolutionsFailed) {
            innovationReq += 0.3;
        }
        
        // Ø·Ù„Ø¨ ØµØ±ÙŠØ­ Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹
        if (problem.requiresCreativity) {
            innovationReq += 0.3;
        }
        
        return Math.min(innovationReq, 1.0);
    }
    
    function assessRiskLevel(problem: object): number {
        /**
         * ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©
         * Assess risk level
         */
        let risk = problem.riskLevel || 0.5;
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚
        if (problem.critical) {
            risk += 0.2;
        }
        
        if (problem.reversible !== undefined && problem.reversible) {
            risk -= 0.1;
        }
        
        return Math.max(Math.min(risk, 1.0), 0.0);
    }
    
    // â•â•â• Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© â•â•â•
    
    function makeIntegratedDecision(problem: object): Decision {
        /**
         * Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…ØªÙƒØ§Ù…Ù„
         * Make integrated decision
         */
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ù
        let situationAnalysis = this.analyzeSituation(problem);
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ù†ÙˆØ§ØªÙŠÙ†
        let expertDecision = this.expert.makeRevolutionaryExpertDecision(problem);
        
        // Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø³ØªÙƒØ´Ù (Ø§Ø³ØªÙƒØ´Ø§Ù Ø«ÙˆØ±ÙŠ)
        let explorationResult = this.explorer.exploreRevolutionary(problem);
        
        // Ø¯Ù…Ø¬ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª
        let integratedDecision = new Decision(DecisionType.COLLABORATIVE_DECISION);
        integratedDecision.expertContribution = situationAnalysis.expertWeight;
        integratedDecision.explorerContribution = situationAnalysis.explorerWeight;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        if (situationAnalysis.recommendedApproach == "expert_led") {
            integratedDecision.action = expertDecision.action;
            integratedDecision.parameters = expertDecision.parameters;
            integratedDecision.confidence = expertDecision.confidence * 0.9;
        } else if (situationAnalysis.recommendedApproach == "explorer_led") {
            if (explorationResult.success && explorationResult.discoveredPatterns.length > 0) {
                let bestPattern = explorationResult.discoveredPatterns.reduce((best, current) => 
                    current.score > best.score ? current : best
                );
                integratedDecision.action = "apply_discovered_pattern";
                integratedDecision.parameters = bestPattern.pattern;
                integratedDecision.confidence = explorationResult.innovationScore;
            } else {
                // Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù ÙØ´Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø¨ÙŠØ± ÙƒØ¨Ø¯ÙŠÙ„
                integratedDecision.action = expertDecision.action;
                integratedDecision.parameters = expertDecision.parameters;
                integratedDecision.confidence = expertDecision.confidence * 0.5;
            }
        } else {
            // Ù†Ù‡Ø¬ ØªØ¹Ø§ÙˆÙ†ÙŠ
            if (expertDecision.confidence > 0.7 && explorationResult.innovationScore > 0.6) {
                // Ø¯Ù…Ø¬ Ø§Ù„Ø­Ù„ÙˆÙ„
                integratedDecision.action = "hybrid_solution";
                integratedDecision.parameters = {
                    expertSolution: expertDecision.parameters,
                    explorerDiscovery: explorationResult.discoveredPatterns.length > 0 ? 
                        explorationResult.discoveredPatterns[0].pattern : {},
                    blendRatio: [situationAnalysis.expertWeight, situationAnalysis.explorerWeight]
                };
                integratedDecision.confidence = (expertDecision.confidence + explorationResult.innovationScore) / 2;
            } else if (expertDecision.confidence > explorationResult.innovationScore) {
                // Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¨ÙŠØ±
                integratedDecision.action = expertDecision.action;
                integratedDecision.parameters = expertDecision.parameters;
                integratedDecision.confidence = expertDecision.confidence;
            } else {
                // Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
                if (explorationResult.discoveredPatterns.length > 0) {
                    let bestPattern = explorationResult.discoveredPatterns.reduce((best, current) =>
                        current.score > best.score ? current : best
                    );
                    integratedDecision.action = "apply_discovered_pattern";
                    integratedDecision.parameters = bestPattern.pattern;
                    integratedDecision.confidence = explorationResult.innovationScore;
                }
            }
        }
        
        this.integratedDecisions.push(integratedDecision);
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø®Ø¨ÙŠØ± Ù„Ù„ØªØ¹Ù„Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
        this.expert.decisionHistory.push(integratedDecision);
        
        console.log(`ðŸ¤ Ù‚Ø±Ø§Ø± Ù…ØªÙƒØ§Ù…Ù„: ${integratedDecision.action}`);
        console.log(`   ðŸ‘¨â€ðŸ« Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø®Ø¨ÙŠØ±: ${integratedDecision.expertContribution.toFixed(2)}`);
        console.log(`   ðŸ” Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ù…Ø³ØªÙƒØ´Ù: ${integratedDecision.explorerContribution.toFixed(2)}`);
        console.log(`   ðŸŽ¯ Ø§Ù„Ø«Ù‚Ø©: ${integratedDecision.confidence.toFixed(3)}`);
        
        return integratedDecision;
    }
    
    // â•â•â• ÙˆØ§Ø¬Ù‡Ø§Øª Ù…ÙˆØ­Ù‘Ø¯Ø© â•â•â•
    
    function decide(context: object): Decision {
        /**
         * Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ù…ØªÙƒØ§Ù…Ù„ - ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
         * Make integrated decision - protocol compatible
         */
        return this.makeIntegratedDecision(context);
    }
    
    function explore(context: object): any {
        /**
         * Ø§Ø³ØªÙƒØ´Ø§Ù - ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
         * Explore - protocol compatible
         */
        try {
            return this.explorer.exploreRevolutionary(context);
        } catch (e) {
            // Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ø³ØªÙƒØ´Ø§Ù Ù…ÙˆØ¬Ù‡ Ø¥Ù† Ù„Ø²Ù…
            let currentBest = context.currentBest || {};
            return this.explorer.exploreGuided(currentBest);
        }
    }
    
    function exploit(context: object): Decision {
        /**
         * Ø§Ø³ØªØºÙ„Ø§Ù„ (Ù‚Ø±Ø§Ø± Ø®Ø¨ÙŠØ±) - ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
         * Exploit (expert decision) - protocol compatible
         */
        try {
            return this.expert.makeRevolutionaryExpertDecision(context);
        } catch (e) {
            console.log(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø± Ø§Ù„Ø®Ø¨ÙŠØ±: ${e}`);
            return new Decision(DecisionType.EXPERT_DECISION);
        }
    }
    
    // â•â•â• Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… â•â•â•
    
    function getSystemStatus(): object {
        /**
         * Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
         * Integrated system status
         */
        let expertStats = {
            expertiseLevel: this.expert.expertiseLevel,
            totalDecisions: this.expert.totalDecisions,
            successRate: this.expert.totalDecisions > 0 ? 
                this.expert.successfulDecisions / this.expert.totalDecisions : 0,
            knowledgeBaseSize: Object.keys(this.expert.knowledgeBase).length
        };
        
        let explorerStats = {
            totalExplorations: this.explorer.totalExplorations,
            successfulDiscoveries: this.explorer.successfulDiscoveries,
            discoveryRate: this.explorer.totalExplorations > 0 ?
                this.explorer.successfulDiscoveries / this.explorer.totalExplorations : 0,
            innovationScore: this.explorer.innovationScore
        };
        
        let integratedStats = {
            totalIntegratedDecisions: this.integratedDecisions.length,
            expertWeight: this.expertWeight,
            explorerWeight: this.explorerWeight
        };
        
        return {
            expert: expertStats,
            explorer: explorerStats,
            integrated: integratedStats,
            systemHealth: (expertStats.successRate + explorerStats.discoveryRate) / 2
        };
    }
}

export { BaserahIntegratedExpertExplorer };

