/**
 * Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
 * Advanced Emotional Intelligence Engine
 * 
 * ÙŠÙˆÙØ± Ù‚Ø¯Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„ÙÙ‡Ù… ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
 */

import { MotherEquation } from "../core/mother-equation.bn";

// ==================== Ø§Ù„ØªØ¹Ø¯Ø§Ø¯Ø§Øª ====================

/**
 * Ø´Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
 * Emotion Intensity
 */
export enum EmotionIntensity {
    VERY_LOW = "Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹",
    LOW = "Ù…Ù†Ø®ÙØ¶Ø©",
    MODERATE = "Ù…ØªÙˆØ³Ø·Ø©",
    HIGH = "Ø¹Ø§Ù„ÙŠØ©",
    VERY_HIGH = "Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹"
}

/**
 * Ù‚Ø·Ø¨ÙŠØ© Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
 * Emotion Valence
 */
export enum EmotionValence {
    POSITIVE = "Ø¥ÙŠØ¬Ø§Ø¨ÙŠ",
    NEGATIVE = "Ø³Ù„Ø¨ÙŠ",
    NEUTRAL = "Ù…Ø­Ø§ÙŠØ¯",
    MIXED = "Ù…Ø®ØªÙ„Ø·"
}

/**
 * Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
 * Emotion Regulation Strategies
 */
export enum RegulationStrategy {
    REAPPRAISAL = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
    SUPPRESSION = "Ø§Ù„ÙƒØ¨Øª",
    DISTRACTION = "Ø§Ù„ØªØ´ØªÙŠØª",
    ACCEPTANCE = "Ø§Ù„Ù‚Ø¨ÙˆÙ„",
    EXPRESSION = "Ø§Ù„ØªØ¹Ø¨ÙŠØ±",
    PROBLEM_SOLVING = "Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©",
    SEEKING_SUPPORT = "Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…",
    MINDFULNESS = "Ø§Ù„ÙŠÙ‚Ø¸Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ©"
}

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
 * Basic Emotion Types
 */
export enum BasicEmotion {
    JOY = "ÙØ±Ø­",
    SADNESS = "Ø­Ø²Ù†",
    ANGER = "ØºØ¶Ø¨",
    FEAR = "Ø®ÙˆÙ",
    SURPRISE = "Ù…ÙØ§Ø¬Ø£Ø©",
    DISGUST = "Ø§Ø´Ù…Ø¦Ø²Ø§Ø²",
    TRUST = "Ø«Ù‚Ø©",
    ANTICIPATION = "ØªØ±Ù‚Ø¨"
}

// ==================== Ø§Ù„ÙØ¦Ø§Øª ====================

/**
 * Ø­Ø§Ù„Ø© Ø¹Ø§Ø·ÙÙŠØ©
 * Emotional State
 */
export class EmotionalState extends MotherEquation {
    public stateId: string;
    public primaryEmotion: string;
    public secondaryEmotions: Array<string>;
    public intensity: EmotionIntensity;
    public valence: EmotionValence;
    public triggers: Array<string>;
    public duration: number; // Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
    public context: string | null;
    public timestamp: number;

    constructor(
        primaryEmotion: string,
        intensity: EmotionIntensity,
        valence: EmotionValence,
        triggers: Array<string> = []
    ) {
        super(`emotion_${Date.now()}`, {}, {});
        this.stateId = this.id;
        this.primaryEmotion = primaryEmotion;
        this.secondaryEmotions = [];
        this.intensity = intensity;
        this.valence = valence;
        this.triggers = triggers;
        this.duration = 0;
        this.context = null;
        this.timestamp = Date.now();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø¹Ø± Ø«Ø§Ù†ÙˆÙŠØ©
     */
    public addSecondaryEmotion(emotion: string): void {
        if (!this.secondaryEmotions.includes(emotion)) {
            this.secondaryEmotions.push(emotion);
        }
    }

    /**
     * Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©
     */
    public getComplexityScore(): number {
        let baseScore = 0.3;

        // Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© ØªØ²ÙŠØ¯ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯
        let secondaryScore = this.secondaryEmotions.length * 0.15;

        // Ø§Ù„Ø´Ø¯Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ© ØªØ²ÙŠØ¯ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯
        let intensityMap = new Map<EmotionIntensity, number>([
            [EmotionIntensity.VERY_LOW, 0.1],
            [EmotionIntensity.LOW, 0.2],
            [EmotionIntensity.MODERATE, 0.3],
            [EmotionIntensity.HIGH, 0.4],
            [EmotionIntensity.VERY_HIGH, 0.5]
        ]);
        let intensityScore = intensityMap.get(this.intensity) || 0.3;

        // Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ø®ØªÙ„Ø·Ø© Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹
        let valenceScore = this.valence === EmotionValence.MIXED ? 0.3 : 0.1;

        return Math.min(1.0, baseScore + secondaryScore + intensityScore + valenceScore);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¯Ø©
     */
    public updateDuration(minutes: number): void {
        this.duration += minutes;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø©
     */
    public getDescription(): string {
        let desc = `Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${this.primaryEmotion} (${this.intensity})`;
        
        if (this.secondaryEmotions.length > 0) {
            desc += `\nÙ…Ø´Ø§Ø¹Ø± Ø«Ø§Ù†ÙˆÙŠØ©: ${this.secondaryEmotions.join(", ")}`;
        }
        
        desc += `\nØ§Ù„Ù‚Ø·Ø¨ÙŠØ©: ${this.valence}`;
        desc += `\nØ§Ù„Ù…Ø¯Ø©: ${this.duration.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©`;
        desc += `\nØ¯Ø±Ø¬Ø© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯: ${(this.getComplexityScore() * 100).toFixed(0)}%`;
        
        return desc;
    }
}

/**
 * ØªÙ†Ø¸ÙŠÙ… Ø¹Ø§Ø·ÙÙŠ
 * Emotional Regulation
 */
export class EmotionalRegulation extends MotherEquation {
    public regulationId: string;
    public targetEmotion: string;
    public currentIntensity: number;
    public desiredIntensity: number;
    public strategy: RegulationStrategy;
    public effectiveness: number;
    public steps: Array<string>;
    public timestamp: number;

    constructor(
        targetEmotion: string,
        currentIntensity: number,
        desiredIntensity: number,
        strategy: RegulationStrategy
    ) {
        super(`regulation_${Date.now()}`, {}, {});
        this.regulationId = this.id;
        this.targetEmotion = targetEmotion;
        this.currentIntensity = currentIntensity;
        this.desiredIntensity = desiredIntensity;
        this.strategy = strategy;
        this.effectiveness = 0;
        this.steps = [];
        this.timestamp = Date.now();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ©
     */
    public addStep(step: string): void {
        this.steps.push(step);
    }

    /**
     * Ø­Ø³Ø§Ø¨ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…
     */
    public calculateEffectiveness(): number {
        let intensityReduction = Math.abs(this.currentIntensity - this.desiredIntensity);

        if (intensityReduction < 0.1) {
            this.effectiveness = 1.0;
        } else if (intensityReduction < 0.3) {
            this.effectiveness = 0.8;
        } else if (intensityReduction < 0.5) {
            this.effectiveness = 0.6;
        } else if (intensityReduction < 0.7) {
            this.effectiveness = 0.4;
        } else {
            this.effectiveness = 0.2;
        }

        return this.effectiveness;
    }

    /**
     * ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
     */
    public applyStrategy(): Array<string> {
        this.steps = [];

        switch (this.strategy) {
            case RegulationStrategy.REAPPRAISAL:
                this.steps.push("Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ù Ù…Ù† Ù…Ù†Ø¸ÙˆØ± Ù…Ø®ØªÙ„Ù");
                this.steps.push("Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©");
                this.steps.push("ØªØºÙŠÙŠØ± Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ø­Ø¯Ø«");
                break;

            case RegulationStrategy.SUPPRESSION:
                this.steps.push("ÙƒØ¨Øª Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±");
                this.steps.push("Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…Ø¸Ù‡Ø± Ù…Ø­Ø§ÙŠØ¯");
                this.steps.push("ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©");
                break;

            case RegulationStrategy.DISTRACTION:
                this.steps.push("ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ø¥Ù„Ù‰ Ù†Ø´Ø§Ø· Ø¢Ø®Ø±");
                this.steps.push("Ø§Ù„Ø§Ù†Ø®Ø±Ø§Ø· ÙÙŠ Ù…Ù‡Ù…Ø© ØªØªØ·Ù„Ø¨ ØªØ±ÙƒÙŠØ²Ø§Ù‹");
                this.steps.push("ØªØºÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙŠØ·Ø©");
                break;

            case RegulationStrategy.ACCEPTANCE:
                this.steps.push("Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¯ÙˆÙ† Ø­ÙƒÙ…");
                this.steps.push("Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ø¨Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙƒØ¬Ø²Ø¡ Ø·Ø¨ÙŠØ¹ÙŠ");
                this.steps.push("Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø´Ø§Ø¹Ø± Ø¨Ø§Ù„Ù…Ø±ÙˆØ±");
                break;

            case RegulationStrategy.EXPRESSION:
                this.steps.push("Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¨Ø·Ø±ÙŠÙ‚Ø© ØµØ­ÙŠØ©");
                this.steps.push("Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ù…Ø¹ Ø´Ø®Øµ Ù…ÙˆØ«ÙˆÙ‚");
                this.steps.push("Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø£Ùˆ Ø§Ù„ÙÙ† Ù„Ù„ØªØ¹Ø¨ÙŠØ±");
                break;

            case RegulationStrategy.PROBLEM_SOLVING:
                this.steps.push("ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");
                this.steps.push("ÙˆØ¶Ø¹ Ø®Ø·Ø© Ø¹Ù…Ù„ Ù„Ù„Ø­Ù„");
                this.steps.push("ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ù„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©");
                break;

            case RegulationStrategy.SEEKING_SUPPORT:
                this.steps.push("Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø´Ø®Øµ Ø¯Ø§Ø¹Ù…");
                this.steps.push("Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ùˆ Ø§Ù„Ù†ØµÙŠØ­Ø©");
                this.steps.push("Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ");
                break;

            case RegulationStrategy.MINDFULNESS:
                this.steps.push("Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚");
                this.steps.push("Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©");
                this.steps.push("Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¯ÙˆÙ† ØªÙØ§Ø¹Ù„");
                break;
        }

        return this.steps;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ±
     */
    public getReport(): string {
        let report = `ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±: ${this.targetEmotion}\n`;
        report += `Ø§Ù„Ø´Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${(this.currentIntensity * 100).toFixed(0)}%\n`;
        report += `Ø§Ù„Ø´Ø¯Ø© Ø§Ù„Ù…Ø±ØºÙˆØ¨Ø©: ${(this.desiredIntensity * 100).toFixed(0)}%\n`;
        report += `Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©: ${this.strategy}\n`;
        report += `Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©: ${(this.effectiveness * 100).toFixed(0)}%\n`;
        report += `\nØ§Ù„Ø®Ø·ÙˆØ§Øª:\n`;
        this.steps.forEach((step, index) => {
            report += `${index + 1}. ${step}\n`;
        });

        return report;
    }
}

/**
 * Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ
 * Emotional Intelligence Engine
 */
export class EmotionalIntelligenceEngine extends MotherEquation {
    public currentStates: Map<string, EmotionalState>;
    public regulationHistory: Array<EmotionalRegulation>;
    public emotionPatterns: Map<string, Array<string>>; // trigger -> emotions
    public maxHistorySize: number;

    constructor() {
        super("emotional_intelligence_engine", {}, {});
        this.currentStates = new Map();
        this.regulationHistory = [];
        this.emotionPatterns = new Map();
        this.maxHistorySize = 100;
    }

    /**
     * ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¹Ø§Ø·ÙÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
     */
    public recordEmotionalState(state: EmotionalState): void {
        this.currentStates.set(state.stateId, state);

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·
        state.triggers.forEach(trigger => {
            if (!this.emotionPatterns.has(trigger)) {
                this.emotionPatterns.set(trigger, []);
            }
            let emotions = this.emotionPatterns.get(trigger)!;
            if (!emotions.includes(state.primaryEmotion)) {
                emotions.push(state.primaryEmotion);
            }
        });

        console.log(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¹Ø§Ø·ÙÙŠØ©: ${state.primaryEmotion} (${state.intensity})`);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
     */
    public getCurrentDominantEmotion(): EmotionalState | null {
        if (this.currentStates.size === 0) {
            return null;
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚ÙˆÙ‰ Ù…Ø´Ø§Ø¹Ø±
        let strongest: EmotionalState | null = null;
        let maxIntensity = 0;

        this.currentStates.forEach(state => {
            let intensityValue = this.getIntensityValue(state.intensity);
            if (intensityValue > maxIntensity) {
                maxIntensity = intensityValue;
                strongest = state;
            }
        });

        return strongest;
    }

    /**
     * ØªØ­ÙˆÙŠÙ„ Ø´Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¥Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ©
     */
    private getIntensityValue(intensity: EmotionIntensity): number {
        switch (intensity) {
            case EmotionIntensity.VERY_LOW: return 0.2;
            case EmotionIntensity.LOW: return 0.4;
            case EmotionIntensity.MODERATE: return 0.6;
            case EmotionIntensity.HIGH: return 0.8;
            case EmotionIntensity.VERY_HIGH: return 1.0;
            default: return 0.5;
        }
    }

    /**
     * Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªÙ†Ø¸ÙŠÙ…
     */
    public suggestRegulationStrategy(
        emotion: string,
        currentIntensity: number,
        desiredIntensity: number
    ): RegulationStrategy {
        let difference = Math.abs(currentIntensity - desiredIntensity);

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ù‚ ÙˆØ§Ù„Ù…Ø´Ø§Ø¹Ø±
        if (difference < 0.2) {
            return RegulationStrategy.ACCEPTANCE;
        } else if (difference < 0.4) {
            return RegulationStrategy.MINDFULNESS;
        } else if (emotion === BasicEmotion.ANGER || emotion === BasicEmotion.FEAR) {
            return RegulationStrategy.REAPPRAISAL;
        } else if (emotion === BasicEmotion.SADNESS) {
            return RegulationStrategy.SEEKING_SUPPORT;
        } else {
            return RegulationStrategy.PROBLEM_SOLVING;
        }
    }

    /**
     * ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
     */
    public regulateEmotion(
        emotion: string,
        currentIntensity: number,
        desiredIntensity: number,
        strategy?: RegulationStrategy
    ): EmotionalRegulation {
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙØ­Ø¯Ø¯
        if (!strategy) {
            strategy = this.suggestRegulationStrategy(emotion, currentIntensity, desiredIntensity);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…
        let regulation = new EmotionalRegulation(
            emotion,
            currentIntensity,
            desiredIntensity,
            strategy
        );

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
        regulation.applyStrategy();

        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©
        regulation.calculateEffectiveness();

        // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
        this.regulationHistory.push(regulation);
        if (this.regulationHistory.length > this.maxHistorySize) {
            this.regulationHistory.shift();
        }

        console.log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© ØªÙ†Ø¸ÙŠÙ… Ù„Ù„Ù…Ø´Ø§Ø¹Ø±: ${emotion}`);
        console.log(`   Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©: ${strategy}`);
        console.log(`   Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: ${(regulation.effectiveness * 100).toFixed(0)}%`);

        return regulation;
    }

    /**
     * Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙØ²
     */
    public predictEmotions(trigger: string): Array<string> {
        if (this.emotionPatterns.has(trigger)) {
            return this.emotionPatterns.get(trigger)!;
        }
        return [];
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
     */
    public getStatistics(): any {
        let totalStates = this.currentStates.size;
        let totalRegulations = this.regulationHistory.length;
        let avgEffectiveness = 0;

        if (totalRegulations > 0) {
            let sum = this.regulationHistory.reduce((acc, reg) => acc + reg.effectiveness, 0);
            avgEffectiveness = sum / totalRegulations;
        }

        return {
            totalEmotionalStates: totalStates,
            totalRegulations: totalRegulations,
            averageEffectiveness: avgEffectiveness,
            patternsLearned: this.emotionPatterns.size
        };
    }

    /**
     * Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
     */
    public clearOldStates(maxAgeMinutes: number = 60): void {
        let now = Date.now();
        let cleared = 0;

        this.currentStates.forEach((state, id) => {
            let ageMinutes = (now - state.timestamp) / (1000 * 60);
            if (ageMinutes > maxAgeMinutes) {
                this.currentStates.delete(id);
                cleared++;
            }
        });

        if (cleared > 0) {
            console.log(`ğŸ§¹ ØªÙ… Ù…Ø³Ø­ ${cleared} Ø­Ø§Ù„Ø© Ø¹Ø§Ø·ÙÙŠØ© Ù‚Ø¯ÙŠÙ…Ø©`);
        }
    }
}

