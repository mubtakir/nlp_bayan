/**
 * Ù†Ø¸Ø§Ù… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
 * Conflict Resolution System
 * 
 * ÙŠÙˆÙØ± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø°ÙƒÙŠØ© Ù„Ø­Ù„ Ø§Ù„Ø®Ù„Ø§ÙØ§Øª ÙˆØ§Ù„ØªÙˆØªØ±Ø§Øª
 */

import { MotherEquation } from "../core/mother-equation.bn";

// ==================== Ø§Ù„ØªØ¹Ø¯Ø§Ø¯Ø§Øª ====================

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
 * Conflict Types
 */
export enum ConflictType {
    INTERPERSONAL = "Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ø®Ø§Øµ",
    INTRAPERSONAL = "Ø¯Ø§Ø®Ù„ÙŠ",
    TASK_BASED = "Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…Ù‡Ø§Ù…",
    VALUE_BASED = "Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù‚ÙŠÙ…",
    RESOURCE_BASED = "Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
    COMMUNICATION = "Ø³ÙˆØ¡ ØªÙˆØ§ØµÙ„"
}

/**
 * Ø´Ø¯Ø© Ø§Ù„Ù†Ø²Ø§Ø¹
 * Conflict Severity
 */
export enum ConflictSeverity {
    MINOR = "Ø¨Ø³ÙŠØ·",
    MODERATE = "Ù…ØªÙˆØ³Ø·",
    SERIOUS = "Ø®Ø·ÙŠØ±",
    CRITICAL = "Ø­Ø±Ø¬"
}

/**
 * Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø­Ù„
 * Resolution Strategies
 */
export enum ResolutionStrategy {
    COLLABORATION = "Ø§Ù„ØªØ¹Ø§ÙˆÙ†",
    COMPROMISE = "Ø§Ù„ØªØ³ÙˆÙŠØ©",
    ACCOMMODATION = "Ø§Ù„ØªÙƒÙŠÙ",
    AVOIDANCE = "Ø§Ù„ØªØ¬Ù†Ø¨",
    COMPETITION = "Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©",
    MEDIATION = "Ø§Ù„ÙˆØ³Ø§Ø·Ø©",
    NEGOTIATION = "Ø§Ù„ØªÙØ§ÙˆØ¶"
}

/**
 * Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ù„
 * Resolution Outcomes
 */
export enum ResolutionOutcome {
    WIN_WIN = "ÙÙˆØ²-ÙÙˆØ²",
    WIN_LOSE = "ÙÙˆØ²-Ø®Ø³Ø§Ø±Ø©",
    LOSE_LOSE = "Ø®Ø³Ø§Ø±Ø©-Ø®Ø³Ø§Ø±Ø©",
    PARTIAL = "Ø¬Ø²Ø¦ÙŠ",
    UNRESOLVED = "ØºÙŠØ± Ù…Ø­Ù„ÙˆÙ„"
}

// ==================== Ø§Ù„ÙØ¦Ø§Øª ====================

/**
 * Ù†Ø²Ø§Ø¹
 * Conflict
 */
export class Conflict extends MotherEquation {
    public conflictId: string;
    public conflictType: ConflictType;
    public severity: ConflictSeverity;
    public parties: Array<string>;
    public description: string;
    public rootCauses: Array<string>;
    public emotionsInvolved: Array<string>;
    public context: string | null;
    public timestamp: number;

    constructor(
        conflictType: ConflictType,
        severity: ConflictSeverity,
        description: string
    ) {
        super(`conflict_${Date.now()}`, {}, {});
        this.conflictId = this.id;
        this.conflictType = conflictType;
        this.severity = severity;
        this.description = description;
        this.parties = [];
        this.rootCauses = [];
        this.emotionsInvolved = [];
        this.context = null;
        this.timestamp = Date.now();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø·Ø±Ù
     */
    public addParty(party: string): void {
        if (!this.parties.includes(party)) {
            this.parties.push(party);
        }
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø³Ø¨Ø¨ Ø¬Ø°Ø±ÙŠ
     */
    public addRootCause(cause: string): void {
        if (!this.rootCauses.includes(cause)) {
            this.rootCauses.push(cause);
        }
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø¹Ø± Ù…ØªÙˆØ±Ø·Ø©
     */
    public addEmotion(emotion: string): void {
        if (!this.emotionsInvolved.includes(emotion)) {
            this.emotionsInvolved.push(emotion);
        }
    }

    /**
     * Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù†Ø²Ø§Ø¹
     */
    public getComplexityScore(): number {
        let base = 0.3;

        // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø±Ø§Ù
        let partiesScore = Math.min(0.3, this.parties.length * 0.1);

        // Ø§Ù„Ø´Ø¯Ø©
        let severityMap = new Map<ConflictSeverity, number>([
            [ConflictSeverity.MINOR, 0.1],
            [ConflictSeverity.MODERATE, 0.2],
            [ConflictSeverity.SERIOUS, 0.3],
            [ConflictSeverity.CRITICAL, 0.4]
        ]);
        let severityScore = severityMap.get(this.severity) || 0.2;

        // Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…ØªÙˆØ±Ø·Ø©
        let emotionsScore = Math.min(0.2, this.emotionsInvolved.length * 0.05);

        return Math.min(1.0, base + partiesScore + severityScore + emotionsScore);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØµÙ Ø§Ù„Ù†Ø²Ø§Ø¹
     */
    public getDescription(): string {
        let desc = `Ù†Ø²Ø§Ø¹: ${this.conflictType}\n`;
        desc += `Ø§Ù„Ø´Ø¯Ø©: ${this.severity}\n`;
        desc += `Ø§Ù„ÙˆØµÙ: ${this.description}\n`;
        desc += `Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯: ${(this.getComplexityScore() * 100).toFixed(0)}%\n`;
        desc += `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø±Ø§Ù: ${this.parties.length}\n`;

        if (this.parties.length > 0) {
            desc += `Ø§Ù„Ø£Ø·Ø±Ø§Ù: ${this.parties.join(", ")}\n`;
        }

        if (this.rootCauses.length > 0) {
            desc += `\nØ§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠØ©:\n`;
            this.rootCauses.forEach((cause, i) => {
                desc += `  ${i + 1}. ${cause}\n`;
            });
        }

        if (this.emotionsInvolved.length > 0) {
            desc += `\nØ§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…ØªÙˆØ±Ø·Ø©: ${this.emotionsInvolved.join(", ")}\n`;
        }

        return desc;
    }
}

/**
 * Ø®Ø·Ø© Ø­Ù„
 * Resolution Plan
 */
export class ResolutionPlan extends MotherEquation {
    public planId: string;
    public conflictId: string;
    public strategy: ResolutionStrategy;
    public steps: Array<string>;
    public expectedOutcome: ResolutionOutcome;
    public successProbability: number; // 0.0 - 1.0
    public estimatedTime: number; // Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª
    public resourcesNeeded: Array<string>;
    public timestamp: number;

    constructor(
        conflictId: string,
        strategy: ResolutionStrategy,
        expectedOutcome: ResolutionOutcome = ResolutionOutcome.WIN_WIN
    ) {
        super(`resolution_plan_${Date.now()}`, {}, {});
        this.planId = this.id;
        this.conflictId = conflictId;
        this.strategy = strategy;
        this.expectedOutcome = expectedOutcome;
        this.steps = [];
        this.successProbability = 0.5;
        this.estimatedTime = 1.0;
        this.resourcesNeeded = [];
        this.timestamp = Date.now();
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ©
     */
    public addStep(step: string): void {
        this.steps.push(step);
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ù…Ø·Ù„ÙˆØ¨
     */
    public addResource(resource: string): void {
        if (!this.resourcesNeeded.includes(resource)) {
            this.resourcesNeeded.push(resource);
        }
    }

    /**
     * ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
     */
    public applyStrategy(): void {
        this.steps = [];

        switch (this.strategy) {
            case ResolutionStrategy.COLLABORATION:
                this.steps.push("ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©");
                this.steps.push("Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø­Ù„ÙˆÙ„ Ù…Ø¨ØªÙƒØ±Ø©");
                this.steps.push("Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹Ø§Ù‹ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¬Ù…ÙŠØ¹");
                this.successProbability = 0.8;
                this.estimatedTime = 3.0;
                break;

            case ResolutionStrategy.COMPROMISE:
                this.steps.push("ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§ÙˆØ¶");
                this.steps.push("Ø¥ÙŠØ¬Ø§Ø¯ Ø­Ù„ ÙˆØ³Ø·");
                this.steps.push("Ø§Ù„ØªÙ†Ø§Ø²Ù„ Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„");
                this.successProbability = 0.7;
                this.estimatedTime = 2.0;
                break;

            case ResolutionStrategy.ACCOMMODATION:
                this.steps.push("ÙÙ‡Ù… Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±");
                this.steps.push("Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ù…ØªØ·Ù„Ø¨Ø§ØªÙ‡");
                this.steps.push("Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©");
                this.successProbability = 0.6;
                this.estimatedTime = 1.0;
                break;

            case ResolutionStrategy.AVOIDANCE:
                this.steps.push("ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©");
                this.steps.push("Ø¥Ø¹Ø·Ø§Ø¡ ÙˆÙ‚Øª Ù„Ù„ØªÙ‡Ø¯Ø¦Ø©");
                this.steps.push("Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø± Ù„Ø§Ø­Ù‚Ø§Ù‹");
                this.successProbability = 0.4;
                this.estimatedTime = 0.5;
                break;

            case ResolutionStrategy.COMPETITION:
                this.steps.push("ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ù Ø¨ÙˆØ¶ÙˆØ­");
                this.steps.push("Ø§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù…ØµØ§Ù„Ø­");
                this.steps.push("Ø§Ù„Ø³Ø¹ÙŠ Ù„Ù„ÙÙˆØ²");
                this.successProbability = 0.5;
                this.estimatedTime = 1.5;
                break;

            case ResolutionStrategy.MEDIATION:
                this.steps.push("Ø¥Ø´Ø±Ø§Ùƒ Ø·Ø±Ù Ø«Ø§Ù„Ø« Ù…Ø­Ø§ÙŠØ¯");
                this.steps.push("ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ø±");
                this.steps.push("Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§ØªÙØ§Ù‚");
                this.successProbability = 0.75;
                this.estimatedTime = 2.5;
                this.addResource("ÙˆØ³ÙŠØ· Ù…Ø­Ø§ÙŠØ¯");
                break;

            case ResolutionStrategy.NEGOTIATION:
                this.steps.push("ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ù ÙˆØ§Ù„Ù…ØµØ§Ù„Ø­");
                this.steps.push("ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶");
                this.steps.push("Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§ØªÙØ§Ù‚");
                this.successProbability = 0.7;
                this.estimatedTime = 2.0;
                break;
        }
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø©
     */
    public getReport(): string {
        let report = `Ø®Ø·Ø© Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹\n`;
        report += `${"=".repeat(40)}\n\n`;
        report += `Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©: ${this.strategy}\n`;
        report += `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: ${this.expectedOutcome}\n`;
        report += `Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${(this.successProbability * 100).toFixed(0)}%\n`;
        report += `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: ${this.estimatedTime.toFixed(1)} Ø³Ø§Ø¹Ø©\n\n`;

        if (this.steps.length > 0) {
            report += `Ø§Ù„Ø®Ø·ÙˆØ§Øª:\n`;
            this.steps.forEach((step, i) => {
                report += `  ${i + 1}. ${step}\n`;
            });
        }

        if (this.resourcesNeeded.length > 0) {
            report += `\nØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\n`;
            this.resourcesNeeded.forEach((resource, i) => {
                report += `  ${i + 1}. ${resource}\n`;
            });
        }

        return report;
    }
}

/**
 * Ù†Ø¸Ø§Ù… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
 * Conflict Resolution System
 */
export class ConflictResolutionSystem extends MotherEquation {
    public conflicts: Map<string, Conflict>;
    public resolutionPlans: Map<string, ResolutionPlan>;
    public resolvedConflicts: Array<{ conflict: Conflict; plan: ResolutionPlan; outcome: ResolutionOutcome }>;
    public maxHistorySize: number;

    constructor() {
        super("conflict_resolution_system", {}, {});
        this.conflicts = new Map();
        this.resolutionPlans = new Map();
        this.resolvedConflicts = [];
        this.maxHistorySize = 100;
    }

    /**
     * ØªØ³Ø¬ÙŠÙ„ Ù†Ø²Ø§Ø¹ Ø¬Ø¯ÙŠØ¯
     */
    public registerConflict(conflict: Conflict): void {
        this.conflicts.set(conflict.conflictId, conflict);
        console.log(`âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†Ø²Ø§Ø¹ Ø¬Ø¯ÙŠØ¯: ${conflict.conflictType} (${conflict.severity})`);
    }

    /**
     * Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø­Ù„
     */
    public suggestStrategy(conflict: Conflict): ResolutionStrategy {
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ ÙˆØ´Ø¯Ø© Ø§Ù„Ù†Ø²Ø§Ø¹

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© ØªØ­ØªØ§Ø¬ ÙˆØ³Ø§Ø·Ø©
        if (conflict.severity === ConflictSeverity.CRITICAL) {
            return ResolutionStrategy.MEDIATION;
        }

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù‚ÙŠÙ…ÙŠØ© ØªØ­ØªØ§Ø¬ ØªØ¹Ø§ÙˆÙ†
        if (conflict.conflictType === ConflictType.VALUE_BASED) {
            return ResolutionStrategy.COLLABORATION;
        }

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙŠÙ…ÙƒÙ† ØªØ¬Ù†Ø¨Ù‡Ø§
        if (conflict.severity === ConflictSeverity.MINOR) {
            return ResolutionStrategy.AVOIDANCE;
        }

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù…Ù‡Ø§Ù… ØªØ­ØªØ§Ø¬ ØªÙØ§ÙˆØ¶
        if (conflict.conflictType === ConflictType.TASK_BASED) {
            return ResolutionStrategy.NEGOTIATION;
        }

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ØªØ­ØªØ§Ø¬ ØªØ³ÙˆÙŠØ©
        if (conflict.conflictType === ConflictType.RESOURCE_BASED) {
            return ResolutionStrategy.COMPROMISE;
        }

        // Ø³ÙˆØ¡ Ø§Ù„ØªÙˆØ§ØµÙ„ ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø§ÙˆÙ†
        if (conflict.conflictType === ConflictType.COMMUNICATION) {
            return ResolutionStrategy.COLLABORATION;
        }

        // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„ØªÙØ§ÙˆØ¶
        return ResolutionStrategy.NEGOTIATION;
    }

    /**
     * Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø­Ù„
     */
    public createResolutionPlan(
        conflict: Conflict,
        strategy?: ResolutionStrategy
    ): ResolutionPlan {
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙØ­Ø¯Ø¯
        if (!strategy) {
            strategy = this.suggestStrategy(conflict);
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
        let expectedOutcome = ResolutionOutcome.WIN_WIN;
        if (strategy === ResolutionStrategy.COMPETITION) {
            expectedOutcome = ResolutionOutcome.WIN_LOSE;
        } else if (strategy === ResolutionStrategy.AVOIDANCE) {
            expectedOutcome = ResolutionOutcome.PARTIAL;
        } else if (strategy === ResolutionStrategy.COMPROMISE) {
            expectedOutcome = ResolutionOutcome.WIN_WIN;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©
        let plan = new ResolutionPlan(conflict.conflictId, strategy, expectedOutcome);
        plan.applyStrategy();

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯
        let complexity = conflict.getComplexityScore();
        plan.successProbability *= (1.0 - complexity * 0.3);

        // Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©
        this.resolutionPlans.set(plan.planId, plan);

        console.log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø­Ù„: ${strategy}`);
        console.log(`   Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${(plan.successProbability * 100).toFixed(0)}%`);

        return plan;
    }

    /**
     * ØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„Ø­Ù„
     */
    public executePlan(planId: string, actualOutcome: ResolutionOutcome): void {
        let plan = this.resolutionPlans.get(planId);
        if (!plan) {
            console.error(`âŒ Ø®Ø·Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©: ${planId}`);
            return;
        }

        let conflict = this.conflicts.get(plan.conflictId);
        if (!conflict) {
            console.error(`âŒ Ù†Ø²Ø§Ø¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: ${plan.conflictId}`);
            return;
        }

        // Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©
        this.resolvedConflicts.push({ conflict, plan, outcome: actualOutcome });

        // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù†Ø´Ø·Ø©
        this.conflicts.delete(conflict.conflictId);

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„
        if (this.resolvedConflicts.length > this.maxHistorySize) {
            this.resolvedConflicts.shift();
        }

        console.log(`âœ… ØªÙ… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹: ${conflict.conflictType}`);
        console.log(`   Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${actualOutcome}`);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
     */
    public getActiveConflicts(): Array<Conflict> {
        return Array.from(this.conflicts.values());
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¯Ø©
     */
    public getConflictsBySeverity(severity: ConflictSeverity): Array<Conflict> {
        return this.getActiveConflicts().filter(c => c.severity === severity);
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
     */
    public getStatistics(): any {
        let totalActive = this.conflicts.size;
        let totalResolved = this.resolvedConflicts.length;
        let totalPlans = this.resolutionPlans.size;

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø´Ø¯Ø©
        let severityDistribution = new Map<ConflictSeverity, number>();
        this.conflicts.forEach(conflict => {
            let count = severityDistribution.get(conflict.severity) || 0;
            severityDistribution.set(conflict.severity, count + 1);
        });

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†ÙˆØ¹
        let typeDistribution = new Map<ConflictType, number>();
        this.conflicts.forEach(conflict => {
            let count = typeDistribution.get(conflict.conflictType) || 0;
            typeDistribution.set(conflict.conflictType, count + 1);
        });

        // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­
        let successfulResolutions = this.resolvedConflicts.filter(
            r => r.outcome === ResolutionOutcome.WIN_WIN || r.outcome === ResolutionOutcome.PARTIAL
        ).length;
        let successRate = totalResolved > 0 ? successfulResolutions / totalResolved : 0;

        return {
            totalActiveConflicts: totalActive,
            totalResolvedConflicts: totalResolved,
            totalPlans: totalPlans,
            successRate: successRate,
            severityDistribution: Object.fromEntries(severityDistribution),
            typeDistribution: Object.fromEntries(typeDistribution)
        };
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
     */
    public getComprehensiveReport(): string {
        let stats = this.getStatistics();
        let report = `ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù†Ø¸Ø§Ù… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª\n`;
        report += `${"=".repeat(50)}\n\n`;

        report += `Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: ${stats.totalActiveConflicts}\n`;
        report += `Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©: ${stats.totalResolvedConflicts}\n`;
        report += `Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${(stats.successRate * 100).toFixed(0)}%\n\n`;

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©
        let critical = this.getConflictsBySeverity(ConflictSeverity.CRITICAL);
        if (critical.length > 0) {
            report += `âš ï¸ Ù†Ø²Ø§Ø¹Ø§Øª Ø­Ø±Ø¬Ø© (${critical.length}):\n`;
            critical.forEach((c, i) => {
                report += `  ${i + 1}. ${c.description}\n`;
            });
            report += `\n`;
        }

        // Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©
        let serious = this.getConflictsBySeverity(ConflictSeverity.SERIOUS);
        if (serious.length > 0) {
            report += `âš ï¸ Ù†Ø²Ø§Ø¹Ø§Øª Ø®Ø·ÙŠØ±Ø© (${serious.length}):\n`;
            serious.forEach((c, i) => {
                report += `  ${i + 1}. ${c.description}\n`;
            });
        }

        return report;
    }
}

