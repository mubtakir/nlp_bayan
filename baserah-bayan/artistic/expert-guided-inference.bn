/**
 * Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø¨Ø§Ù„Ø®Ø¨ÙŠØ± - Expert-Guided Inference
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Ø§Ù„ÙˆØµÙ: Ù…Ù†Ø³Ù‚ Ù…ØªÙ‚Ø¯Ù… ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø¨ÙŠØ±/Ø§Ù„Ù…Ø³ØªÙƒØ´Ù Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø·
 * Ø§Ù„Ù‡Ø¯Ù: ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø°ÙƒÙŠ
 * Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©: Ø§Ù„Ø®Ø¨ÙŠØ± + Ø§Ù„Ù…Ø³ØªÙƒØ´Ù + Ø§Ù„Ù†Ø¸Ø±ÙŠØ§Øª Ø§Ù„Ø«Ù„Ø§Ø«
 * 
 * Ø§Ù„Ù…Ø·ÙˆØ±: Ø¨ØµÙŠØ±Ø© AI
 * Ø§Ù„ØªØ§Ø±ÙŠØ®: 2025-10-26
 */

import { BaserahIntegratedExpertExplorer } from "../brain/integrated-expert-explorer.bn";
import { SigmoidInferenceEngine, InferenceResult, ExtractedFeatures } from "./sigmoid-inference-engine.bn";
import { SigmoidShapeEquation } from "./sigmoid-shape-equation.bn";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø·
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum InferenceStrategy {
    EXPERT_LED = "expert_led",          // ÙŠÙ‚ÙˆØ¯ Ø§Ù„Ø®Ø¨ÙŠØ±
    EXPLORER_LED = "explorer_led",      // ÙŠÙ‚ÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
    BALANCED = "balanced",              // Ù…ØªÙˆØ§Ø²Ù†
    ADAPTIVE = "adaptive"               // ØªÙƒÙŠÙÙŠ
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ø¨ÙŠØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum ExpertMode {
    CONSERVATIVE = "conservative",      // Ù…Ø­Ø§ÙØ¸
    BALANCED = "balanced",              // Ù…ØªÙˆØ§Ø²Ù†
    AGGRESSIVE = "aggressive"           // Ø¬Ø±ÙŠØ¡
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum ExplorerMode {
    CAUTIOUS = "cautious",              // Ø­Ø°Ø±
    BALANCED = "balanced",              // Ù…ØªÙˆØ§Ø²Ù†
    ADVENTUROUS = "adventurous"         // Ù…ØºØ§Ù…Ø±
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ø§Ù„Ø®Ø¨ÙŠØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ExpertGuidance {
    confidenceThreshold: number;        // Ø¹ØªØ¨Ø© Ø§Ù„Ø«Ù‚Ø©
    strategy: InferenceStrategy;        // Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§
    mode: ExpertMode;                   // Ø§Ù„Ù†Ù…Ø·
    reasoning: string;                  // Ø§Ù„ØªÙØ³ÙŠØ±
    recommendedTerms: number;           // Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡
    
    constructor() {
        this.confidenceThreshold = 0.7;
        this.strategy = InferenceStrategy.BALANCED;
        this.mode = ExpertMode.BALANCED;
        this.reasoning = "";
        this.recommendedTerms = 3;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ExplorerGuidance {
    explorationDepth: number;           // Ø¹Ù…Ù‚ Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù
    strategy: InferenceStrategy;        // Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§
    mode: ExplorerMode;                 // Ø§Ù„Ù†Ù…Ø·
    reasoning: string;                  // Ø§Ù„ØªÙØ³ÙŠØ±
    alternativeTerms: number[];         // Ø£Ø¹Ø¯Ø§Ø¯ Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø­Ø¯ÙˆØ¯
    
    constructor() {
        this.explorationDepth = 0.5;
        this.strategy = InferenceStrategy.BALANCED;
        this.mode = ExplorerMode.BALANCED;
        this.reasoning = "";
        this.alternativeTerms = [];
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù‚Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class CoordinationDecision {
    primaryResult: InferenceResult;             // Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    alternativeResults: InferenceResult[];      // Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
    strategyUsed: InferenceStrategy;            // Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
    expertConfidence: number;                   // Ø«Ù‚Ø© Ø§Ù„Ø®Ø¨ÙŠØ±
    explorerConfidence: number;                 // Ø«Ù‚Ø© Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
    finalConfidence: number;                    // Ø§Ù„Ø«Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    reasoning: string;                          // Ø§Ù„ØªÙØ³ÙŠØ±
    timestamp: number;                          // Ø§Ù„ÙˆÙ‚Øª
    
    constructor(primaryResult: InferenceResult) {
        this.primaryResult = primaryResult;
        this.alternativeResults = [];
        this.strategyUsed = InferenceStrategy.BALANCED;
        this.expertConfidence = 0.5;
        this.explorerConfidence = 0.5;
        this.finalConfidence = 0.5;
        this.reasoning = "";
        this.timestamp = Date.now();
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù…Ù†Ø³Ù‚ Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø¨Ø§Ù„Ø®Ø¨ÙŠØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ExpertGuidedInferenceCoordinator {
    coordinatorId: string;
    expertExplorer: BaserahIntegratedExpertExplorer;    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø¨ÙŠØ±/Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
    inferenceEngine: SigmoidInferenceEngine;            // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø·
    
    // Ù…Ø¹Ø§Ù…Ù„Ø§Øª
    expertConfidenceThreshold: number;
    explorerExplorationDepth: number;
    
    // Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª
    decisionHistory: CoordinationDecision[];
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
    performanceMetrics: object;
    
    constructor(coordinatorId: string) {
        this.coordinatorId = coordinatorId;
        this.expertExplorer = new BaserahIntegratedExpertExplorer(
            coordinatorId + "_brain",
            "inference"
        );
        this.inferenceEngine = new SigmoidInferenceEngine(coordinatorId + "_engine");
        
        this.expertConfidenceThreshold = 0.75;
        this.explorerExplorationDepth = 0.5;
        
        this.decisionHistory = [];
        
        this.performanceMetrics = {
            totalInferences: 0,
            expertLedDecisions: 0,
            explorerLedDecisions: 0,
            balancedDecisions: 0,
            avgConfidence: 0.0,
            successRate: 0.0
        };
        
        console.log("ğŸ§¬ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø³Ù‚ Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø¨Ø§Ù„Ø®Ø¨ÙŠØ±");
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø·
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function coordinateInference(xData: number[], yData: number[]): CoordinationDecision {
        console.log("ğŸ” Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø§Ù„Ù…ÙˆØ¬Ù‡...");
        
        // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø§Ù„Ø£ÙˆÙ„ÙŠ
        let initialResult = this.inferenceEngine.inferFromPoints(xData, yData);
        
        // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø®Ø¨ÙŠØ±
        let expertGuidance = this.consultExpert(initialResult);
        
        // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
        let explorerGuidance = this.consultExplorer(initialResult);
        
        // Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
        let decision = this.makeCoordinationDecision(
            initialResult,
            expertGuidance,
            explorerGuidance,
            xData,
            yData
        );
        
        // Ø§Ù„Ø®Ø·ÙˆØ© 5: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±
        this.decisionHistory.push(decision);
        this.updateMetrics(decision);
        
        console.log(`âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙ†Ø¨Ø§Ø· - Ø§Ù„Ø«Ù‚Ø©: ${decision.finalConfidence.toFixed(3)}`);
        
        return decision;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø®Ø¨ÙŠØ±
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function consultExpert(result: InferenceResult): ExpertGuidance {
        let guidance = new ExpertGuidance();
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        let confidence = result.confidence;
        let features = result.features;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…Ø· ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
        if (confidence > 0.85) {
            guidance.mode = ExpertMode.AGGRESSIVE;
            guidance.confidenceThreshold = 0.6;
            guidance.strategy = InferenceStrategy.EXPERT_LED;
            guidance.reasoning = "Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ø«Ù‚ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©";
        } else if (confidence > 0.7) {
            guidance.mode = ExpertMode.BALANCED;
            guidance.confidenceThreshold = 0.7;
            guidance.strategy = InferenceStrategy.BALANCED;
            guidance.reasoning = "Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ø«Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©";
        } else {
            guidance.mode = ExpertMode.CONSERVATIVE;
            guidance.confidenceThreshold = 0.8;
            guidance.strategy = InferenceStrategy.EXPLORER_LED;
            guidance.reasoning = "Ø§Ù„Ø®Ø¨ÙŠØ± ØºÙŠØ± ÙˆØ§Ø«Ù‚ØŒ ÙŠÙØ¶Ù„ Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù";
        }
        
        // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡
        if (features.complexity > 2.0) {
            guidance.recommendedTerms = 5;
        } else if (features.complexity > 1.0) {
            guidance.recommendedTerms = 3;
        } else {
            guidance.recommendedTerms = 2;
        }
        
        console.log(`ğŸ‘¨â€ğŸ« Ø§Ù„Ø®Ø¨ÙŠØ±: ${guidance.reasoning}`);
        
        return guidance;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙƒØ´Ù
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function consultExplorer(result: InferenceResult): ExplorerGuidance {
        let guidance = new ExplorerGuidance();
        
        let confidence = result.confidence;
        let features = result.features;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…Ø· ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
        if (confidence < 0.5) {
            guidance.mode = ExplorerMode.ADVENTUROUS;
            guidance.explorationDepth = 0.8;
            guidance.strategy = InferenceStrategy.EXPLORER_LED;
            guidance.reasoning = "Ø§Ù„Ù…Ø³ØªÙƒØ´Ù ÙŠÙˆØµÙŠ Ø¨Ø§Ø³ØªÙƒØ´Ø§Ù Ø¹Ù…ÙŠÙ‚";
        } else if (confidence < 0.7) {
            guidance.mode = ExplorerMode.BALANCED;
            guidance.explorationDepth = 0.5;
            guidance.strategy = InferenceStrategy.BALANCED;
            guidance.reasoning = "Ø§Ù„Ù…Ø³ØªÙƒØ´Ù ÙŠÙˆØµÙŠ Ø¨Ø§Ø³ØªÙƒØ´Ø§Ù Ù…ØªÙˆØ§Ø²Ù†";
        } else {
            guidance.mode = ExplorerMode.CAUTIOUS;
            guidance.explorationDepth = 0.3;
            guidance.strategy = InferenceStrategy.EXPERT_LED;
            guidance.reasoning = "Ø§Ù„Ù…Ø³ØªÙƒØ´Ù ÙŠÙˆØµÙŠ Ø¨Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¨ÙŠØ±";
        }
        
        // Ø§Ù‚ØªØ±Ø§Ø­ Ø£Ø¹Ø¯Ø§Ø¯ Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø­Ø¯ÙˆØ¯
        let currentTerms = result.equation.sigmoidTerms.length;
        guidance.alternativeTerms = [
            Math.max(1, currentTerms - 1),
            currentTerms + 1,
            currentTerms + 2
        ];
        
        console.log(`ğŸ”­ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù: ${guidance.reasoning}`);

        return guidance;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function makeCoordinationDecision(
        initialResult: InferenceResult,
        expertGuidance: ExpertGuidance,
        explorerGuidance: ExplorerGuidance,
        xData: number[],
        yData: number[]
    ): CoordinationDecision {

        let decision = new CoordinationDecision(initialResult);

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        if (expertGuidance.strategy === InferenceStrategy.EXPERT_LED &&
            explorerGuidance.strategy === InferenceStrategy.EXPERT_LED) {
            decision.strategyUsed = InferenceStrategy.EXPERT_LED;
            decision.expertConfidence = 0.9;
            decision.explorerConfidence = 0.6;
        } else if (expertGuidance.strategy === InferenceStrategy.EXPLORER_LED &&
                   explorerGuidance.strategy === InferenceStrategy.EXPLORER_LED) {
            decision.strategyUsed = InferenceStrategy.EXPLORER_LED;
            decision.expertConfidence = 0.4;
            decision.explorerConfidence = 0.9;
        } else {
            decision.strategyUsed = InferenceStrategy.BALANCED;
            decision.expertConfidence = 0.7;
            decision.explorerConfidence = 0.7;
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø«Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        decision.finalConfidence = (
            initialResult.confidence * 0.5 +
            decision.expertConfidence * 0.3 +
            decision.explorerConfidence * 0.2
        );

        // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙØ³ÙŠØ±
        decision.reasoning = this.buildReasoning(
            initialResult,
            expertGuidance,
            explorerGuidance,
            decision
        );

        return decision;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙØ³ÙŠØ±
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function buildReasoning(
        result: InferenceResult,
        expertGuidance: ExpertGuidance,
        explorerGuidance: ExplorerGuidance,
        decision: CoordinationDecision
    ): string {

        let reasoning = `Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©: ${decision.strategyUsed}. `;
        reasoning += expertGuidance.reasoning + ". ";
        reasoning += explorerGuidance.reasoning + ". ";
        reasoning += `Ø§Ù„Ø«Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${decision.finalConfidence.toFixed(3)}`;

        return reasoning;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function updateMetrics(decision: CoordinationDecision): void {
        this.performanceMetrics.totalInferences++;

        if (decision.strategyUsed === InferenceStrategy.EXPERT_LED) {
            this.performanceMetrics.expertLedDecisions++;
        } else if (decision.strategyUsed === InferenceStrategy.EXPLORER_LED) {
            this.performanceMetrics.explorerLedDecisions++;
        } else {
            this.performanceMetrics.balancedDecisions++;
        }

        // ØªØ­Ø¯ÙŠØ« Ù…ØªÙˆØ³Ø· Ø§Ù„Ø«Ù‚Ø©
        let total = this.performanceMetrics.totalInferences;
        let prevAvg = this.performanceMetrics.avgConfidence;
        this.performanceMetrics.avgConfidence =
            (prevAvg * (total - 1) + decision.finalConfidence) / total;

        // Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­
        if (decision.finalConfidence > 0.7) {
            let prevSuccess = this.performanceMetrics.successRate * (total - 1);
            this.performanceMetrics.successRate = (prevSuccess + 1) / total;
        } else {
            let prevSuccess = this.performanceMetrics.successRate * (total - 1);
            this.performanceMetrics.successRate = prevSuccess / total;
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function getMetrics(): object {
        return {
            totalInferences: this.performanceMetrics.totalInferences,
            expertLedDecisions: this.performanceMetrics.expertLedDecisions,
            explorerLedDecisions: this.performanceMetrics.explorerLedDecisions,
            balancedDecisions: this.performanceMetrics.balancedDecisions,
            avgConfidence: this.performanceMetrics.avgConfidence,
            successRate: this.performanceMetrics.successRate
        };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function getDecisionHistory(): CoordinationDecision[] {
        return this.decisionHistory;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªØµØ¯ÙŠØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export {
    ExpertGuidedInferenceCoordinator,
    CoordinationDecision,
    ExpertGuidance,
    ExplorerGuidance,
    InferenceStrategy,
    ExpertMode,
    ExplorerMode
};
