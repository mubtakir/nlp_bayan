/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ’¬ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ - Response Generator
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ø¯ÙˆÙ† Ø´Ø¨ÙƒØ§Øª Ø¹ØµØ¨ÙŠØ©
 * ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„ØªÙƒÙŠÙÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ÙˆØ¯ Ø·Ø¨ÙŠØ¹ÙŠØ©
 * 
 * Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:
 * - ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ (Response Generation)
 * - ØªØ®ØµÙŠØµ Ø§Ù„Ø±Ø¯ÙˆØ¯ (Response Personalization)
 * - ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ø±Ø¯ÙˆØ¯ (Response Variation)
 * - ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ (Response Quality Assessment)
 * 
 * @author Al-Mubtakir
 * @version 1.0.0
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import { MotherEquation } from "../core/mother-equation.bn";
import { DialogueTurn, DialogueContext, DialogueState } from "./dialogue-manager.bn";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ Ø§Ù„ØªØ¹Ø¯Ø§Ø¯Ø§Øª - Enumerations
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±Ø¯ÙˆØ¯
 */
enum ResponseType {
    INFORMATIVE = "informative",        // Ø¥Ø¹Ù„Ø§Ù…ÙŠ
    CONFIRMATORY = "confirmatory",      // ØªØ£ÙƒÙŠØ¯ÙŠ
    CLARIFYING = "clarifying",          // ØªÙˆØ¶ÙŠØ­ÙŠ
    SUGGESTIVE = "suggestive",          // Ø§Ù‚ØªØ±Ø§Ø­ÙŠ
    EMPATHETIC = "empathetic",          // ØªØ¹Ø§Ø·ÙÙŠ
    DIRECTIVE = "directive",            // ØªÙˆØ¬ÙŠÙ‡ÙŠ
    ACKNOWLEDGMENT = "acknowledgment",  // Ø¥Ù‚Ø±Ø§Ø±
    APOLOGETIC = "apologetic"           // Ø§Ø¹ØªØ°Ø§Ø±ÙŠ
}

/**
 * Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„Ø±Ø¯
 */
enum ResponseStyle {
    FORMAL = "formal",              // Ø±Ø³Ù…ÙŠ
    CASUAL = "casual",              // ØºÙŠØ± Ø±Ø³Ù…ÙŠ
    FRIENDLY = "friendly",          // ÙˆØ¯ÙŠ
    PROFESSIONAL = "professional",  // Ø§Ø­ØªØ±Ø§ÙÙŠ
    CONCISE = "concise",            // Ù…ÙˆØ¬Ø²
    DETAILED = "detailed",          // Ù…ÙØµÙ„
    ENCOURAGING = "encouraging"     // Ù…Ø´Ø¬Ø¹
}

/**
 * Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„
 */
enum DetailLevel {
    MINIMAL = "minimal",        // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
    BRIEF = "brief",            // Ù…ÙˆØ¬Ø²
    MODERATE = "moderate",      // Ù…ØªÙˆØ³Ø·
    DETAILED = "detailed",      // Ù…ÙØµÙ„
    COMPREHENSIVE = "comprehensive"  // Ø´Ø§Ù…Ù„
}

/**
 * Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
 */
enum TemplateType {
    GREETING = "greeting",
    FAREWELL = "farewell",
    QUESTION = "question",
    ANSWER = "answer",
    CLARIFICATION = "clarification",
    CONFIRMATION = "confirmation",
    ERROR = "error",
    SUGGESTION = "suggestion"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¦ Ø§Ù„ÙØ¦Ø§Øª - Classes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø¯ (Response Template)
 */
class ResponseTemplate extends MotherEquation {
    public templateType: TemplateType;
    public patterns: array<string>;
    public variables: array<string>;
    public style: ResponseStyle;
    
    constructor(templateType: TemplateType, patterns: array<string>) {
        super(`template_${templateType}`);
        this.templateType = templateType;
        this.patterns = patterns;
        this.variables = [];
        this.style = ResponseStyle.PROFESSIONAL;
        
        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            templateType: templateType,
            patternCount: patterns.length
        };
        
        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            usageCount: 0,
            lastUsed: 0
        };
    }
    
    /**
     * Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
     */
    public fill(variables: object): string {
        // Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…Ø· Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        let pattern = this.patterns[Math.floor(Math.random() * this.patterns.length)];
        
        // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        for (let key in variables) {
            let placeholder = `{${key}}`;
            pattern = pattern.replace(new RegExp(placeholder, 'g'), variables[key]);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        this.dynamicStates.usageCount++;
        this.dynamicStates.lastUsed = Date.now();
        
        return pattern;
    }
}

/**
 * Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø¯ (Generated Response)
 */
class GeneratedResponse extends MotherEquation {
    public text: string;
    public responseType: ResponseType;
    public style: ResponseStyle;
    public detailLevel: DetailLevel;
    public confidence: number;
    public alternatives: array<string>;
    public metadata: object;
    
    constructor(text: string, responseType: ResponseType) {
        super(`response_${Date.now()}`);
        this.text = text;
        this.responseType = responseType;
        this.style = ResponseStyle.PROFESSIONAL;
        this.detailLevel = DetailLevel.MODERATE;
        this.confidence = 0.8;
        this.alternatives = [];
        this.metadata = {};
        
        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            originalText: text,
            responseType: responseType,
            generatedAt: Date.now()
        };
        
        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            text: text,
            confidence: this.confidence,
            alternativeCount: 0
        };
    }
    
    /**
     * Ø¥Ø¶Ø§ÙØ© Ø¨Ø¯ÙŠÙ„
     */
    public addAlternative(alternative: string): void {
        this.alternatives.push(alternative);
        this.dynamicStates.alternativeCount = this.alternatives.length;
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«Ù‚Ø©
     */
    public updateConfidence(confidence: number): void {
        this.confidence = Math.max(0, Math.min(1, confidence));
        this.dynamicStates.confidence = this.confidence;
    }
    
    /**
     * ØªØ·Ø¨ÙŠÙ‚ Ø£Ø³Ù„ÙˆØ¨
     */
    public applyStyle(style: ResponseStyle): void {
        this.style = style;
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨
        if (style === ResponseStyle.FORMAL) {
            // Ø¥Ø¶Ø§ÙØ© ØµÙŠØº Ø±Ø³Ù…ÙŠØ©
            this.text = this.text.replace(/Ø£Ù†Øª/g, "Ø­Ø¶Ø±ØªÙƒ");
        } else if (style === ResponseStyle.CASUAL) {
            // ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù„ØºØ©
            this.text = this.text.replace(/Ø­Ø¶Ø±ØªÙƒ/g, "Ø£Ù†Øª");
        }
        
        this.dynamicStates.text = this.text;
    }
}

/**
 * Ù…Ø®ØµØµ Ø§Ù„Ø±Ø¯ÙˆØ¯ (Response Personalizer)
 */
class ResponsePersonalizer extends MotherEquation {
    public userPreferences: object;
    public interactionHistory: array<object>;
    public personalizationLevel: number;
    
    constructor(personalizerId: string) {
        super(personalizerId);
        this.userPreferences = {
            preferredStyle: ResponseStyle.PROFESSIONAL,
            preferredDetailLevel: DetailLevel.MODERATE,
            language: "ar"
        };
        this.interactionHistory = [];
        this.personalizationLevel = 0.5;
        
        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            personalizerId: personalizerId
        };
        
        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            personalizationLevel: this.personalizationLevel,
            historySize: 0
        };
    }
    
    /**
     * ØªØ®ØµÙŠØµ Ø§Ù„Ø±Ø¯
     */
    public personalize(response: GeneratedResponse, context: DialogueContext): GeneratedResponse {
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…ÙØ¶Ù„
        response.applyStyle(this.userPreferences.preferredStyle);
        
        // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙØµÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„
        response.detailLevel = this.userPreferences.preferredDetailLevel;
        
        // Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ø³Ø§Øª Ø´Ø®ØµÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚
        if (context.activeTopics.length > 0) {
            response.metadata.relatedTopics = context.activeTopics;
        }
        
        return response;
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
     */
    public updatePreferences(preferences: object): void {
        for (let key in preferences) {
            this.userPreferences[key] = preferences[key];
        }
    }
    
    /**
     * ØªØ³Ø¬ÙŠÙ„ ØªÙØ§Ø¹Ù„
     */
    public recordInteraction(interaction: object): void {
        this.interactionHistory.push(interaction);
        this.dynamicStates.historySize = this.interactionHistory.length;
    }
}

/**
 * Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Main Response Generator)
 */
class ResponseGenerator extends MotherEquation {
    public templates: object;
    public personalizer: ResponsePersonalizer;
    public generatedResponses: array<GeneratedResponse>;
    public defaultStyle: ResponseStyle;
    public defaultDetailLevel: DetailLevel;

    constructor(generatorId: string) {
        super(generatorId);
        this.templates = {};
        this.personalizer = new ResponsePersonalizer("main_personalizer");
        this.generatedResponses = [];
        this.defaultStyle = ResponseStyle.PROFESSIONAL;
        this.defaultDetailLevel = DetailLevel.MODERATE;

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        this.initializeDefaultTemplates();

        // Î¦: Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        this.fixedProperties = {
            generatorId: generatorId,
            createdAt: Date.now()
        };

        // Î¨: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        this.dynamicStates = {
            totalGenerated: 0,
            templateCount: Object.keys(this.templates).length
        };
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
     */
    private initializeDefaultTemplates(): void {
        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªØ­ÙŠØ©
        this.templates[TemplateType.GREETING] = new ResponseTemplate(
            TemplateType.GREETING,
            [
                "Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",
                "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.",
                "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…! ØªÙØ¶Ù„ Ø¨Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ."
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ÙˆØ¯Ø§Ø¹
        this.templates[TemplateType.FAREWELL] = new ResponseTemplate(
            TemplateType.FAREWELL,
            [
                "Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! Ø£ØªÙ…Ù†Ù‰ Ø£Ù† Ø£ÙƒÙˆÙ† Ù‚Ø¯ Ø³Ø§Ø¹Ø¯ØªÙƒ.",
                "Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡! Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø¹ÙˆØ¯Ø©.",
                "Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©! ÙƒØ§Ù† Ù…Ù† Ø¯ÙˆØ§Ø¹ÙŠ Ø³Ø±ÙˆØ±ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ."
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        this.templates[TemplateType.QUESTION] = new ResponseTemplate(
            TemplateType.QUESTION,
            [
                "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¶ÙŠØ­ {topic} Ø£ÙƒØ«Ø±ØŸ",
                "Ù…Ø§ Ù‡Ùˆ {detail} Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ Ø¨Ø§Ù„Ø¶Ø¨Ø·ØŸ",
                "Ù‡Ù„ ØªÙ‚ØµØ¯ {clarification}ØŸ"
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        this.templates[TemplateType.ANSWER] = new ResponseTemplate(
            TemplateType.ANSWER,
            [
                "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ {context}ØŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ: {answer}",
                "ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ù† Ø£Ø®Ø¨Ø±Ùƒ Ø£Ù† {answer}",
                "Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ùˆ: {answer}"
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙˆØ¶ÙŠØ­
        this.templates[TemplateType.CLARIFICATION] = new ResponseTemplate(
            TemplateType.CLARIFICATION,
            [
                "Ø¯Ø¹Ù†ÙŠ Ø£ÙˆØ¶Ø­: {explanation}",
                "Ø¨Ù…Ø¹Ù†Ù‰ Ø¢Ø®Ø±ØŒ {explanation}",
                "Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø£Ù…Ø±: {explanation}"
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªØ£ÙƒÙŠØ¯
        this.templates[TemplateType.CONFIRMATION] = new ResponseTemplate(
            TemplateType.CONFIRMATION,
            [
                "ÙÙ‡Ù…Øª! ØªØ±ÙŠØ¯ {action}ØŒ ØµØ­ÙŠØ­ØŸ",
                "Ù‡Ù„ ØªØ¤ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ {action}ØŸ",
                "ØªÙ…Ø§Ù…ØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ù€ {action}. Ù‡Ù„ Ù‡Ø°Ø§ ØµØ­ÙŠØ­ØŸ"
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        this.templates[TemplateType.ERROR] = new ResponseTemplate(
            TemplateType.ERROR,
            [
                "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ÙÙ‡Ù… {issue}. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ©ØŸ",
                "Ø¢Ø³ÙØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ {issue}.",
                "Ù„Ù„Ø£Ø³ÙØŒ Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø¹Ø§Ù„Ø¬Ø© {issue} Ø§Ù„Ø¢Ù†."
            ]
        );

        // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
        this.templates[TemplateType.SUGGESTION] = new ResponseTemplate(
            TemplateType.SUGGESTION,
            [
                "Ø£Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ {suggestion}",
                "Ø±Ø¨Ù…Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø±Ø¨Ø© {suggestion}",
                "Ù…Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø£Ù† {suggestion}"
            ]
        );
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚
     */
    public generate(
        context: DialogueContext,
        responseType: ResponseType,
        content: object
    ): GeneratedResponse {
        let text = "";

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        let templateType = this.mapResponseTypeToTemplate(responseType);
        let template = this.templates[templateType];

        if (template) {
            text = template.fill(content);
        } else {
            // ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            text = this.generateDefaultResponse(responseType, content);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¯
        let response = new GeneratedResponse(text, responseType);
        response.style = this.defaultStyle;
        response.detailLevel = this.defaultDetailLevel;

        // ØªØ®ØµÙŠØµ Ø§Ù„Ø±Ø¯
        response = this.personalizer.personalize(response, context);

        // ØªÙˆÙ„ÙŠØ¯ Ø¨Ø¯Ø§Ø¦Ù„
        this.generateAlternatives(response, template, content);

        // Ø­ÙØ¸ Ø§Ù„Ø±Ø¯
        this.generatedResponses.push(response);
        this.dynamicStates.totalGenerated++;

        return response;
    }

    /**
     * Ø±Ø¨Ø· Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¯ Ø¨Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨
     */
    private mapResponseTypeToTemplate(responseType: ResponseType): TemplateType {
        if (responseType === ResponseType.INFORMATIVE) {
            return TemplateType.ANSWER;
        } else if (responseType === ResponseType.CONFIRMATORY) {
            return TemplateType.CONFIRMATION;
        } else if (responseType === ResponseType.CLARIFYING) {
            return TemplateType.CLARIFICATION;
        } else if (responseType === ResponseType.SUGGESTIVE) {
            return TemplateType.SUGGESTION;
        } else if (responseType === ResponseType.APOLOGETIC) {
            return TemplateType.ERROR;
        }
        return TemplateType.ANSWER;
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ
     */
    private generateDefaultResponse(responseType: ResponseType, content: object): string {
        let text = "Ø£ÙÙ‡Ù… Ù…Ø§ ØªÙ‚ØµØ¯. ";

        if (content.message) {
            text += content.message;
        }

        return text;
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø¨Ø¯Ø§Ø¦Ù„ Ù„Ù„Ø±Ø¯
     */
    private generateAlternatives(
        response: GeneratedResponse,
        template: ResponseTemplate,
        content: object
    ): void {
        if (!template) return;

        // ØªÙˆÙ„ÙŠØ¯ 2-3 Ø¨Ø¯Ø§Ø¦Ù„
        let alternativeCount = Math.min(3, template.patterns.length);
        for (let i = 0; i < alternativeCount; i++) {
            let alternative = template.fill(content);
            if (alternative !== response.text) {
                response.addAlternative(alternative);
            }
        }
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„Ù„ØªØ­ÙŠØ©
     */
    public generateGreeting(): GeneratedResponse {
        return this.generate(
            new DialogueContext("temp"),
            ResponseType.ACKNOWLEDGMENT,
            {}
        );
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„Ù„ÙˆØ¯Ø§Ø¹
     */
    public generateFarewell(): GeneratedResponse {
        let template = this.templates[TemplateType.FAREWELL];
        let text = template.fill({});
        return new GeneratedResponse(text, ResponseType.ACKNOWLEDGMENT);
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ ØªÙˆØ¶ÙŠØ­ÙŠ
     */
    public generateClarification(topic: string): GeneratedResponse {
        return this.generate(
            new DialogueContext("temp"),
            ResponseType.CLARIFYING,
            { topic: topic, explanation: `Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† ${topic}` }
        );
    }

    /**
     * ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ ØªØ£ÙƒÙŠØ¯ÙŠ
     */
    public generateConfirmation(action: string): GeneratedResponse {
        return this.generate(
            new DialogueContext("temp"),
            ResponseType.CONFIRMATORY,
            { action: action }
        );
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ Ù…Ø®ØµØµ
     */
    public addTemplate(templateType: TemplateType, patterns: array<string>): void {
        this.templates[templateType] = new ResponseTemplate(templateType, patterns);
        this.dynamicStates.templateCount = Object.keys(this.templates).length;
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
     */
    public setDefaultStyle(style: ResponseStyle): void {
        this.defaultStyle = style;
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙØµÙŠÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
     */
    public setDefaultDetailLevel(level: DetailLevel): void {
        this.defaultDetailLevel = level;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
     */
    public getStatistics(): object {
        return {
            totalGenerated: this.generatedResponses.length,
            templateCount: Object.keys(this.templates).length,
            averageConfidence: this.calculateAverageConfidence(),
            personalizationLevel: this.personalizer.personalizationLevel
        };
    }

    /**
     * Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø«Ù‚Ø©
     */
    private calculateAverageConfidence(): number {
        if (this.generatedResponses.length === 0) return 0;

        let sum = 0;
        for (let response of this.generatedResponses) {
            sum += response.confidence;
        }
        return sum / this.generatedResponses.length;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¤ Ø§Ù„ØªØµØ¯ÙŠØ± - Exports
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export {
    ResponseType,
    ResponseStyle,
    DetailLevel,
    TemplateType,
    ResponseTemplate,
    GeneratedResponse,
    ResponsePersonalizer,
    ResponseGenerator
};

