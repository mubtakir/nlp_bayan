#!/usr/bin/env bayan
# ============================================================================
# ğŸ™ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
# Integrated Smart City Management System
# ============================================================================
# Ø§Ù„ØªØ­Ø¯ÙŠ: Ø¥Ø¯Ø§Ø±Ø© 5 Ø£Ù†Ø¸Ù…Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 500 Ø³Ø·Ø±!
# Challenge: Manage 5 integrated systems in under 500 lines!
# ============================================================================

# ============================================================================
# 1ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ - Smart Traffic Management
# ============================================================================

# ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªÙ‚Ø§Ø·Ø¹Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø§Ø±Ø§Øª
fact: intersection("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯", "north_south", "green", 60).
fact: intersection("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø¹Ù„ÙŠØ§", "east_west", "green", 45).
fact: intersection("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„ØªØ­Ù„ÙŠØ©", "north_south", "red", 30).
fact: intersection("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø£Ù…ÙŠØ±_Ù…Ø­Ù…Ø¯", "east_west", "yellow", 15).

# Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙˆØ±
fact: traffic_flow("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯", "heavy", 85).
fact: traffic_flow("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø¹Ù„ÙŠØ§", "moderate", 55).
fact: traffic_flow("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„ØªØ­Ù„ÙŠØ©", "light", 25).
fact: traffic_flow("ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø£Ù…ÙŠØ±_Ù…Ø­Ù…Ø¯", "heavy", 90).

# Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
fact: accident("Ø­Ø§Ø¯Ø«_001", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯", "minor", "lane_blocked").
fact: accident("Ø­Ø§Ø¯Ø«_002", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø£Ù…ÙŠØ±_Ù…Ø­Ù…Ø¯", "major", "road_closed").

# Ù‚ÙˆØ§Ø¹Ø¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙˆØ±
rule: needs_extended_green(Intersection) :-
    traffic_flow(Intersection, "heavy", Density),
    Density > 80,
    intersection(Intersection, _, _, _).

rule: needs_traffic_reroute(Intersection) :-
    accident(_, Intersection, Severity, Status),
    Severity = "major",
    Status = "road_closed".

rule: traffic_alert(Intersection, "high_congestion", Priority) :-
    traffic_flow(Intersection, "heavy", Density),
    Density > 85,
    Priority = 9.

# ============================================================================
# 2ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù‚Ø© - Energy Management System
# ============================================================================

# Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø©
fact: power_source("solar_farm_1", "solar", 5000, "active", 85).
fact: power_source("grid_main", "grid", 20000, "active", 100).
fact: power_source("backup_gen_1", "diesel", 3000, "standby", 0).
fact: power_source("wind_farm_1", "wind", 2000, "active", 60).

# Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø·Ø§Ù‚Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
fact: power_consumption("Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", 4500, "normal").
fact: power_consumption("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", 8000, "high").
fact: power_consumption("Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨", 6500, "normal").
fact: power_consumption("Ù…Ù†Ø·Ù‚Ø©_Ù…Ø³ØªØ´ÙÙŠØ§Øª", 3500, "critical").

# Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
fact: grid_status("Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", "stable", 95).
fact: grid_status("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", "overload", 105).
fact: grid_status("Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨", "stable", 88).
fact: grid_status("Ù…Ù†Ø·Ù‚Ø©_Ù…Ø³ØªØ´ÙÙŠØ§Øª", "stable", 92).

# Ù‚ÙˆØ§Ø¹Ø¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ù‚Ø©
rule: use_renewable_first(Source, Capacity) :-
    power_source(Source, Type, Capacity, "active", Efficiency),
    (Type = "solar"; Type = "wind"),
    Efficiency > 50.

rule: activate_backup(Area) :-
    grid_status(Area, "overload", Load),
    Load > 100,
    power_consumption(Area, _, Priority),
    Priority = "critical".

rule: energy_alert(Area, "overload_warning", Priority) :-
    grid_status(Area, "overload", Load),
    Load > 100,
    Priority = 10.

rule: load_balancing_needed(Area, Excess) :-
    grid_status(Area, "overload", Load),
    Excess is Load - 100,
    Excess > 0.

# ============================================================================
# 3ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ù† - Security System
# ============================================================================

# Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
fact: camera("cam_001", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯", "active", "normal").
fact: camera("cam_002", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", "active", "alert").
fact: camera("cam_003", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", "active", "normal").
fact: camera("cam_004", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ø£Ù…ÙŠØ±_Ù…Ø­Ù…Ø¯", "maintenance", "offline").

# Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
fact: security_incident("inc_001", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", "theft", "high", "in_progress").
fact: security_incident("inc_002", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", "suspicious_activity", "medium", "monitoring").

# ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ù†
fact: security_unit("unit_alpha", "patrol", "available", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„").
fact: security_unit("unit_beta", "patrol", "responding", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·").
fact: security_unit("unit_gamma", "emergency", "available", "central_station").
fact: security_unit("unit_delta", "patrol", "available", "Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨").

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ù†
rule: dispatch_security(Unit, Location, Incident) :-
    security_incident(Incident, Location, Type, Priority, "in_progress"),
    Priority = "high",
    security_unit(Unit, _, "available", _).

rule: security_alert(Location, Type, Priority) :-
    security_incident(_, Location, Type, Priority, "in_progress"),
    Priority = "high".

rule: camera_maintenance_needed(Camera, Location) :-
    camera(Camera, Location, "maintenance", "offline").

# ============================================================================
# 4ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© - Public Health System
# ============================================================================

# Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª ÙˆØ§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©
fact: hospital("Ù…Ø³ØªØ´ÙÙ‰_Ø§Ù„Ù…Ù„Ùƒ_ÙÙŠØµÙ„", "Ù…Ù†Ø·Ù‚Ø©_Ù…Ø³ØªØ´ÙÙŠØ§Øª", 500, 450, "high").
fact: hospital("Ù…Ø³ØªØ´ÙÙ‰_Ø§Ù„Ø¹Ù„ÙŠØ§", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", 300, 280, "medium").
fact: hospital("Ù…Ø±ÙƒØ²_ØµØ­ÙŠ_Ø§Ù„Ø´Ù…Ø§Ù„", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", 100, 60, "low").

# Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø³Ø¹Ø§Ù
fact: ambulance("amb_001", "available", "Ù…Ø³ØªØ´ÙÙ‰_Ø§Ù„Ù…Ù„Ùƒ_ÙÙŠØµÙ„").
fact: ambulance("amb_002", "responding", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯").
fact: ambulance("amb_003", "available", "Ù…Ø³ØªØ´ÙÙ‰_Ø§Ù„Ø¹Ù„ÙŠØ§").
fact: ambulance("amb_004", "maintenance", "Ù…Ø±ÙƒØ²_ØµØ­ÙŠ_Ø§Ù„Ø´Ù…Ø§Ù„").

# Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„ØµØ­ÙŠØ©
fact: health_emergency("emr_001", "ØªÙ‚Ø§Ø·Ø¹_Ø§Ù„Ù…Ù„Ùƒ_ÙÙ‡Ø¯", "accident_injury", "critical").
fact: health_emergency("emr_002", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", "cardiac_arrest", "critical").

# Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£ÙˆØ¨Ø¦Ø©
fact: disease_monitoring("Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", "flu", 15, "low_risk").
fact: disease_monitoring("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", "covid", 45, "medium_risk").
fact: disease_monitoring("Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨", "flu", 8, "low_risk").

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
rule: dispatch_ambulance(Ambulance, Location, Emergency) :-
    health_emergency(Emergency, Location, Type, "critical"),
    ambulance(Ambulance, "available", _).

rule: hospital_capacity_alert(Hospital, Available) :-
    hospital(Hospital, _, Capacity, Occupied, _),
    Available is Capacity - Occupied,
    Available < 50.

rule: outbreak_alert(Area, Disease, Priority) :-
    disease_monitoring(Area, Disease, Cases, Risk),
    Cases > 40,
    Risk = "medium_risk",
    Priority = 8.

rule: increase_health_resources(Area) :-
    disease_monitoring(Area, _, Cases, Risk),
    Cases > 40,
    Risk = "medium_risk".

# ============================================================================
# 5ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¦Ø© - Environmental System
# ============================================================================

# Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
fact: air_quality("Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", 45, "good").
fact: air_quality("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", 95, "moderate").
fact: air_quality("Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨", 165, "unhealthy").
fact: air_quality("Ù…Ù†Ø·Ù‚Ø©_Ù…Ø³ØªØ´ÙÙŠØ§Øª", 55, "good").

# Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙØ§ÙŠØ§Øª
fact: waste_management("Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø´Ù…Ø§Ù„", 65, "normal").
fact: waste_management("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", 88, "high").
fact: waste_management("Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨", 92, "critical").

# Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…ÙŠØ§Ù‡
fact: water_quality("reservoir_north", 8.5, "excellent").
fact: water_quality("reservoir_south", 7.2, "good").
fact: water_quality("treatment_plant_1", 8.0, "excellent").

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
rule: pollution_alert(Area, Level, Priority) :-
    air_quality(Area, AQI, Status),
    AQI > 150,
    Status = "unhealthy",
    Priority = 7.

rule: waste_collection_urgent(Area) :-
    waste_management(Area, Level, Status),
    Level > 85,
    Status = "critical".

rule: environmental_action_needed(Area, "reduce_industrial_emissions") :-
    air_quality(Area, AQI, "unhealthy"),
    AQI > 150.

# ============================================================================
# ğŸ”— Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†Ø¸Ù…Ø© - Cross-System Integration
# ============================================================================

# Ø­Ø§Ø¯Ø« Ù…Ø±ÙˆØ± â†’ Ø£Ù…Ù† + ØµØ­Ø©
rule: multi_system_response_accident(Intersection, SecurityUnit, Ambulance) :-
    accident(AccidentId, Intersection, "major", _),
    dispatch_security(SecurityUnit, Intersection, _),
    dispatch_ambulance(Ambulance, Intersection, _).

# Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ â†’ Ù…Ø±ÙˆØ± + Ø£Ù…Ù†
rule: power_outage_response(Area, TrafficImpact, SecurityNeeded) :-
    grid_status(Area, "overload", Load),
    Load > 100,
    TrafficImpact = "traffic_lights_backup_needed",
    SecurityNeeded = "increase_patrol".

# ØªÙ„ÙˆØ« Ø¹Ø§Ù„ÙŠ â†’ Ù…Ø±ÙˆØ± + Ø¨ÙŠØ¦Ø©
rule: pollution_traffic_control(Area, Action) :-
    air_quality(Area, AQI, "unhealthy"),
    AQI > 150,
    Action = "reroute_traffic_from_area".

# ÙˆØ¨Ø§Ø¡ â†’ ØµØ­Ø© + Ù…Ø±ÙˆØ±
rule: outbreak_response(Area, HealthAction, TrafficAction) :-
    disease_monitoring(Area, Disease, Cases, "medium_risk"),
    Cases > 40,
    HealthAction = "increase_health_resources",
    TrafficAction = "limit_public_transport".

# Ø­Ø¯Ø« ÙƒØ¨ÙŠØ± â†’ ØªÙ†Ø³ÙŠÙ‚ ÙƒØ§Ù…Ù„
rule: major_event_coordination(Area, Systems) :-
    accident(_, Area, "major", "road_closed"),
    security_incident(_, Area, _, "high", "in_progress"),
    Systems = ["traffic", "security", "health", "energy"].

# ============================================================================
# ğŸ“Š Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© - Advanced Queries
# ============================================================================

# Ø§Ø³ØªØ¹Ù„Ø§Ù… 1: Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ
rule: critical_area(Area, Reasons) :-
    (traffic_alert(Area, _, Priority1), Priority1 > 8);
    (energy_alert(Area, _, Priority2), Priority2 > 9);
    (security_alert(Area, _, Priority3), Priority3 = "high");
    (pollution_alert(Area, _, Priority4), Priority4 > 6).

# Ø§Ø³ØªØ¹Ù„Ø§Ù… 2: Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„Ø©
rule: system_status(System, Area, Status, Priority) :-
    (System = "traffic", traffic_alert(Area, Status, Priority));
    (System = "energy", energy_alert(Area, Status, Priority));
    (System = "security", security_alert(Area, _, Priority), Status = "incident");
    (System = "health", outbreak_alert(Area, _, Priority), Status = "outbreak");
    (System = "environment", pollution_alert(Area, _, Priority), Status = "pollution").

# Ø§Ø³ØªØ¹Ù„Ø§Ù… 3: Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©
rule: available_resources(Type, Resource, Location) :-
    (Type = "security", security_unit(Resource, _, "available", Location));
    (Type = "health", ambulance(Resource, "available", Location));
    (Type = "energy", power_source(Resource, _, _, "active", _), Location = "grid").

# Ø§Ø³ØªØ¹Ù„Ø§Ù… 4: Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
rule: emergency_plan(Area, Actions) :-
    critical_area(Area, _),
    findall(Action, (
        (needs_traffic_reroute(Area), Action = "reroute_traffic");
        (activate_backup(Area), Action = "activate_backup_power");
        (dispatch_security(_, Area, _), Action = "dispatch_security");
        (increase_health_resources(Area), Action = "increase_health_resources");
        (environmental_action_needed(Area, EnvAction), Action = EnvAction)
    ), Actions).

# Ø§Ø³ØªØ¹Ù„Ø§Ù… 5: ØªØ£Ø«ÙŠØ± Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
rule: cascading_effects(InitialEvent, AffectedSystems) :-
    (accident(InitialEvent, Location, "major", _),
     findall(System, (
         (needs_traffic_reroute(Location), System = "traffic");
         (dispatch_security(_, Location, _), System = "security");
         (dispatch_ambulance(_, Location, _), System = "health")
     ), AffectedSystems)).

# ============================================================================
# ğŸ¯ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Test Scenarios
# ============================================================================

# Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø­Ø§Ø¯Ø« ÙƒØ¨ÙŠØ± ÙÙŠ ØªÙ‚Ø§Ø·Ø¹ Ø±Ø¦ÙŠØ³ÙŠ
fact: scenario("major_accident_scenario", "active").
fact: scenario_trigger("major_accident_scenario", "accident", "Ø­Ø§Ø¯Ø«_002").

# Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø­ÙŠÙˆÙŠØ©
fact: scenario("power_outage_scenario", "active").
fact: scenario_trigger("power_outage_scenario", "energy", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·").

# Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: ØªÙ„ÙˆØ« Ø¨ÙŠØ¦ÙŠ Ø­Ø§Ø¯
fact: scenario("pollution_scenario", "active").
fact: scenario_trigger("pollution_scenario", "environment", "Ù…Ù†Ø·Ù‚Ø©_ØµÙ†Ø§Ø¹ÙŠØ©_Ø¬Ù†ÙˆØ¨").

# Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 4: Ø­Ø§Ù„Ø© Ø·ÙˆØ§Ø±Ø¦ ØµØ­ÙŠØ©
fact: scenario("health_emergency_scenario", "active").
fact: scenario_trigger("health_emergency_scenario", "health", "Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·").

# ============================================================================
# ğŸ“ˆ ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Reports & Statistics
# ============================================================================

# ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙˆØ±
rule: traffic_report(TotalIntersections, HeavyTraffic, Accidents) :-
    findall(I, intersection(I, _, _, _), Intersections),
    length(Intersections, TotalIntersections),
    findall(H, traffic_flow(H, "heavy", _), HeavyList),
    length(HeavyList, HeavyTraffic),
    findall(A, accident(A, _, _, _), AccidentList),
    length(AccidentList, Accidents).

# ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù‚Ø©
rule: energy_report(TotalSources, ActiveSources, TotalCapacity) :-
    findall(S, power_source(S, _, _, _, _), Sources),
    length(Sources, TotalSources),
    findall(A, power_source(A, _, _, "active", _), ActiveList),
    length(ActiveList, ActiveSources),
    findall(C, power_source(_, _, C, "active", _), Capacities),
    sum_list(Capacities, TotalCapacity).

# ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù…Ù†
rule: security_report(TotalIncidents, HighPriority, AvailableUnits) :-
    findall(I, security_incident(I, _, _, _, _), Incidents),
    length(Incidents, TotalIncidents),
    findall(H, security_incident(H, _, _, "high", _), HighList),
    length(HighList, HighPriority),
    findall(U, security_unit(U, _, "available", _), Units),
    length(Units, AvailableUnits).

# ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµØ­Ø©
rule: health_report(TotalHospitals, TotalBeds, OccupiedBeds, AvailableAmbulances) :-
    findall(H, hospital(H, _, _, _, _), Hospitals),
    length(Hospitals, TotalHospitals),
    findall(C, hospital(_, _, C, _, _), Capacities),
    sum_list(Capacities, TotalBeds),
    findall(O, hospital(_, _, _, O, _), Occupied),
    sum_list(Occupied, OccupiedBeds),
    findall(A, ambulance(A, "available", _), Ambulances),
    length(Ambulances, AvailableAmbulances).

# ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø©
rule: environment_report(AreasMonitored, UnhealthyAreas, CriticalWaste) :-
    findall(A, air_quality(A, _, _), Areas),
    length(Areas, AreasMonitored),
    findall(U, air_quality(U, _, "unhealthy"), UnhealthyList),
    length(UnhealthyList, UnhealthyAreas),
    findall(W, waste_management(W, _, "critical"), WasteList),
    length(WasteList, CriticalWaste).

# ============================================================================
# ğŸš¨ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Smart Alert System
# ============================================================================

# ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª
rule: alert_priority(Alert, Priority, Urgency) :-
    (traffic_alert(_, Alert, P1), Priority = P1, Urgency = "immediate", P1 > 8);
    (energy_alert(_, Alert, P2), Priority = P2, Urgency = "critical", P2 > 9);
    (security_alert(_, _, P3), Alert = "security", Priority = 10, Urgency = "critical", P3 = "high");
    (pollution_alert(_, _, P4), Alert = "pollution", Priority = P4, Urgency = "high", P4 > 6).

# ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
rule: all_active_alerts(Alerts) :-
    findall(alert(System, Area, Type, Priority), (
        system_status(System, Area, Type, Priority)
    ), Alerts).

# ØªÙˆØµÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
rule: auto_recommendation(Area, Recommendation, Reason) :-
    (needs_extended_green(Area), 
     Recommendation = "extend_green_light_duration",
     Reason = "heavy_traffic_detected");
    (activate_backup(Area),
     Recommendation = "activate_backup_generator",
     Reason = "grid_overload");
    (waste_collection_urgent(Area),
     Recommendation = "schedule_immediate_waste_collection",
     Reason = "critical_waste_level").

# ============================================================================
# ğŸ“± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… - Query Interface
# ============================================================================

# Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:

# 1. Ù…Ø§ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø±Ø¬Ø©ØŸ
query: critical_area(Area, Reasons).

# 2. Ù…Ø§ Ø­Ø§Ù„Ø© ÙƒÙ„ Ù†Ø¸Ø§Ù…ØŸ
query: system_status(System, Area, Status, Priority).

# 3. Ù…Ø§ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ
query: available_resources(Type, Resource, Location).

# 4. Ù…Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©ØŸ
query: all_active_alerts(Alerts).

# 5. Ù…Ø§ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©ØŸ
query: auto_recommendation(Area, Recommendation, Reason).

# 6. ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø¯ÙŠÙ†Ø©
query: traffic_report(TI, HT, A),
       energy_report(TS, AS, TC),
       security_report(SI, HP, AU),
       health_report(TH, TB, OB, AA),
       environment_report(AM, UA, CW).

# 7. ØªØ£Ø«ÙŠØ±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
query: cascading_effects(Event, Systems).

# 8. Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ù„Ù…Ù†Ø·Ù‚Ø©
query: emergency_plan("Ù…Ù†Ø·Ù‚Ø©_ØªØ¬Ø§Ø±ÙŠØ©_ÙˆØ³Ø·", Actions).

# ============================================================================
# ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© - Expected Results
# ============================================================================

# Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŒ Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù€:
# 1. ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© 5 Ø£Ù†Ø¸Ù…Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©
# 2. ÙƒØ´Ù Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ
# 3. ØªÙ‚Ø¯ÙŠÙ… ØªÙˆØµÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø°ÙƒÙŠØ©
# 4. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
# 5. ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©

# ============================================================================
# ğŸ‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ - End of Challenge
# ============================================================================
# Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø·Ø±: < 500 Ø³Ø·Ø±
# Total Lines: < 500 lines
# 
# Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙˆØ¶Ø­ Ù‚Ø¯Ø±Ø© Ù„ØºØ© Ø§Ù„Ø¨ÙŠØ§Ù† Ø¹Ù„Ù‰:
# - Ø¥Ø¯Ø§Ø±Ø© Ø£Ù†Ø¸Ù…Ø© Ù…Ø¹Ù‚Ø¯Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª
# - Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
# - Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø³Ù„Ø³ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
# - Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
# - ÙƒÙ„ Ø°Ù„Ùƒ Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ¥ÙŠØ¬Ø§Ø² Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù‚ÙŠÙ‚Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙÙŠ Ù„ØºØ§Øª Ø£Ø®Ø±Ù‰!
# ============================================================================
