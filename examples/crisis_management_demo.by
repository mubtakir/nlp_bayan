#!/usr/bin/env bayan
# ============================================================================
# ğŸš¨ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª Ø§Ù„Ø°ÙƒÙŠ
# Smart Crisis Management System
# ============================================================================
# Ø§Ù„ØªØ­Ø¯ÙŠ: Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø­Ø±Ø¬Ø© Ù…Ø¹ Ù…ÙˆØ§Ø±Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ø© < 380 Ø³Ø·Ø±
# ============================================================================

# Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø²Ù…Ø§Øª
fact: crisis("C001", "Ø­Ø±ÙŠÙ‚_ÙƒØ¨ÙŠØ±", "Ù…Ù†Ø·Ù‚Ø©_Ø³ÙƒÙ†ÙŠØ©_Ø£", "active", "critical").
fact: crisis("C002", "ÙÙŠØ¶Ø§Ù†", "Ù…Ù†Ø·Ù‚Ø©_Ø¨", "active", "high").
fact: crisis("C003", "Ø²Ù„Ø²Ø§Ù„", "Ù…Ù†Ø·Ù‚Ø©_Ø¬", "monitoring", "critical").
fact: crisis("C004", "Ø§Ù†Ù‚Ø·Ø§Ø¹_ÙƒÙ‡Ø±Ø¨Ø§Ø¡", "Ù…Ù†Ø·Ù‚Ø©_Ø¯", "active", "medium").

# Ø§Ù„Ø³ÙƒØ§Ù† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ†
fact: affected_population("C001", 5000, 200, 50).
fact: affected_population("C002", 3000, 100, 20).
fact: affected_population("C003", 10000, 500, 150).
fact: affected_population("C004", 2000, 0, 0).

# Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø© (Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„ÙƒÙ…ÙŠØ©ØŒ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
fact: resource("ambulance", 10, "available", "central").
fact: resource("fire_truck", 8, "available", "central").
fact: resource("rescue_team", 15, "available", "central").
fact: resource("helicopter", 3, "available", "airport").
fact: resource("emergency_shelter", 5, "available", "various").
fact: resource("medical_supplies", 1000, "available", "warehouse").
fact: resource("food_supplies", 5000, "available", "warehouse").
fact: resource("water_tanker", 6, "available", "central").

# Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª (Ø¥Ù†Ù‚Ø§Ø° Ø£Ø±ÙˆØ§Ø­ > Ø¥ØµØ§Ø¨Ø§Øª > Ù…Ù…ØªÙ„ÙƒØ§Øª)
rule: priority_level(CrisisId, Priority) :-
    crisis(CrisisId, _, _, Status, Severity),
    affected_population(CrisisId, _, Injured, Trapped),
    ((Trapped > 0, Severity = "critical") -> Priority = 10 ;
     (Injured > 100, Severity = "critical") -> Priority = 9 ;
     (Trapped > 0) -> Priority = 8 ;
     (Injured > 50) -> Priority = 7 ;
     (Severity = "critical") -> Priority = 6 ;
     Priority = 5).

# ØªØ®ØµÙŠØµ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
rule: allocate_resources(CrisisId, CrisisType, ResourceType, Amount) :-
    crisis(CrisisId, CrisisType, _, "active", _),
    affected_population(CrisisId, Population, Injured, Trapped),
    resource(ResourceType, Available, "available", _),
    ((CrisisType = "Ø­Ø±ÙŠÙ‚_ÙƒØ¨ÙŠØ±", ResourceType = "fire_truck", Amount is min(Available, 5)) ;
     (CrisisType = "Ø­Ø±ÙŠÙ‚_ÙƒØ¨ÙŠØ±", ResourceType = "ambulance", Amount is min(Available, Injured / 20)) ;
     (CrisisType = "ÙÙŠØ¶Ø§Ù†", ResourceType = "rescue_team", Amount is min(Available, 8)) ;
     (CrisisType = "ÙÙŠØ¶Ø§Ù†", ResourceType = "helicopter", Amount is min(Available, 2)) ;
     (CrisisType = "Ø²Ù„Ø²Ø§Ù„", ResourceType = "rescue_team", Amount is min(Available, 12)) ;
     (CrisisType = "Ø²Ù„Ø²Ø§Ù„", ResourceType = "medical_supplies", Amount is min(Available, Injured * 5))).

# Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡
rule: evacuation_needed(CrisisId, Area, Population, Urgency) :-
    crisis(CrisisId, Type, Area, "active", Severity),
    affected_population(CrisisId, Population, _, Trapped),
    ((Severity = "critical", Trapped > 10) -> Urgency = "immediate" ;
     (Severity = "critical") -> Urgency = "urgent" ;
     (Severity = "high") -> Urgency = "soon" ;
     Urgency = "monitor").

# Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
rule: response_plan(CrisisId, Actions) :-
    crisis(CrisisId, Type, Area, "active", Severity),
    priority_level(CrisisId, Priority),
    findall(Action, (
        (evacuation_needed(CrisisId, _, _, "immediate"), Action = "immediate_evacuation") ;
        (allocate_resources(CrisisId, _, ResourceType, _), Action = allocate(ResourceType)) ;
        (Priority >= 8, Action = "deploy_all_emergency_services")
    ), Actions).

# ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©
rule: cascading_risks(CrisisId, SecondaryRisks) :-
    crisis(CrisisId, Type, Area, _, _),
    findall(Risk, (
        (Type = "Ø­Ø±ÙŠÙ‚_ÙƒØ¨ÙŠØ±", Risk = "smoke_inhalation") ;
        (Type = "Ø­Ø±ÙŠÙ‚_ÙƒØ¨ÙŠØ±", Risk = "building_collapse") ;
        (Type = "ÙÙŠØ¶Ø§Ù†", Risk = "waterborne_diseases") ;
        (Type = "ÙÙŠØ¶Ø§Ù†", Risk = "infrastructure_damage") ;
        (Type = "Ø²Ù„Ø²Ø§Ù„", Risk = "aftershocks") ;
        (Type = "Ø²Ù„Ø²Ø§Ù„", Risk = "gas_leaks")
    ), SecondaryRisks).

# Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª
query: priority_level(CrisisId, Priority).
query: allocate_resources("C001", Type, ResourceType, Amount).
query: evacuation_needed(CrisisId, Area, Population, Urgency).
query: response_plan("C001", Actions).
query: cascading_risks("C003", SecondaryRisks).
