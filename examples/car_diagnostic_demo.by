#!/usr/bin/env bayan
# ============================================================================
# ğŸš— Ù†Ø¸Ø§Ù… ØªØ´Ø®ÙŠØµ Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
# Car Diagnostic Expert System
# ============================================================================
# Ø§Ù„ØªØ­Ø¯ÙŠ: ØªØ´Ø®ÙŠØµ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª < 320 Ø³Ø·Ø±
# ============================================================================

# Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ (IDØŒ Ø§Ù„ÙˆØµÙØŒ Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„Ø´Ø¯Ø©)
fact: symptom("S001", "ØµÙˆØª_Ø·Ù‚Ø·Ù‚Ø©_Ø¹Ù†Ø¯_Ø§Ù„ÙØ±Ø§Ù…Ù„", "sound", "high").
fact: symptom("S002", "Ø§Ù‡ØªØ²Ø§Ø²_Ø§Ù„Ù…Ù‚ÙˆØ¯", "vibration", "medium").
fact: symptom("S003", "Ø¯Ø®Ø§Ù†_Ø£Ø²Ø±Ù‚_Ù…Ù†_Ø§Ù„Ø¹Ø§Ø¯Ù…", "smoke", "high").
fact: symptom("S004", "ØµØ¹ÙˆØ¨Ø©_Ø§Ù„ØªØ´ØºÙŠÙ„_ØµØ¨Ø§Ø­Ø§Ù‹", "starting", "medium").
fact: symptom("S005", "Ø§Ø±ØªÙØ§Ø¹_Ø­Ø±Ø§Ø±Ø©_Ø§Ù„Ù…Ø­Ø±Ùƒ", "temperature", "critical").
fact: symptom("S006", "ØµÙˆØª_ØµÙÙŠØ±_Ù…Ù†_Ø§Ù„Ù…Ø­Ø±Ùƒ", "sound", "medium").
fact: symptom("S007", "ØªØ³Ø±ÙŠØ¨_Ø²ÙŠØª", "leak", "high").
fact: symptom("S008", "Ø¶Ø¹Ù_Ø§Ù„ØªØ³Ø§Ø±Ø¹", "performance", "medium").
fact: symptom("S009", "Ø±Ø§Ø¦Ø­Ø©_Ø§Ø­ØªØ±Ø§Ù‚", "smell", "high").
fact: symptom("S010", "Ø¶ÙˆØ¡_ÙØ­Øµ_Ø§Ù„Ù…Ø­Ø±Ùƒ", "warning_light", "medium").

# Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©
fact: car_system("brakes", "Ù†Ø¸Ø§Ù…_Ø§Ù„ÙØ±Ø§Ù…Ù„").
fact: car_system("engine", "Ø§Ù„Ù…Ø­Ø±Ùƒ").
fact: car_system("transmission", "Ù†Ø§Ù‚Ù„_Ø§Ù„Ø­Ø±ÙƒØ©").
fact: car_system("cooling", "Ù†Ø¸Ø§Ù…_Ø§Ù„ØªØ¨Ø±ÙŠØ¯").
fact: car_system("electrical", "Ø§Ù„Ù†Ø¸Ø§Ù…_Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ").
fact: car_system("exhaust", "Ù†Ø¸Ø§Ù…_Ø§Ù„Ø¹Ø§Ø¯Ù…").

# Ø±Ø¨Ø· Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¨Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
rule: symptom_to_system("S001", "brakes", 90).
rule: symptom_to_system("S002", "brakes", 70).
rule: symptom_to_system("S002", "transmission", 30).
rule: symptom_to_system("S003", "engine", 85).
rule: symptom_to_system("S004", "electrical", 60).
rule: symptom_to_system("S004", "engine", 40).
rule: symptom_to_system("S005", "cooling", 95).
rule: symptom_to_system("S006", "engine", 75).
rule: symptom_to_system("S007", "engine", 80).
rule: symptom_to_system("S008", "engine", 60).
rule: symptom_to_system("S008", "transmission", 40).
rule: symptom_to_system("S009", "electrical", 70).
rule: symptom_to_system("S009", "engine", 30).
rule: symptom_to_system("S010", "engine", 50).

# Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© (IDØŒ Ø§Ù„ÙˆØµÙØŒ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ØŒ Ø§Ù„ØªÙƒÙ„ÙØ©)
fact: fault("F001", "ØªØ¢ÙƒÙ„_ÙØ­Ù…Ø§Øª_Ø§Ù„ÙØ±Ø§Ù…Ù„", "brakes", "high", 500).
fact: fault("F002", "ØªÙ„Ù_Ø£Ù‚Ø±Ø§Øµ_Ø§Ù„ÙØ±Ø§Ù…Ù„", "brakes", "medium", 1200).
fact: fault("F003", "Ø§Ø­ØªØ±Ø§Ù‚_Ø²ÙŠØª_Ø§Ù„Ù…Ø­Ø±Ùƒ", "engine", "high", 2000).
fact: fault("F004", "Ø¶Ø¹Ù_Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©", "electrical", "high", 400).
fact: fault("F005", "ØªÙ„Ù_Ø§Ù„Ø«Ø±Ù…ÙˆØ³ØªØ§Øª", "cooling", "high", 300).
fact: fault("F006", "ØªØ³Ø±ÙŠØ¨_Ø±Ø§Ø¯ÙŠØ§ØªÙŠØ±", "cooling", "medium", 800).
fact: fault("F007", "ØªÙ„Ù_Ø­Ø²Ø§Ù…_Ø§Ù„Ù…Ø­Ø±Ùƒ", "engine", "medium", 250).
fact: fault("F008", "Ù…Ø´ÙƒÙ„Ø©_Ø­Ø³Ø§Ø³_Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†", "exhaust", "medium", 600).
fact: fault("F009", "Ø§Ù†Ø²Ù„Ø§Ù‚_Ø§Ù„Ù‚Ø§Ø¨Ø¶", "transmission", "high", 3000).
fact: fault("F010", "ØªÙ„Ù_Ø¨ÙˆØ§Ø¬ÙŠ_Ø§Ù„Ø¥Ø´Ø¹Ø§Ù„", "engine", "medium", 350).

# Ø±Ø¨Ø· Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø¨Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
rule: fault_causes_symptom("F001", "S001", 95).
rule: fault_causes_symptom("F002", "S001", 85).
rule: fault_causes_symptom("F002", "S002", 70).
rule: fault_causes_symptom("F003", "S003", 90).
rule: fault_causes_symptom("F003", "S007", 60).
rule: fault_causes_symptom("F004", "S004", 85).
rule: fault_causes_symptom("F005", "S005", 90).
rule: fault_causes_symptom("F006", "S005", 70).
rule: fault_causes_symptom("F007", "S006", 80).
rule: fault_causes_symptom("F008", "S008", 65).
rule: fault_causes_symptom("F008", "S010", 70).
rule: fault_causes_symptom("F009", "S008", 75).
rule: fault_causes_symptom("F010", "S004", 60).
rule: fault_causes_symptom("F010", "S008", 55).

# Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
rule: diagnose(SymptomId, FaultId, System, Probability, Cost) :-
    symptom(SymptomId, _, _, _),
    fault_causes_symptom(FaultId, SymptomId, Prob),
    fault(FaultId, _, System, _, Cost),
    Probability = Prob.

# ØªØ´Ø®ÙŠØµ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
rule: multi_symptom_diagnosis(Symptoms, FaultId, TotalProb, Cost) :-
    fault(FaultId, _, _, _, Cost),
    findall(P, (member(S, Symptoms), fault_causes_symptom(FaultId, S, P)), Probs),
    length(Probs, Count),
    Count > 0,
    sum_list(Probs, Sum),
    TotalProb is Sum / Count.

# ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­
rule: repair_recommendation(FaultId, Description, Priority, Cost) :-
    fault(FaultId, Description, System, Likelihood, Cost),
    symptom_to_system(_, System, _),
    (Likelihood = "high" -> Priority = "urgent" ;
     Likelihood = "medium" -> Priority = "soon" ;
     Priority = "monitor").

# ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
rule: total_repair_cost(Faults, TotalCost) :-
    findall(Cost, (member(F, Faults), fault(F, _, _, _, Cost)), Costs),
    sum_list(Costs, TotalCost).

# Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª
query: diagnose("S001", FaultId, System, Probability, Cost).
query: multi_symptom_diagnosis(["S003", "S007"], FaultId, Prob, Cost).
query: repair_recommendation(FaultId, Description, Priority, Cost).
query: total_repair_cost(["F001", "F005"], TotalCost).
