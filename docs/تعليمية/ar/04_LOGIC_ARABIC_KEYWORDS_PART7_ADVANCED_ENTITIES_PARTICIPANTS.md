# المنطق في لغة البيان (٧): الكيانات المتقدّمة ونِسَب المشاركة

<div dir="rtl">

> في هذا الجزء نركّز على فكرة أساسية في محرك الكيانات:
> **لكل شيء تقريبًا نسبة**:
> - للحالة (درجة 0..1).
> - للخاصية أو القيمة.
> - لقوّة الفعل.
> - ولمدى مشاركة كل كيان في الفعل (**الحساسية / sensitivity**).
>
> هذه النِّسَب تسمح للبيان أن يمثّل عالمًا غنيًّا: شخص يتأثّر 0.7 بالفعل، وآخر 0.3، وهكذا.

## ١. مستويات النِّسَب في محرك الكيانات

بشكل مبسّط، لدينا:

- **درجة الحالة**: مثل `"سعادة": 0.6` أو `"جوع": 0.3` (ضبابي 0..1).
- **قوّة الفعل**: حقل `"قوة"` في تعريف الفعل داخل الكيان.
- **قيمة الفعل**: المعامل `قيمة_الفعل` الممرَّر إلى `طبق` / `نفذ`.
- **حساسية الهدف**: `sensitivity`، تأتي من **نسبة المشاركة** لكل كيان.

داخل معادلة التأثير `formula` يمكنك استخدام:

- `value`  → القيمة الحالية للحالة.
- `action_value` → قيمة الفعل الممرّرة.
- `power` → قوّة الفعل.
- `sensitivity` → نسبة مشاركة/حساسية هذا الهدف.

## ٢. دالة «نفّذ / perform» والمشاركون بنِسَب

الدالة العالمية:

- العربية: `نفذ(اسم_الفعل, المشاركون, الحالات=None, الخصائص=None, قيمة_الفعل=1.0)`

**شكل المشاركين** يمكن أن يكون:

- قائمة سلاسل نصية: `[
  "أحمد.1.0",   # مشاركة كاملة
  "علي:0.5"     # مشاركة متوسطة
]`
- أو قائمة ثنائيات: `[ ("أحمد", 1.0), ("علي", 0.5) ]`.
- أو قاموس: `{ "أحمد": 1.0, "علي": 0.5 }`.

### ٢٫١ مثال: أحمد وعلي يتحرّكان بنسب مختلفة

```bayan
هجين {
    كيان أحمد {
        "خصائص": {"س": {"نوع": "عددي", "قيمة": 0.0}},
        "أفعال": {"اذهب": {"تأثيرات": [
            {"on": "س", "formula": "value + 3*sensitivity"}
        ]}}
    }

    كيان علي {
        "خصائص": {"س": {"نوع": "عددي", "قيمة": 1.0}}
    }

    نفذ("اذهب", ["أحمد.1.0", "علي.0.5"], قيمة_الفعل=1.0)
}
```

- أحمد مشارك بنسبة 1.0 → تزيد `س` لديه بمقدار أكبر.
- علي مشارك بنسبة 0.5 → التغيير عنده نصف ما عند أحمد تقريبًا (حسب المعادلة).

يمكننا تعريف واجهة عربية لقراءة الخصائص:

```bayan
هجين {
    خاصية(?كيان, ?مفتاح, ?قيمة) :- property(?كيان, ?مفتاح, ?قيمة).
}
استعلام خاصية("أحمد", "س", ?موضع_أحمد)?
استعلام خاصية("علي", "س", ?موضع_علي)?
```

## ٣. المجموعات والضمائر: تطبيق فعل على مجموعة بنِسَب

يمكنك تعريف **مجموعة** من الكيانات ثم الإشارة إليها في المشاركين:

```bayan
هجين {
    كيان أحمد { "خصائص": {"س": {"نوع": "عددي", "قيمة": 0.0}},
                "أفعال": {"اذهب": {"تأثيرات": [
                    {"on": "س", "formula": "value + 2*sensitivity"}
                ]}} }

    كيان علي   { "خصائص": {"س": {"نوع": "عددي", "قيمة": 1.0}} }

    عرّف_مجموعة("الفريق", ["أحمد", "علي"])

    نفذ("اذهب", ["مجموعة:الفريق.0.5"])  # يطبّق على كل أفراد المجموعة
    نفذ("اذهب", ["هما.0.2"])             # مرجع ضمير لآخر مجموعة مستخدمة
}
```

- `"مجموعة:الفريق.0.5"` تعني: طبّق الفعل على كل أفراد المجموعة بنسبة حساسية 0.5 لكل فرد.
- `"هما.0.2"` (أو ضمير مشابه) تعيد استخدام آخر مجموعة مشاركين مع نسبة جديدة.

## ٤. ردود الأفعال: حين يستقبل الكيان فعلًا بنسبة معيّنة

إلى جانب «الأفعال» هناك **ردود_أفعال**، وهي الطريقة التي
**يستجيب بها الكيان عندما يُطبَّق عليه فعل معيّن**:

```bayan
هجين {
    كيان أحمد {
        "حالات": {"سعادة": 0.5},
        "ردود_أفعال": {
            "تقديم_وجبة": {
                "sensitivity": 0.7,
                "response": "سعادة += sensitivity*0.3"
            }
        }
    }

    كيان مطعم {
        "أفعال": {"تقديم_وجبة": {"تأثيرات": []}}
    }

    نفذ("تقديم_وجبة", ["مطعم.1.0", "أحمد.1.0"], قيمة_الفعل=1.0)
}
```

- عندما يكون أحمد هدفًا لفعل `تقديم_وجبة`:
  - تُستخدم حساسيته `0.7` في رد الفعل.
  - تُزاد `سعادة` بقيمة تقريبية `0.7 * 0.3 = 0.21` (حسب المعادلة).

## ٥. مثال متكامل: درسٌ يؤثّر على تركيز وتعب طالبين بنِسَب مختلفة

```bayan
هجين {
    كيان طالب1 {
        "حالات": {"تركيز": 0.6, "تعب": 0.2},
        "أفعال": {
            "درس": {
                "قوة": 1.0,
                "تأثيرات": [
                    {"on": "تركيز", "formula": "clamp(value + power*0.2*sensitivity, 0, 1)"},
                    {"on": "تعب",   "formula": "clamp(value + power*0.3*sensitivity, 0, 1)"}
                ]
            }
        }
    }

    كيان طالب2 {
        "حالات": {"تركيز": 0.3, "تعب": 0.4}
    }

    نفذ("درس", ["طالب1.0", "طالب2.0.5"], قيمة_الفعل=1.0)
}

هجين {
    حالة(?ك, ?م, ?ق) :- state(?ك, ?م, ?ق).
}
استعلام حالة("طالب1", "تركيز", ?تركيز1)?
استعلام حالة("طالب2", "تركيز", ?تركيز2)?
```

- `طالب1` يشارك بنسبة 1.0 → يتحسن تركيزه أكثر ويتعب أكثر.
- `طالب2` بحساسية أقل (0.5) → التأثير عليه أضعف في كلا الحالتين.

بهذا ترى كيف أن **الحالات، الأفعال، المجموعات، وردود الأفعال** تتعاون عبر مفهوم واحد مشترك:

> **كل كيان وكل فعل له نسبة مشاركة وحساسية، تُترجم إلى أرقام في المعادلات،
> لكنها تبقى معبَّرًا عنها بواجهة عربية واضحة.**
> وهذه الأرقام هي ما تستعمله لاحقًا طبقات Conceptual LM عند بناء الأثر التصوّري والجمل العربية.


</div>

