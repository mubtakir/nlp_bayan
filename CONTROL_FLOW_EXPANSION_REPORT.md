# ุชูุฑูุฑ ุงูุชูุณูุน: ุนุจุงุฑุงุช ุงูุชุญูู ูู BytecodeCompiler
# Expansion Report: Control Flow in BytecodeCompiler

**ุงูุชุงุฑูุฎ | Date**: 2025-11-28  
**ุงูุญุงูุฉ | Status**: ๐ ููุฏ ุงูุชุทููุฑ | In Progress  
**ุงูุฃููููุฉ | Priority**: ุนุงููุฉ | High

---

## โ ูุง ุชู ุฅูุฌุงุฒู | Completed

### 1. ูุธุงู ุงูููุฒุงุช (Jump System)
- โ ุฅุถุงูุฉ `create_label()` - ุฅูุดุงุก ุชุณููุงุช ูุฑูุฏุฉ
- โ ุฅุถุงูุฉ `mark_label()` - ุชุญุฏูุฏ ูููุน ุงูุชุณููุฉ
- โ ุฅุถุงูุฉ `emit_jump()` - ุฅุตุฏุงุฑ ุชุนูููุฉ ููุฒ
- โ ุฅุถุงูุฉ `backpatch_jumps()` - ุญู ุนูุงููู ุงูููุฒุงุช

### 2. ุนูููุงุช ุงูููุงุฑูุฉ (Comparison Operators)
- โ ุฏุนู `<`, `>`, `<=`, `>=`, `==`, `!=`
- โ ุงุณุชุฎุฏุงู `COMPARE_OP` ุจุดูู ุตุญูุญ
- โ ุฏุนู CACHE entries ูู Python 3.11+

### 3. ุนุจุงุฑุฉ if/else
- โ `visit_IfStatement()` ููููุฐุฉ
- โ ุฏุนู `then_branch` ู `else_branch`
- โ ุงุณุชุฎุฏุงู `POP_JUMP_IF_FALSE` ู `JUMP_FORWARD`
- โ **ุงูุงุฎุชุจุงุฑ**: ูุนูู ุจุดูู ุตุญูุญ โ

### 4. ุญููุฉ while
- โ `visit_WhileLoop()` ููููุฐุฉ
- โ ุงุณุชุฎุฏุงู `JUMP_BACKWARD` ููุนูุฏุฉ
- โ๏ธ **ุงููุดููุฉ**: ุญุณุงุจ ุงูููุฒุฉ ุงูุฎูููุฉ ุบูุฑ ุตุญูุญ
- โ๏ธ **ุงููุชูุฌุฉ**: ุงูุญููุฉ ุชููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุท

### 5. ุญููุฉ for
- โ `visit_ForLoop()` ููููุฐุฉ
- โ ุงุณุชุฎุฏุงู `GET_ITER` ู `FOR_ITER`
- โ ุฏุนู `range()` ูุบูุฑูุง
- โ๏ธ **ุงููุดููุฉ**: ููุณ ูุดููุฉ `JUMP_BACKWARD`

### 6. ุงุณุชุฏุนุงุก ุงูุฏูุงู (Function Calls)
- โ `visit_FunctionCall()` ููููุฐุฉ
- โ ุฏุนู `LOAD_GLOBAL` ูุน `CALL`
- โ ุฏุนู ุงููุนุงููุงุช (arguments)

### 7. ุงูููู ุงูููุทููุฉ (Booleans)
- โ `visit_Boolean()` ููููุฐุฉ
- โ ุฏุนู `True` ู `False`

---

## โ๏ธ ุงููุดุงูู ุงูุญุงููุฉ | Current Issues

### 1. JUMP_BACKWARD ูู Python 3.12
**ุงููุดููุฉ**: ุญุณุงุจ `delta` ููููุฒ ุงูุฎููู ุบูุฑ ุตุญูุญ

**ุงูุณุจุจ ุงููุญุชูู**:
- ูู Python 3.11+, `JUMP_BACKWARD` ูุฃุฎุฐ ุนุฏุฏ ุงูุชุนูููุงุช (instructions) ููููุฒ ููุฎูู
- ุงูุญุณุงุจ ุงูุญุงูู: `delta = (jump_offset + 2 - target_offset) // 2`
- ูุฏ ูููู ุงูุญุณุงุจ ุตุญูุญุงู ููู ููุงู ูุดููุฉ ูู ุชูููุฐ ุงูุญููุฉ

**ุงูุฃุนุฑุงุถ**:
- ุญููุฉ `while` ุชููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุท
- `x = 0; while x < 5: x = x + 1` ููุชุฌ `x = 1` ุจุฏูุงู ูู `x = 5`

**ุงูุญู ุงูููุชุฑุญ**:
1. ูุญุต bytecode ุงููููุชุฌ ุจุงุณุชุฎุฏุงู `dis.dis()`
2. ููุงุฑูุชู ูุน bytecode Python ุงูุฃุตูู
3. ุชุตุญูุญ ุญุณุงุจ `delta` ุฃู ููุทู ุงูููุฒ

### 2. FOR_ITER Jump Target
**ุงููุดููุฉ**: ูุฏ ุชููู ููุณ ูุดููุฉ `JUMP_BACKWARD`

**ุงูุญู**: ููุณ ุงูุญู ุฃุนูุงู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ | Next Steps

### ุงูุฃููููุฉ ุงูููุฑูุฉ (ุงูููู)
1. โ **ุชุตุญูุญ JUMP_BACKWARD**
   - ูุญุต bytecode ุงููููุชุฌ
   - ููุงุฑูุฉ ูุน Python ุงูุฃุตูู
   - ุชุตุญูุญ ุงูุญุณุงุจ

2. โ **ุงุฎุชุจุงุฑ ุงูุญููุงุช**
   - `while` loop
   - `for` loop
   - ุญููุงุช ูุชุฏุงุฎูุฉ

### ุงูุฃููููุฉ ุงููุชูุณุทุฉ (ูุฐุง ุงูุฃุณุจูุน)
3. โณ **ุฏุนู break/continue**
   - ุฅุถุงูุฉ `visit_BreakStatement()`
   - ุฅุถุงูุฉ `visit_ContinueStatement()`
   - ุงุณุชุฎุฏุงู jump labels ููุฎุฑูุฌ/ุงูุงุณุชูุฑุงุฑ

4. โณ **ุฏุนู ุงูุฏูุงู**
   - `visit_FunctionDef()`
   - `visit_ReturnStatement()`
   - ุฅูุดุงุก code objects ููุฏูุงู

### ุงูุฃููููุฉ ุงูููุฎูุถุฉ (ุงูุฃุณุจูุน ุงููุงุฏู)
5. โณ **ุฏุนู ุงูุฃุตูุงู**
   - `visit_ClassDef()`
   - `visit_MethodCall()`

6. โณ **ุชุญุณูู ุงูุฃุฏุงุก**
   - ุชุญุณูู ููุช ุงูุชุฌููุน
   - Constant folding
   - Dead code elimination

---

## ๐ ุงูุฅุญุตุงุฆูุงุช | Statistics

### ุงูููุฒุงุช ุงููุฏุนููุฉ
- โ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ: 100%
- โ ุนูููุงุช ุงูููุงุฑูุฉ: 100%
- โ if/else: 100%
- โ๏ธ while loops: 50% (ูููุฐ ููู ุจุฎุทุฃ)
- โ๏ธ for loops: 50% (ูููุฐ ููู ุจุฎุทุฃ)
- โ ุงุณุชุฏุนุงุก ุงูุฏูุงู: 80% (ุฃุณุงุณู ููุท)

### ุงูููุฏ ุงูููุถุงู
- **ุงูุฃุณุทุฑ ุงูุฌุฏูุฏุฉ**: ~200 ุณุทุฑ
- **ุงูุฏูุงู ุงูุฌุฏูุฏุฉ**: 8 ุฏูุงู
- **ุงูุงุฎุชุจุงุฑุงุช**: 5 ุงุฎุชุจุงุฑุงุช (1 ูุงุฌุญุ 4 ูุนููุฉ)

---

## ๐ฏ ุงููุฏู ุงูููุงุฆู | Final Goal

**ุฏุนู ูุงูู ูุนุจุงุฑุงุช ุงูุชุญูู** ุจุญูุซ ูููู ุชุฌููุน:
```python
# Bayan code
x = 0
while x < 10: {
    if x % 2 == 0: {
        print(x)
    }
    x = x + 1
}

for i in range(5): {
    print(i)
}
```

**ุงูุชุณุฑูุน ุงููุชููุน**: 20-30x ููุจุฑุงูุฌ ูุน ุญููุงุช

---

## ๐ ููุงุญุธุงุช ุชูููุฉ | Technical Notes

### Python 3.12 Jump Instructions
- `JUMP_BACKWARD`: relative jump backward (arg = # of instructions)
- `JUMP_FORWARD`: relative jump forward (arg = # of instructions)
- `POP_JUMP_IF_FALSE`: pop and jump if false
- `FOR_ITER`: iterate or jump to end

### Bytecode Structure (3.12)
```
Instruction = Opcode (1 byte) + Arg (1 byte)
Total = 2 bytes per instruction
CACHE entries = 2 bytes each (opcode 0, arg 0)
```

### Jump Calculation
```python
# Forward jump
delta = (target_offset - (jump_offset + 2)) // 2

# Backward jump
delta = (jump_offset + 2 - target_offset) // 2
```

---

**ุขุฎุฑ ุชุญุฏูุซ | Last Updated**: 2025-11-28 21:40  
**ุงูุญุงูุฉ | Status**: ๐ ููุฏ ุงูุชุทููุฑ - ุชุตุญูุญ ุงูุฃุฎุทุงุก | In Progress - Debugging
