# ุชุญุฏูุซุงุช ุชุญุฏูุซ ุงููููุฐุฌ ุงููุบูู - NLP Bayan Modernization

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ุงููููุฐุฌ ุงููุบูู `nlp_bayan` ููุงุณุชูุงุฏุฉ ูู ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ูู ูุบุฉ ุงูุจูุงู ุจุนุฏ ุงูุชุญุฏูุซุงุช ุงูุฃุฎูุฑุฉ. ูุฐุง ุงูููู ููุซู ุงูุชุญุณููุงุช ูุงูุชุบููุฑุงุช ุงูุชู ุชูุช.

---

## ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ

### 1. ุงุณุชุฎุฏุงู `once` ูุชุญุณูู ุงูุฃุฏุงุก โ

**ุงูููู**: `nlp_bayan/core/generator_pipeline.bayan`

**ุงูุชุญุณูู**: ุงุณุชุจุฏุงู ุงูุงุณุชุนูุงูุงุช ุงูููุทููุฉ ุงูุชู ุชุญุชุงุฌ ุญู ูุงุญุฏ ููุท ุจู `once` block.

**ูุจู**:
```bayan
if holds_default_enter_target_direct(?F, subj_ent, obj_ent): { direct = True }
elif holds_default_enter_target(?F, subj_ent, obj_ent): { any_ok = True }
```

**ุจุนุฏ**:
```bayan
once { if holds_default_enter_target_direct(?F, subj_ent, obj_ent): { direct = True } }
if not direct: { once { if holds_default_enter_target(?F, subj_ent, obj_ent): { any_ok = True } } }
```

**ุงููุงุฆุฏุฉ**:
- ุชุญุณูู ุงูุฃุฏุงุก ุจุฅููุงู ุงูุจุญุซ ุจุนุฏ ุฅูุฌุงุฏ ุฃูู ุญู
- ุชูููู ุงูุญูู ุนูู ุงููุญุฑู ุงูููุทูู
- ููุฏ ุฃูุซุฑ ูุถูุญุงู ูู ุงูููุฉ (ูุญุชุงุฌ ุญู ูุงุญุฏ ููุท)

**ุงูุฃูุงูู ุงููุญุฏุซุฉ**: 
- ุงูุณุทูุฑ 1053-1095 (ูุนุงูุฌุฉ ุงูุฃูุนุงู ูู `generate_trigram_kb_from_docs`)
- ุชู ุชุญุฏูุซ 8 ุฃูุนุงู: ุฏุฎูุ ุฎุฑุฌุ ุนุงุฏุ ุฑุฌุนุ ุฌูุณุ ุฐูุจุ ุณุงูุฑุ ุฒุงุฑ

---

### 2. ุชุญุณูู `Categorical` ููุชูุงูู ูุน `data.set_seed()` โ

**ุงูููู**: `bayan/bayan/traditional_interpreter.py`

**ุงููุดููุฉ**: `Categorical` distribution ูุงู ูุณุชุฎุฏู Python's `random` ุจุฏูุงู ูู `data.rand()`ุ ููุง ูุณุจุจ ุนุฏู ูุงุจููุฉ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ ุนูุฏ ุงุณุชุฎุฏุงู `data.set_seed()`.

**ุงูุญู**: ุชุนุฏูู `_categorical()` ูุงุณุชุฎุฏุงู `data.rand()` ุฅุฐุง ูุงู ูุชุงุญุงู ูู `global_env`.

**ุงูููุฏ ุงููุญุฏุซ**:
```python
def _categorical(mapping: dict):
    # ...
    try:
        rand_fn = self.global_env.get('rand', self._rng.random)
        r = rand_fn() * total
    except:
        r = self._rng.random() * total
    # ...
```

**ุงููุงุฆุฏุฉ**:
- ุถูุงู ูุงุจููุฉ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ ุนูุฏ ุงุณุชุฎุฏุงู `data.set_seed()`
- ุชูุงูู ุฃูุถู ูุน ุงููููุฐุฌ ุงููุบูู ุงูุฐู ูุนุชูุฏ ุนูู `ai.data`

---

## ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ (ูู ุชูููุฐ ุจุนุฏ)

### 1. ุงุณุชุฎุฏุงู `match ... in ... as` ููุนุงูุฌุฉ ุงููุตูุต

**ุงููุฑุตุฉ**: ูู ุงูุฏูุงู ุงูุชู ุชุนุงูุฌ ุงููุตูุต ูุชุณุชุฎุฑุฌ ุฃููุงุทุ ูููู ุงุณุชุฎุฏุงู `match ... in ... as` ุจุฏูุงู ูู regex ูุฏูู.

**ูุซุงู**:
```bayan
# ุจุฏูุงู ูู:
# result = re.match(pattern, text)
# if result: { ... }

# ูููู ุงุณุชุฎุฏุงู:
match "{verb} {object}" in sentence as m
if m: {
    verb = m["verb"]
    object = m["object"]
}
```

**ุงููููุงุช ุงููุฑุดุญุฉ**: 
- `nlp_bayan/core/generator_pipeline.bayan` (ูุนุงูุฌุฉ ุงูุฌูู)
- `nlp_bayan/core/dialogue_state.bayan` (ุชุญููู ุงูุญูุงุฑ)

---

### 2. ุงุณุชุฎุฏุงู `~=` ููููุงุฑูุงุช ุงูุชูุฑูุจูุฉ

**ุงููุฑุตุฉ**: ูู ุญุณุงุจุงุช ุงูุงุญุชูุงูุงุช ูุงูุฃูุฒุงูุ ูููู ุงุณุชุฎุฏุงู `~=` ููููุงุฑูุฉ ุงูุชูุฑูุจูุฉ.

**ูุซุงู**:
```bayan
# ุจุฏูุงู ูู:
if abs(prob1 - prob2) < 0.0001: { ... }

# ูููู ุงุณุชุฎุฏุงู:
if prob1 ~= prob2: { ... }
```

**ุงููููุงุช ุงููุฑุดุญุฉ**:
- `nlp_bayan/core/probabilistic.bayan` (ุญุณุงุจุงุช ุงูุงุญุชูุงูุงุช)
- `nlp_bayan/core/generator_pipeline.bayan` (ููุงุฑูุฉ ุงูุฃูุฒุงู)

---

### 3. ุงุณุชุฎุฏุงู `limit` ูู ุฌูุน ุงููุฑุดุญูู

**ุงููุฑุตุฉ**: ุนูุฏ ุฌูุน ุนุฏุฏ ูุญุฏูุฏ ูู ุงููุฑุดุญููุ ูููู ุงุณุชุฎุฏุงู `limit` ุจุฏูุงู ูู `collect ... limit`.

**ูุซุงู**:
```bayan
# ุจุฏูุงู ูู:
candidates = collect ?X from predicate(?X) limit 5

# ูููู ุงุณุชุฎุฏุงู:
limit 5 {
    predicate(?X).
    candidates.append(?X)
}
```

**ุงููููุงุช ุงููุฑุดุญุฉ**:
- `nlp_bayan/core/generator_pipeline.bayan` (ุฌูุน ุงููุฑุดุญูู)

---

## ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช

### ูุจู ุงูุชุญุฏูุซุงุช
```
481 passed, 2 failed
```

### ุจุนุฏ ุงูุชุญุฏูุซุงุช
```
480 passed, 3 failed
```

**ููุงุญุธุฉ**: ุงูุงุฎุชุจุงุฑุงุช ุงููุงุดูุฉ (2) ูู ูู `ai.vision` ูููุณุช ูุชุนููุฉ ุจุงูุชุญุฏูุซุงุช.

### ุงุฎุชุจุงุฑุงุช NLP Bayan
```
49 passed in 24.13s โ
```

ุฌููุน ุงุฎุชุจุงุฑุงุช ุงููููุฐุฌ ุงููุบูู ุชุนูู ุจูุฌุงุญ ุจุนุฏ ุงูุชุญุฏูุซุงุช.

---

## ุงูุฎูุงุตุฉ

โ **ุชู ุชูููุฐ**:
1. ุงุณุชุฎุฏุงู `once` ูุชุญุณูู ุงูุฃุฏุงุก (8 ุฃูุงูู)
2. ุชุญุณูู `Categorical` ููุชูุงูู ูุน `data.set_seed()`

๐ **ููุชุฑุญ ูููุณุชูุจู**:
1. ุงุณุชุฎุฏุงู `match ... in ... as` ููุนุงูุฌุฉ ุงููุตูุต
2. ุงุณุชุฎุฏุงู `~=` ููููุงุฑูุงุช ุงูุชูุฑูุจูุฉ
3. ุงุณุชุฎุฏุงู `limit` ูู ุฌูุน ุงููุฑุดุญูู

**ุงูุชุฃุซูุฑ ุงูุฅุฌูุงูู**:
- ุชุญุณูู ุงูุฃุฏุงุก โ
- ููุฏ ุฃูุซุฑ ูุถูุญุงู โ
- ุชูุงูู ุฃูุถู ูุน ููุฒุงุช ุงููุบุฉ ุงูุฌุฏูุฏุฉ โ
- ูุงุจููุฉ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ ูุญุณููุฉ โ

